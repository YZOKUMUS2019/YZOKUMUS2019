<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hasene Arapça Oyunu</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="icon-192-v4-RED-MUSHAF.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Hasene Arapça">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icon-192-v4-RED-MUSHAF.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192-v4-RED-MUSHAF.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512-v4-RED-MUSHAF.png">
    
    <!-- Uthmani Kur'an Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Reem+Kufi:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Material Icons (served via Google Fonts). Preconnect is sufficient; remove explicit preload to avoid unused-preload warnings. -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons&display=swap" rel="stylesheet">
    
    <!-- Flutter Modern CSS -->
    <link rel="stylesheet" href="flutter_modern.css">
    
    <style>
        /* ============ UTHMANI FONT DEFINITION ============ */
        @font-face {
            font-family: 'Uthmani';
            src: url('KFGQPC Uthmanic Script HAFS Regular.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        /* ============ MATERIAL ICONS FALLBACK ============ */
        .material-icons {
            font-family: 'Material Icons', 'Material Icons Fallback', Arial, sans-serif;
            font-weight: normal;
            font-style: normal;
            display: inline-block;
            line-height: 1;
            text-transform: none;
            letter-spacing: normal;
            word-wrap: normal;
            white-space: nowrap;
            direction: ltr;
            /* Fallback text için bazı iconlar */
        }
        
        /* Material Icons fallback sistem */
        .material-icons:not(.loaded) {
            visibility: hidden;
        }
        
        /* ============ TEMEL AYARLAR ============ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
            background: #F7F7F7;
            min-height: 100vh;
            padding: 0;
            position: relative;
            overflow-x: hidden;
            color: #1C1C1E;
        }

        /* Animated Background Pattern */
        body::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 215, 0, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 69, 19, 0.03) 0%, transparent 50%);
            animation: rotate 30s linear infinite;
            pointer-events: none;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ============ LOADING SAYFASI - MODERN GLASS MORPHISM ============ */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                rgba(183, 28, 28, 0.95) 0%, 
                rgba(244, 67, 54, 0.98) 25%, 
                rgba(255, 87, 34, 0.95) 50%,
                rgba(255, 152, 0, 0.98) 75%,
                rgba(255, 235, 59, 0.95) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeIn 0.8s cubic-bezier(0.4, 0.0, 0.2, 1);
            overflow: hidden;
        }

        /* Animated background particles */
        .loading-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            animation: particleFloat 20s linear infinite;
            pointer-events: none;
        }

        @keyframes particleFloat {
            0% { transform: translateX(0) translateY(0) rotate(0deg); }
            25% { transform: translateX(20px) translateY(-20px) rotate(90deg); }
            50% { transform: translateX(0) translateY(-40px) rotate(180deg); }
            75% { transform: translateX(-20px) translateY(-20px) rotate(270deg); }
            100% { transform: translateX(0) translateY(0) rotate(360deg); }
        }

        .loading-screen.fade-out {
            animation: fadeOut 1.2s cubic-bezier(0.4, 0.0, 0.2, 1) forwards;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: scale(0.9);
            }
            to { 
                opacity: 1; 
                transform: scale(1);
            }
        }

        @keyframes fadeOut {
            from { 
                opacity: 1; 
                transform: scale(1);
            }
            to { 
                opacity: 0; 
                transform: scale(1.05);
            }
        }

        .loading-logo {
            width: 200px;
            height: 200px;
            margin-bottom: 40px;
            animation: logoFloat 4s ease-in-out infinite;
            filter: drop-shadow(0 10px 40px rgba(255, 255, 255, 0.3));
            will-change: transform;
            position: relative;
            z-index: 2;
        }

        @keyframes logoFloat {
            0%, 100% { 
                transform: translateY(0) rotate(0deg) scale(1);
                filter: drop-shadow(0 10px 40px rgba(255, 255, 255, 0.3));
            }
            50% { 
                transform: translateY(-15px) rotate(2deg) scale(1.05);
                filter: drop-shadow(0 20px 60px rgba(255, 255, 255, 0.5));
            }
        }

        .loading-title {
            font-family: 'Reem Kufi', serif;
            font-size: 3.5em;
            font-weight: 700;
            background: linear-gradient(45deg, #FF3D00, #FF5722, #FF9800);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 5px 15px rgba(255, 61, 0, 0.4);
            margin-bottom: 50px;
            letter-spacing: 16px;
            animation: titleGlow 3s ease-in-out infinite;
            position: relative;
            z-index: 2;
        }

        @keyframes titleGlow {
            0%, 100% { 
                transform: scale(1);
                filter: drop-shadow(0 0 20px rgba(255, 61, 0, 0.6));
            }
            50% { 
                transform: scale(1.02);
                filter: drop-shadow(0 0 40px rgba(255, 61, 0, 1));
            }
        }

        .hadis-box {
            max-width: 550px;
            padding: 40px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2),
                        inset 0 1px 0 rgba(255, 255, 255, 0.3);
            margin-bottom: 50px;
            animation: boxFloat 6s ease-in-out infinite;
            position: relative;
            z-index: 2;
        }

        @keyframes boxFloat {
            0%, 100% { 
                transform: translateY(0) rotateX(0deg);
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            }
            50% { 
                transform: translateY(-8px) rotateX(1deg);
                box-shadow: 0 30px 80px rgba(0, 0, 0, 0.3);
            }
        }

        .hadis-arabic {
            font-size: 26px;
            background: linear-gradient(45deg, #FF3D00, #FFFFFF, #FF9800);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            font-family: 'Uthmani', 'Amiri Quran', serif;
            line-height: 2.2;
            margin-bottom: 25px;
            direction: rtl;
            animation: textShimmer 4s ease-in-out infinite;
        }

        @keyframes textShimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .hadis-turkish {
            font-size: 17px;
            color: rgba(255, 255, 255, 0.95);
            text-align: center;
            line-height: 1.9;
            font-style: italic;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 5px solid rgba(255, 255, 255, 0.2);
            border-top: 5px solid #FF3D00;
            border-right: 5px solid #FF5722;
            border-radius: 50%;
            animation: modernSpin 2s cubic-bezier(0.4, 0.0, 0.2, 1) infinite;
            margin-bottom: 25px;
            position: relative;
            z-index: 2;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
        }

        @keyframes modernSpin {
            0% { 
                transform: rotate(0deg) scale(1);
                box-shadow: 0 0 30px rgba(255, 61, 0, 0.4);
            }
            50% { 
                transform: rotate(180deg) scale(1.1);
                box-shadow: 0 0 50px rgba(255, 61, 0, 0.7);
            }
            100% { 
                transform: rotate(360deg) scale(1);
                box-shadow: 0 0 30px rgba(255, 61, 0, 0.4);
            }
        }

        .loading-text {
            background: linear-gradient(45deg, #FF3D00, #FF7043, #FFAB91);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 60px;
            animation: textPulse 2s ease-in-out infinite;
            position: relative;
            z-index: 2;
            letter-spacing: 2px;
        }

        @keyframes textPulse {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1);
            }
            50% { 
                opacity: 0.7; 
                transform: scale(1.05);
            }
        }

        .copyright {
            position: absolute;
            bottom: 40px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 8px 20px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 3px;
            animation: copyrightFloat 5s ease-in-out infinite;
            z-index: 2;
        }

        @keyframes copyrightFloat {
            0%, 100% { 
                transform: translateY(0);
                opacity: 0.9;
            }
            50% { 
                transform: translateY(-5px);
                opacity: 1;
            }
        }

        /* Root variables for option sizing (canonical Kelime sizes; Dinle/Bosluk will inherit) */
        :root {
            --option-min-height: 56px;
            --option-padding-vertical: 12px;
            --option-padding-horizontal: 16px;
            --option-font-size: 1rem;
            --option-gap: 12px;
        }

        /* Normalize option/button sizing across game modes */
        .game-box .options .option,
        .game-box .options .flutter-option-btn,
        .option {
            min-height: var(--option-min-height);
            padding: var(--option-padding-vertical) var(--option-padding-horizontal);
            font-size: var(--option-font-size);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            box-sizing: border-box;
        }

        /* Slightly smaller font for Arabic options to avoid wrapping on narrow screens */
        .option.arabic-option {
            font-size: calc(var(--option-font-size) * 0.95);
        }

        /* ============ KONTEYNER ============ */
        .container {
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 30px;
            padding: 0;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            overflow: hidden;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 1;
            max-height: 100vh;
            overflow-y: auto;
            padding-top: 95px;
        }

        /* Scrollbar styling */
        .container::-webkit-scrollbar {
            width: 8px;
        }

        .container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }

        .container::-webkit-scrollbar-thumb {
            background: rgba(139, 69, 19, 0.3);
            border-radius: 10px;
        }

        .container::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 69, 19, 0.5);
        }

        /* ============ BAŞLIK ============ */
        .header {
            text-align: center;
            background: linear-gradient(135deg, #8B4513 0%, #D2691E 50%, #CD853F 100%);
            padding: 30px 20px 25px;
            color: white;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 1.7em;
            margin-bottom: 8px;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            letter-spacing: 0.5px;
        }

        .header h1::before {
            content: '✨ ';
        }

        .settings-btn {
            position: absolute;
            right: 15px;
            top: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 15px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* ============ ANA MENÜ ============ */
        .main-menu {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            padding: 0 15px 20px 15px;
        }

        .menu-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            color: #2c3e50;
            border: none;
            padding: 20px;
            border-radius: 20px;
            cursor: pointer;
            text-align: left;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            width: 100%;
            margin-bottom: 0;
            position: relative;
            overflow: hidden;
        }

        .menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.05) 0%, rgba(210, 105, 30, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .menu-item:hover::before {
            opacity: 1;
        }

        .menu-item:last-child {
            margin-bottom: 0;
        }

        .menu-item:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 30px rgba(139, 69, 19, 0.2);
        }

        .menu-item:active {
            transform: translateY(-2px) scale(1.01);
        }

        .menu-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
            position: relative;
            z-index: 1;
        }

        .menu-title {
            font-size: 1.15em;
            font-weight: 700;
            margin-bottom: 5px;
            color: #2c3e50;
            position: relative;
            z-index: 1;
        }

        .menu-desc {
            font-size: 0.85em;
            opacity: 0.8;
            line-height: 1.4;
            color: #6c757d;
            position: relative;
            z-index: 1;
        }

        /* ============ ÜST BUTONLAR ============ */
        .top-btn {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .top-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
            opacity: 1 !important;
        }

        .top-btn:active {
            transform: translateY(0);
        }

        /* ============ STATS BAR ============ */
        .header[style*="grid-template-columns"] {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px) !important;
            border: none !important;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05) !important;
            box-shadow: none !important;
            padding: 15px 10px !important;
            border-radius: 0 !important;
            margin-bottom: 0 !important;
        }

        .header[style*="grid-template-columns"] > div {
            gap: 4px !important;
        }

        .header[style*="grid-template-columns"] span {
            font-size: 1.5em !important;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .header[style*="grid-template-columns"] div[style*="font-size: 0.93em"] {
            font-weight: 700 !important;
            color: #2c3e50 !important;
        }

        /* ============ TOP NAVIGATION ============ */
        div[style*="display: flex; gap: 4px; margin-bottom: 8px"] {
            background: rgba(248, 249, 250, 0.8) !important;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05) !important;
            padding: 15px !important;
            gap: 6px !important;
        }

        div[style*="display: flex; gap: 4px; margin-bottom: 8px"] .top-btn {
            background: white !important;
            border: 2px solid transparent !important;
            border-radius: 12px !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
        }

        div[style*="display: flex; gap: 4px; margin-bottom: 8px"] .top-btn:hover {
            border-color: #8B4513 !important;
        }

        /* ============ DIFFICULTY BUTTONS ============ */
        div[style*="display: flex; gap: 2px; margin-bottom: 6px"] {
            background: linear-gradient(to bottom, rgba(248, 249, 250, 0.5), transparent) !important;
            padding: 15px 15px 10px !important;
            gap: 8px !important;
        }

        .diff-btn {
            border-radius: 15px !important;
            padding: 12px !important;
            font-size: 0.85em !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05) !important;
            transition: all 0.3s ease !important;
            border: 2px solid #e9ecef !important;
        }

        .diff-btn:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15) !important;
        }

        .diff-btn.active,
        #mainDiffOrta[style*="background: #FF9800"] {
            background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%) !important;
            border-color: #ffc107 !important;
        }

        /* ============ GAME MODE CARDS - MODERN GLASS MORPHISM ============ */
        .flutter-game-card {
            background: rgba(255, 255, 255, 0.25) !important;
            backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(255, 255, 255, 0.18) !important;
            border-radius: 20px !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
            position: relative !important;
            overflow: hidden !important;
            transform: translateY(0) !important;
        }

        .flutter-game-card:hover {
            transform: translateY(-8px) scale(1.02) !important;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15) !important;
            backdrop-filter: blur(25px) !important;
        }

        .flutter-game-card:active {
            transform: translateY(-4px) scale(0.98) !important;
        }

        /* Özel renk overlayleri */
        #kelimeCevirBtn::before {
            content: '' !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2) 0%, rgba(255, 179, 71, 0.1) 100%) !important;
            pointer-events: none !important;
            z-index: 1 !important;
        }

        #dinleBulBtn::before {
            content: '' !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.2) 0%, rgba(52, 152, 219, 0.1) 100%) !important;
            pointer-events: none !important;
            z-index: 1 !important;
        }

        #boslukDoldurBtn::before {
            content: '' !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.2) 0%, rgba(142, 68, 173, 0.1) 100%) !important;
            pointer-events: none !important;
            z-index: 1 !important;
        }

        #duaEtBtn::before {
            content: '' !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.2) 0%, rgba(39, 174, 96, 0.1) 100%) !important;
            pointer-events: none !important;
            z-index: 1 !important;
        }

        #ayetOkuBtn::before {
            content: '' !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            background: linear-gradient(135deg, rgba(241, 196, 15, 0.2) 0%, rgba(230, 126, 34, 0.1) 100%) !important;
            pointer-events: none !important;
            z-index: 1 !important;
        }

        #hadisOkuBtn::before {
            content: '' !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.2) 0%, rgba(192, 57, 43, 0.1) 100%) !important;
            pointer-events: none !important;
            z-index: 1 !important;
        }

        /* İçerik z-index ayarı */
        .flutter-game-card .game-card-icon,
        .flutter-game-card .game-card-title,
        .flutter-game-card .game-card-desc {
            position: relative !important;
            z-index: 2 !important;
        }

        /* Parlama efekti */
        .flutter-game-card::after {
            content: '' !important;
            position: absolute !important;
            top: -50% !important;
            left: -50% !important;
            width: 200% !important;
            height: 200% !important;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent) !important;
            transform: rotate(45deg) !important;
            transition: all 0.5s ease !important;
            opacity: 0 !important;
            z-index: 3 !important;
        }

        .flutter-game-card:hover::after {
            animation: shine 0.8s ease-in-out !important;
        }

        @keyframes shine {
            0% { 
                transform: translateX(-100%) translateY(-100%) rotate(45deg) !important;
                opacity: 0 !important;
            }
            50% { 
                opacity: 1 !important;
            }
            100% { 
                transform: translateX(100%) translateY(100%) rotate(45deg) !important;
                opacity: 0 !important;
            }
        }

        /* ============ MODE PANES FIX - prevent visual bleed/overlap ========= */
        /* Make mode panes opaque and higher in stacking order so translucent
           game cards underneath don't show through when a mode is active */
        .hadis-mode,
        .dinle-mode,
        .bosluk-mode,
        .mode-selector {
            position: relative;
            /* Put mode panes above bottom nav which uses z-index:1000 */
            z-index: 3000;
            background: rgba(255,255,255,0.98);
            border-radius: 14px;
            padding: 8px 8px 96px 8px; /* add bottom padding so Next button isn't covered */
            box-shadow: 0 12px 30px rgba(0,0,0,0.12);
        }

        /* Keep internal cards visually consistent */
        .hadis-card {
            background: rgba(255,255,255,1);
            backdrop-filter: none;
            border: 1px solid rgba(0,0,0,0.04);
        }

        /* Keep Next buttons in the document flow so they push content instead of floating
           above it. This prevents them from visually overlapping the option buttons. */
        #dinleNextBtn, #boslukNextBtn, #nextBtn {
            position: relative;
            width: 100%;
            display: none; /* shown by JS when needed */
            margin-top: 12px;
            box-sizing: border-box;
        }

        /* ============ BOTTOM NAVIGATION - MODERN GLASS MORPHISM ============ */
        .flutter-bottom-nav {
            position: fixed !important;
            bottom: 0 !important;
            left: 0 !important;
            right: 0 !important;
            z-index: 1000 !important;
            height: 70px !important;
            background: rgba(255, 255, 255, 0.15) !important;
            backdrop-filter: blur(30px) !important;
            border-top: 1px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 25px 25px 0 0 !important;
            box-shadow: 0 -15px 35px rgba(0, 0, 0, 0.1), 
                        0 -5px 15px rgba(0, 0, 0, 0.05) !important;
            display: flex !important;
            justify-content: space-around !important;
            align-items: center !important;
            padding: 0 20px !important;
            overflow: hidden !important;
        }

        /* Animated gradient overlay */
        .flutter-bottom-nav::before {
            content: '' !important;
            position: absolute !important;
            top: 0 !important;
            left: -100% !important;
            width: 100% !important;
            height: 100% !important;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent) !important;
            animation: navShimmer 3s infinite !important;
            pointer-events: none !important;
        }

        @keyframes navShimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .flutter-nav-item {
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            padding: 8px 12px !important;
            border-radius: 16px !important;
            cursor: pointer !important;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
            color: #666666 !important;
            text-decoration: none !important;
            min-width: 60px !important;
            position: relative !important;
            overflow: hidden !important;
            background: transparent !important;
        }

        .flutter-nav-item:hover {
            background: rgba(255, 255, 255, 0.2) !important;
            transform: translateY(-4px) scale(1.1) !important;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
            backdrop-filter: blur(15px) !important;
        }

        .flutter-nav-item:active {
            transform: translateY(-2px) scale(1.05) !important;
        }

        .flutter-nav-item.active {
            background: linear-gradient(135deg, 
                rgba(98, 0, 234, 0.2), 
                rgba(147, 112, 219, 0.1)) !important;
            color: #6200EA !important;
            backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(98, 0, 234, 0.3) !important;
        }

        /* Özel buton renkleri */
        .flutter-nav-item:nth-child(1) {
            color: #2196F3 !important;
        }

        .flutter-nav-item:nth-child(1):hover {
            background: linear-gradient(135deg, 
                rgba(33, 150, 243, 0.2), 
                rgba(33, 150, 243, 0.05)) !important;
            color: #1976D2 !important;
        }

        .flutter-nav-item:nth-child(2) {
            color: #4CAF50 !important;
        }

        .flutter-nav-item:nth-child(2):hover {
            background: linear-gradient(135deg, 
                rgba(76, 175, 80, 0.2), 
                rgba(76, 175, 80, 0.05)) !important;
            color: #388E3C !important;
        }

        .flutter-nav-item:nth-child(3) {
            color: #FFC107 !important;
        }

        .flutter-nav-item:nth-child(3):hover {
            background: linear-gradient(135deg, 
                rgba(255, 193, 7, 0.3), 
                rgba(255, 193, 7, 0.1)) !important;
            color: #F57C00 !important;
            transform: translateY(-6px) scale(1.15) !important;
        }

        .flutter-nav-item:nth-child(3):hover i {
            animation: trophy-glow 0.8s ease-in-out infinite !important;
            text-shadow: 0 0 15px rgba(255, 193, 7, 0.8) !important;
        }

        @keyframes trophy-glow {
            0%, 100% {
                transform: scale(1) !important;
                text-shadow: 0 0 15px rgba(255, 193, 7, 0.8) !important;
            }
            50% {
                transform: scale(1.2) !important;
                text-shadow: 0 0 25px rgba(255, 215, 0, 1), 
                            0 0 35px rgba(255, 215, 0, 0.8) !important;
            }
        }

        .flutter-nav-item:nth-child(4) {
            color: #FF6B6B !important;
        }

        .flutter-nav-item:nth-child(4):hover {
            background: linear-gradient(135deg, 
                rgba(255, 107, 107, 0.2), 
                rgba(255, 107, 107, 0.05)) !important;
            color: #E53935 !important;
        }

        .flutter-nav-item i {
            font-size: 24px !important;
            margin-bottom: 4px !important;
            transition: all 0.3s ease !important;
            position: relative !important;
            z-index: 2 !important;
        }

        .flutter-nav-item span {
            font-size: 12px !important;
            font-weight: 600 !important;
            text-align: center !important;
            position: relative !important;
            z-index: 2 !important;
        }

        /* Ripple efekti */
        .flutter-nav-item::after {
            content: '' !important;
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            width: 0 !important;
            height: 0 !important;
            background: rgba(255, 255, 255, 0.4) !important;
            border-radius: 50% !important;
            transform: translate(-50%, -50%) !important;
            transition: width 0.4s ease, height 0.4s ease !important;
            pointer-events: none !important;
        }

        .flutter-nav-item:active::after {
            width: 80px !important;
            height: 80px !important;
        }

        /* ============ GAME SCREEN ============ */
        .game-screen {
            padding: 20px 15px;
        }

        /* ============ GERİ BUTONU ============ */
        .back-btn {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 249, 250, 0.9) 100%);
            color: #6200EA;
            border: 2px solid rgba(98, 0, 234, 0.2);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 10px;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .back-btn .material-icons {
            font-size: 18px;
        }

        .back-btn:hover {
            background: rgba(98, 0, 234, 0.1);
            transform: translateX(-2px);
            box-shadow: 0 3px 10px rgba(98, 0, 234, 0.2);
            border-color: #6200EA;
            color: #6200EA;
        }

        .back-btn:active {
            transform: translateX(-1px) scale(0.95);
        }

        /* ============ MOD SEÇİCİ ============ */
        .mode-selector {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .mode-selector h3 {
            color: #2D5F3F;
            margin: 15px 0 10px 0;
            font-size: 1.1em;
        }

        .mode-btn, .diff-btn {
            display: block;
            width: 100%;
            background: white;
            border: 3px solid #ddd;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s ease;
            position: relative;
        }

        .mode-btn:hover, .diff-btn:hover {
            border-color: #2D5F3F;
            transform: translateX(5px);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #2D5F3F 0%, #1E4D7B 100%);
            color: white;
            border-color: #2D5F3F;
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(45, 95, 63, 0.3);
        }
        
        .diff-btn.active {
            /* Renk JavaScript'te ayarlanıyor */
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .mode-btn.active::after, .diff-btn.active::after {
            content: '';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5em;
            font-weight: bold;
        }

        .mode-btn strong, .diff-btn strong {
            display: block;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .mode-btn small, .diff-btn small {
            display: block;
            opacity: 0.8;
        }

        .start-btn {
            width: 100%;
            background: #F4C430;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }

        .start-btn:active {
            background: #d4a820;
        }

        /* ============ OYUN BİLGİSİ ============ */
        .game-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            padding: 12px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 249, 250, 0.95) 100%);
            border-radius: 15px;
            font-size: 0.9em;
            color: #2c3e50;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(10px);
        }

        .game-info div {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* ============ İSTATİSTİKLER ============ */
        .stats {
            display: flex;
            justify-content: space-between;
            gap: 6px;
            margin-bottom: 12px;
        }

        .stat {
            flex: 1;
            background: linear-gradient(135deg, #8B4513 0%, #D2691E 100%);
            color: white;
            padding: 8px 6px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(139, 69, 19, 0.15);
            transition: all 0.3s ease;
        }

        .stat:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.25);
        }

        .stat-label {
            font-size: 0.6em;
            opacity: 0.9;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .stat-value {
            font-size: 1.2em;
            font-weight: 700;
            margin-top: 2px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        /* ============ OYUN ALANI - MODERN GLASS MORPHISM ============ */
        .game-box {
            background: rgba(255, 255, 255, 0.15) !important;
            backdrop-filter: blur(25px) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 25px !important;
            /* Restore original padding so no visible bottom strip appears before the button shows */
            padding: 25px 20px !important;
            margin-bottom: 20px !important;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1), 
                        0 5px 15px rgba(0, 0, 0, 0.05),
                        inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
            position: relative !important;
            /* Keep overflow hidden to avoid stray visuals; next button will be positioned fixed */
            overflow: hidden !important;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
            animation: gameBoxFloat 6s ease-in-out infinite !important;
        }

        /* Normalize game-box sizing across modes so Dinle/Bosluk match Kelime layout
           and content appears higher on the screen (prevents content from being pushed
           too far down on smaller viewports). Responsive: uses a sensible min-height. */
        .game-screen .game-box,
        .dinle-mode .game-box,
        .bosluk-mode .game-box {
            /* Bosluk oyununda ayet metni yer kaplayabilir; azaltılmış padding ve
               daha alçak min-height ile içeriği yukarı çekiyoruz */
            min-height: 420px;
            padding-top: 10px;
            padding-bottom: 12px;
        }
        .game-screen .game-box,
        .dinle-mode .game-box {
            min-height: 480px;
            padding-top: 12px;
            padding-bottom: 18px;
        }

        /* Reduce the large top margin used for dinle-mode icon container so the
           visual icon doesn't push content down unnecessarily. */
        .dinle-mode .game-box > div:first-child {
            margin: 12px 0;
        }

        /* Bosluk: küçük üst boşluk ve ayet metni marjinlerini küçült */
        .bosluk-mode .game-box .arabic,
        .bosluk-mode .game-box .arabic-large {
            margin: 8px 0;
            line-height: 1.25;
            /* Make ayet text a bit smaller in the Bosluk (fill-the-gap) mode so long
               ayets don't push the option containers and Next button off the screen. */
            font-size: 22px;
            padding: 6px 8px;
        }
        .bosluk-mode .game-box .options {
            margin-top: 10px;
        }

        /* Prevent very long ayets from pushing controls off-screen: limit the
           height of the Bosluk game-box to the viewport minus header/nav so the
           content becomes scrollable instead of overflowing the visible area. */
        .bosluk-mode .game-box {
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            /* slightly reduce vertical padding on small screens */
            padding-bottom: 12px;
        }

        .game-box:hover {
            transform: translateY(-5px) scale(1.02) !important;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15), 
                        0 10px 25px rgba(0, 0, 0, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 0.4) !important;
            backdrop-filter: blur(30px) !important;
        }

        /* ===== Canonical game layout (use Bosluk's layout/style across all modes) ===== */
        /* Apply Bosluk-style question placement, option containers, feedback and Next button
           to all .game-box instances so Kelime and Dinle match the same UX. */
        .game-box {
            background: rgba(255,255,255,0.98);
            border-radius: 14px;
            padding: 18px;
            margin: 10px 0;
            box-shadow: 0 12px 30px rgba(0,0,0,0.06);
            display: flex;
            flex-direction: column;
        }

        .game-box .arabic,
        .game-box .arabic-large,
        .game-box .arabic-text,
        .game-box #arabicWord,
        .game-box #boslukAyetText {
            text-align: center;
            margin: 12px 0 8px 0;
            font-size: 22px;
            line-height: 1.4;
            padding: 6px 8px;
        }

        /* Center the audio/hint icons under the question like Bosluk */
        .game-box .audio-btn,
        .game-box .hint-btn {
            display: block;
            margin: 12px auto;
        }

        /* Options container: centered, constrained width and stacked vertically */
        .game-box .options {
            width: 100%;
            max-width: 760px;
            margin: 12px auto 6px auto;
            display: flex;
            flex-direction: column;
            gap: var(--option-gap, 12px);
        }

        /* Ensure Next/primary buttons inside game-box follow Bosluk sizing */
        .game-box > .flutter-btn,
        .game-box button.flutter-btn,
        .game-box #nextBtn,
        .game-box #dinleNextBtn,
        .game-box #boslukNextBtn {
            width: 100%;
            margin-top: 12px;
            box-sizing: border-box;
            border-radius: 10px;
        }

        /* Feedback area consistent placement */
        .game-box .feedback {
            margin-top: 8px;
        }

        @keyframes gameBoxFloat {
            0%, 100% { 
                transform: translateY(0) rotateX(0deg);
            }
            50% { 
                transform: translateY(-3px) rotateX(0.5deg);
            }
        }

        /* Game box shimmer effect */
        .game-box::before {
            content: '' !important;
            position: absolute !important;
            top: -50% !important;
            left: -50% !important;
            width: 200% !important;
            height: 200% !important;
            background: linear-gradient(45deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent) !important;
            transform: rotate(45deg) !important;
            animation: gameBoxShimmer 8s linear infinite !important;
            pointer-events: none !important;
        }

        @keyframes gameBoxShimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .sure-info {
            text-align: center;
            color: #999;
            font-size: 0.65em;
            margin: -3px 0 8px 0;
            font-family: 'Courier New', monospace;
            opacity: 0.7;
        }

        .arabic {
            font-size: 32px;
            text-align: center;
            color: #8B4513;
            font-weight: bold;
            margin: 15px 0;
            direction: rtl;
            font-family: 'Uthmani', 'Traditional Arabic', 'Arabic Typesetting', serif;
            font-weight: 400;
            line-height: 1.6;
            letter-spacing: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            padding: 12px;
            background: rgba(139, 69, 19, 0.03);
            border-radius: 12px;
        }

        /* ============ BUTON SIRASI ============ */
        .button-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 8px;
        }

        /* ============ SES BUTONU ============ */
        .audio-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            margin: 0;
            background: transparent;
            border: none;
            border-radius: 0;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: none;
            background-image: url('hoparlor.png');
            background-size: 100%;
            background-repeat: no-repeat;
            background-position: center;
        }

        .audio-btn:hover {
            transform: scale(1.15) translateY(-2px);
        }

        .audio-btn:active {
            transform: scale(0.95);
        }

        /* ============ İPUCU BUTONU ============ */
        .hint-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            margin: 0;
            background: transparent;
            border: none;
            border-radius: 0;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: none;
            filter: contrast(1.3) brightness(1.1);
            background-image: url('clue.png');
            background-size: 100%;
            background-repeat: no-repeat;
            background-position: center;
        }

        .hint-btn:hover {
            transform: scale(1.1) translateY(-2px);
            filter: contrast(1.4) brightness(1.2);
        }

        .hint-btn:active {
            transform: scale(0.95);
        }

        .hint-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* ============ SEÇENEKLER - MODERN GLASS MORPHISM ============ */
        :root {
            /* Centralized option sizing for consistent look across modes */
            --option-max-width: 760px;
            --option-gap: 12px;
            --option-padding-vertical: 16px;
            --option-padding-horizontal: 16px;
            --option-font-size: 16px;
            /* Increase slightly to accommodate larger Arabic glyph metrics */
            --option-min-height: 72px;
            --option-radius: 18px;
            --option-bg: rgba(255, 255, 255, 0.18);
            --option-border: rgba(255, 255, 255, 0.25);
            /* Arabic-specific size (can be tuned) */
            --option-arabic-font-size: 22px;
            /* Next button canonical height used for spacing on small screens */
            --next-height: 64px;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: var(--option-gap);
            margin: 15px 0;
            width: 100%;
            max-width: var(--option-max-width);
            margin-left: auto;
            margin-right: auto;
            box-sizing: border-box;
        }

        /* Canonical option style applied to all modes. Use variables above
           so changing the canonical Kelime size propagates to Dinle & Bosluk. */
    .option {
            background: var(--option-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--option-border);
            border-radius: var(--option-radius);
            padding: var(--option-padding-vertical) var(--option-padding-horizontal);
            font-size: var(--option-font-size);
            cursor: pointer;
            text-align: center;
            transition: all 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08),
                        0 3px 10px rgba(0, 0, 0, 0.04),
                        inset 0 1px 0 rgba(255, 255, 255, 0.25);
            font-weight: 600;
            color: #2c3e50;
            line-height: 1.4;
            position: relative;
            overflow: hidden;
            width: 100%;
            box-sizing: border-box;
            min-height: var(--option-min-height);
            /* vertically center contents so different line-heights don't change visual height */
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: normal;
            word-break: break-word;
        }

        .option:hover {
            /* Reduce hover lift to avoid visual overlap on small screens */
            transform: translateY(-2px) scale(1.01);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12), 
                        0 4px 12px rgba(0, 0, 0, 0.08),
                        inset 0 1px 0 rgba(255, 255, 255, 0.35);
            backdrop-filter: blur(22px);
            border-color: rgba(255, 255, 255, 0.36);
            background: rgba(255, 255, 255, 0.24);
        }

        /* Hover için haptic feedback tetikleme */
        .option:hover::before {
            content: '' !important;
        }

        .option:active {
            transform: translateY(-2px) scale(0.98) !important;
        }

        /* Option button ripple effect */
        .option::after {
            content: '' !important;
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            width: 0 !important;
            height: 0 !important;
            background: rgba(255, 255, 255, 0.4) !important;
            border-radius: 50% !important;
            transform: translate(-50%, -50%) !important;
            transition: width 0.4s ease, height 0.4s ease !important;
            pointer-events: none !important;
        }

        .option:active::after {
            width: 200px !important;
            height: 200px !important;
        }

        /* Arapça seçenekler için modern glass morphism stil */
        .option.arabic-option {
            /* Keep Arabic styling but use shared sizing/padding so height matches other modes */
            font-size: var(--option-arabic-font-size);
            font-family: 'Uthmani', 'Traditional Arabic', 'Arabic Typesetting', serif;
            direction: ltr;
            text-align: center;
            font-weight: 600;
            /* reduce line-height so it fits within the canonical min-height while remaining readable */
            line-height: 1.35;
            color: #1a365d;
            background: linear-gradient(135deg, 
                        rgba(255, 215, 0, 0.25), 
                        rgba(173, 216, 230, 0.25),
                        rgba(255, 182, 193, 0.15));
            border: 2px solid rgba(255, 215, 0, 0.4);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: relative;
            /* ensure Arabic buttons use the same padding so box heights line up */
            padding: var(--option-padding-vertical) var(--option-padding-horizontal);
        }

        .option.arabic-option:hover {
            background: linear-gradient(135deg, 
                        rgba(255, 215, 0, 0.35), 
                        rgba(173, 216, 230, 0.35),
                        rgba(255, 182, 193, 0.25)) !important;
            border-color: rgba(255, 215, 0, 0.6) !important;
            text-shadow: 0 2px 8px rgba(255, 215, 0, 0.4) !important;
            color: #0f2a44 !important;
        }

        /* Arapça seçeneklerdeki metin için RTL */
        .option.arabic-option span[style*="direction: rtl"] {
            font-family: 'Uthmani', 'Traditional Arabic', 'Arabic Typesetting', serif !important;
            position: relative !important;
            z-index: 2 !important;
        }

        .option.correct {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border-color: #4CAF50;
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .option.wrong {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            border-color: #f44336;
            color: white;
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.4);
        }

        .option:disabled {
            cursor: default;
            opacity: 0.7;
        }

        /* ============ ARAPÇA HAREKE RENKLERİ ============ */
        /* Arapça hareke karakterleri için kırmızı renk */
        .arabic-text,
        .option.arabic-option,
        .arabic-text span,
        [style*="direction: rtl"] {
            background: linear-gradient(
                to right,
                transparent 0%,
                transparent 100%
            );
            background-size: 100% 100%;
        }

        /* Unicode hareke karakterleri için kırmızı renk */
        .arabic-text::after,
        .option.arabic-option::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* Arapça metinlerdeki hareke karakterleri */
        .arabic-text,
        .option.arabic-option,
        [dir="rtl"],
        [style*="direction: rtl"] {
            position: relative;
        }

        /* Arapça metinleri kömür karası renkte yapmak için CSS - Altın sarısı hariç */
        .arabic-text,
        .arabic-large,
        .hadis-arabic,
        .option.arabic-option,
        [dir="rtl"],
        [style*="direction: rtl"],
        .arabic:not(:has(.golden-highlight)),
        [class*="arabic"]:not(:has(.golden-highlight)) {
            color: #2C2C2C !important;
        }
        
        /* Altın sarısı içeren elementlerin çocukları için özel kural */
        .arabic .golden-highlight,
        [class*="arabic"] .golden-highlight {
            color: #FFD700 !important;
        }

        /* Hareke karakterleri için özel stil - Unicode aralığı */
        .arabic-text:has-text([\u064B-\u065F]),
        .option.arabic-option:has-text([\u064B-\u065F]) {
            background-image: linear-gradient(
                to right,
                #2c3e50 0%,
                #e74c3c 0%
            );
            -webkit-background-clip: text;
            background-clip: text;
        }

        /* Boşluk doldur oyununda doğru kelimenin altın sarısı vurgusu - Çok yüksek öncelik */
        .golden-highlight,
        span.golden-highlight,
        div span.golden-highlight,
        .arabic span.golden-highlight,
        [class*="arabic"] span.golden-highlight {
            color: #FFD700 !important;
            font-weight: bold !important;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.8) !important;
            background-color: rgba(255, 215, 0, 0.1) !important;
            padding: 0 2px !important;
            border-radius: 2px !important;
            font-family: 'KFGQPC Uthmanic Script HAFS Regular', 'Amiri', 'Scheherazade New', 'Traditional Arabic', serif !important;
        }

        /* JavaScript ile hareke renklerini işleyeceğiz */
        .hareke-red {
            color: #e74c3c !important;
        }

        /* ============ GERİ BİLDİRİM ============ */
        /* FEEDBACK - MODERN GLASS MORPHISM */
        .feedback {
            text-align: center !important;
            font-size: 18px !important;
            font-weight: 700 !important;
            min-height: 50px !important;
            margin: 20px 0 !important;
            padding: 18px 25px !important;
            border-radius: 20px !important;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
            background: rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(15px) !important;
            border: 2px solid rgba(255, 255, 255, 0.2) !important;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
            position: relative !important;
            overflow: hidden !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }

        .feedback.correct {
            color: #00695c !important;
            background: linear-gradient(135deg, 
                        rgba(76, 175, 80, 0.25), 
                        rgba(129, 199, 132, 0.25)) !important;
            border-color: rgba(76, 175, 80, 0.4) !important;
            box-shadow: 0 15px 30px rgba(76, 175, 80, 0.2),
                        0 5px 15px rgba(0, 0, 0, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
            animation: feedbackPulse 0.6s ease-out !important;
        }

        .feedback.wrong {
            color: #c62828 !important;
            background: linear-gradient(135deg, 
                        rgba(244, 67, 54, 0.25), 
                        rgba(239, 83, 80, 0.25)) !important;
            border-color: rgba(244, 67, 54, 0.4) !important;
            box-shadow: 0 15px 30px rgba(244, 67, 54, 0.2),
                        0 5px 15px rgba(0, 0, 0, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
            animation: feedbackShake 0.6s ease-out !important;
        }

        @keyframes feedbackPulse {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes feedbackShake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }

        /* 🎆 SUCCESS ANIMATIONS - CONFETTI & PARTICLES */
        .confetti-container {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            pointer-events: none !important;
            z-index: 9999 !important;
            overflow: hidden !important;
        }

        .confetti-piece {
            position: absolute !important;
            width: 10px !important;
            height: 10px !important;
            background: #ff6b6b !important;
            animation: confettiFall 3s ease-out forwards !important;
        }

        .confetti-piece:nth-child(2n) { background: #4ecdc4 !important; }
        .confetti-piece:nth-child(3n) { background: #45b7d1 !important; }
        .confetti-piece:nth-child(4n) { background: #f9ca24 !important; }
        .confetti-piece:nth-child(5n) { background: #6c5ce7 !important; }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg) !important;
                opacity: 1 !important;
            }
            100% {
                transform: translateY(100vh) rotate(720deg) !important;
                opacity: 0 !important;
            }
        }

        .success-burst {
            animation: successBurst 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
        }

        @keyframes successBurst {
            0% { transform: scale(1); }
            30% { transform: scale(1.3); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* ============ SONRAKİ BUTON ============ */
        .next-btn {
            display: none;
            width: 100%;
            background: linear-gradient(135deg, #8B4513 0%, #D2691E 100%);
            color: white;
            border: 2px solid rgba(139, 69, 19, 0.3);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85em;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(139, 69, 19, 0.2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.3);
        }

        .next-btn:active {
            transform: translateY(0);
        }

        /* ============ AYET & DUA MODLARI ============ */
        .ayet-card, .dua-card {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
        }

        .translation {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: #333;
            font-size: 1.1em;
            line-height: 1.6;
            text-align: center;
        }

        .pronunciation {
            background: #E3F2FD;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: #1565C0;
            font-size: 1em;
            font-style: italic;
            text-align: center;
        }

        .dua-title {
            text-align: center;
            color: #2D5F3F;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .navigation-btns {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .nav-btn {
            flex: 1;
            background: #2D5F3F;
            color: white;
            border: none;
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 500;
        }

        .nav-btn:active {
            background: #1d3f2f;
        }

        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* ============ DUA KATEGORİLERİ ============ */
        .dua-categories {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .category-btn {
            background: white;
            border: 2px solid #2D5F3F;
            color: #2D5F3F;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s;
        }

        .category-btn:active {
            background: #2D5F3F;
            color: white;
        }

        /* ============ HADİS KARTI ============ */
        .hadis-card {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
        }

        .hadis-category {
            background: #2D5F3F;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            display: inline-block;
            margin-bottom: 10px;
        }

        .hadis-title {
            color: #2D5F3F;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .hadis-header {
            background: #E3F2FD;
            padding: 10px;
            border-radius: 8px;
            color: #1565C0;
            font-size: 0.95em;
            margin-bottom: 15px;
        }

        .hadis-text {
            background: white;
            padding: 15px;
            border-radius: 10px;
            line-height: 1.8;
            color: #333;
            margin-bottom: 15px;
            text-align: justify;
        }

        .hadis-ref {
            background: #FFF3E0;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85em;
            color: #E65100;
            margin-bottom: 15px;
        }

        /* ============ FİLTRE BUTONLARI ============ */
        .filter-btn {
            transition: all 0.3s ease;
        }
        
        .filter-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .filter-btn.active {
            background: #3498db !important;
            transform: scale(1.05);
        }

        /* ============ MODAL ============ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 40px 30px;
            border-radius: 25px;
            text-align: center;
            width: 85%;
            max-width: 350px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.5);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal h2 {
            color: #8B4513;
            font-size: 2.2em;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .modal p {
            font-size: 1.1em;
            margin-bottom: 20px;
            color: #2c3e50;
            line-height: 1.6;
        }

        .modal-btn {
            width: 100%;
            background: linear-gradient(135deg, #F4C430 0%, #FFD700 100%);
            border: 2px solid rgba(244, 196, 48, 0.3);
            padding: 15px;
            border-radius: 15px;
            font-size: 1em;
            cursor: pointer;
            font-weight: 700;
            color: #2c3e50;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(244, 196, 48, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(244, 196, 48, 0.5);
        }

        .modal-btn:active {
            transform: translateY(0);
        }

        /* ============ ÖZEL ONAY POP-UP ============ */
        .custom-confirm {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .confirm-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 35px 25px;
            border-radius: 20px;
            text-align: center;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.6);
            border: 2px solid rgba(255, 215, 0, 0.3);
            animation: confirmFadeIn 0.4s ease;
        }

        @keyframes confirmFadeIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(30px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .confirm-title {
            color: #FFD700;
            font-size: 1.8em;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .confirm-stats {
            background: rgba(255, 215, 0, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .confirm-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
            color: white;
            font-size: 1.1em;
        }

        .confirm-message {
            color: #b8c5d6;
            font-size: 1em;
            margin: 15px 0;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .confirm-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .confirm-btn.ok {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }

        .confirm-btn.ok:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.5);
        }

        .confirm-btn.cancel {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.4);
        }

        .confirm-btn.cancel:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(149, 165, 166, 0.5);
        }

        /* ============ MOBİL RESPONSİVE ============ */
        @media (max-width: 768px) {
            /* Ana container */
            .container {
                padding: 10px;
                max-width: 100%;
            }

            /* Üst bar küçük ekranlar için */
            .header {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                padding: 10px;
                margin-bottom: 15px;
            }

            /* Oyun kutusu mobil için */
            .game-box {
                padding: 15px;
                margin: 10px 0;
            }

            /* Arapça font mobilde daha büyük */
            .arabic {
                font-size: 34px;  /* Daha büyük boyut */
                margin: 20px 0;
                line-height: 1.6;
            }

            /* Seçenekler mobilde daha rahat */
            .options {
                gap: 8px;  /* Mobilde biraz daha fazla boşluk */
                max-width: 680px;
                margin-left: auto;
                margin-right: auto;
            }

            .option {
                font-size: 18px;  /* Daha büyük */
                padding: 18px 16px;
                margin: 0;  /* Gap kullandığımız için margin kaldırıldı */
                min-height: 60px;
            }

            /* Mobilde Arapça seçenekler */
            .option.arabic-option {
                font-size: 24px;
            }

            /* Butonlar mobilde daha büyük */
            .audio-btn, .hint-btn, .next-btn {
                padding: 15px;
                font-size: 1em;
                margin: 12px 0;
            }

            /* ===== Mobile: make game area fit viewport and keep controls visible =====
               Approach:
               - Make .game-box a column flex container sized to the viewport height
               - Let the Arabic/question area grow and scroll if it's long
               - Keep .options and Next button non-scrolling (sticky) so they remain visible */
            .game-box {
                display: flex;
                flex-direction: column;
                /* Reserve space for header/nav (approx). This keeps the game-box within the viewport */
                height: calc(100vh - 120px);
                /* On mobile make the game-box the scroll container so sticky positioning
                   of the Next button works reliably across modes. Remove !important and
                   rely on more specific mode-scoped selectors below instead. */
                overflow: auto;
            }

            /* Make the Arabic/question elements flexible and scrollable when content is long */
            .game-box > .arabic,
            .game-box > .arabic-text,
            .game-box > .arabic-large {
                flex: 1 1 auto;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                padding-right: 6px; /* avoid text touching the edge when scrolled */
            }

            /* Generic rule: any direct child of .game-box that isn't the options,
               feedback, or the specific Next buttons should become the scrollable
               content area. This handles modes with slightly different markup
               (e.g., Kelime) so options are not pushed off-screen. */
            .game-box > *:not(.options):not(.feedback):not(#nextBtn):not(#dinleNextBtn):not(#boslukNextBtn) {
                flex: 1 1 auto;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            /* Keep options and feedback area fixed at the bottom of the game-box flow */
            .game-box .options,
            .game-box .feedback {
                flex: 0 0 auto;
            }

            /* Make the options container scrollable on small screens so long option lists
               do not get clipped. This keeps every option reachable and preserves the
               sticky Next button visibility. */
            .game-box .options {
                /* Give more vertical space for options so 4th choice is visible on most phones */
                max-height: calc(50vh);
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                padding-right: 6px;
            }

            /* Make the Next button sticky inside the game-box so it is always reachable */
            /* More permissive and higher-priority sticky rules that explicitly
               include the mode-specific Next buttons. Use !important to override
               any inline or other competing rules so the button remains visible. */
            /* Mode-scoped sticky rules: higher specificity so we can remove !important
               and avoid global overrides. These ensure the Next buttons remain sticky
               inside the active mode without floating over other UI. */
            .hadis-mode .game-box > .flutter-btn,
            .hadis-mode .game-box > button.flutter-btn,
            .hadis-mode .game-box #nextBtn,
            .hadis-mode .game-box #dinleNextBtn,
            .hadis-mode .game-box #boslukNextBtn,
            .dinle-mode .game-box > .flutter-btn,
            .dinle-mode .game-box > button.flutter-btn,
            .dinle-mode .game-box #nextBtn,
            .dinle-mode .game-box #dinleNextBtn,
            .dinle-mode .game-box #boslukNextBtn,
            .bosluk-mode .game-box > .flutter-btn,
            .bosluk-mode .game-box > button.flutter-btn,
            .bosluk-mode .game-box #nextBtn,
            .bosluk-mode .game-box #dinleNextBtn,
            .bosluk-mode .game-box #boslukNextBtn {
                position: sticky;
                bottom: calc(env(safe-area-inset-bottom, 0px) + 12px);
                z-index: 4000; /* ensure it sits above bottom nav and overlays */
                margin-top: 8px;
            }

            /* Reserve space inside the game-box for the sticky Next button so the last
               option is not hidden behind it */
            .game-box {
                /* Reserve more space for the sticky Next button on mobile */
                --next-height: 80px;
                padding-bottom: calc(var(--next-height) + env(safe-area-inset-bottom, 12px));
            }

            /* Modal mobilde tam ekran */
            .modal-content {
                max-width: 95%;
                max-height: 95vh;
                margin: 10px auto;
                padding: 20px;
            }

            /* İstatistikler grid mobilde */
            .stats {
                gap: 8px;
                grid-template-columns: 1fr 1fr 1fr;
            }

            .stat {
                padding: 8px;
            }

            /* Ana menü butonları mobilde */
            .main-btn {
                padding: 18px;
                font-size: 1em;
                margin: 8px 0;
            }
        }

        @media (max-width: 480px) {
            /* Çok küçük ekranlar için */
            .arabic {
                font-size: 30px;  /* Daha büyük boyut */
                margin: 25px 0;
            }

            .options {
                gap: 8px;  /* Daha kompakt */
                max-width: 600px;
                margin-left: auto;
                margin-right: auto;
            }

            .option {
                font-size: 16px;  /* Daha uygun boyut */
                padding: 16px 12px;
                min-height: 56px;
            }

            /* Küçük ekranlarda Arapça seçenekler */
            .option.arabic-option {
                font-size: 20px;
            }

            .header {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .main-btn {
                padding: 20px;
                font-size: 1.1em;
            }

            /* Stats daha kompakt */
            .stats {
                grid-template-columns: 1fr 1fr;
                gap: 5px;
            }

            /* Modal çok küçük ekranlarda */
            .modal-content {
                max-width: 98%;
                padding: 15px;
            }
        }

        /* ============ ANİMASYONLAR ============ */
        @keyframes pulse {
            0% { 
                box-shadow: 0 0 8px rgba(52,152,219,0.5); 
                transform: scale(1); 
            }
            50% { 
                box-shadow: 0 0 16px rgba(52,152,219,0.7); 
                transform: scale(1.02); 
            }
            100% { 
                box-shadow: 0 0 8px rgba(52,152,219,0.5); 
                transform: scale(1); 
            }
        }

        /* ⚡ SPEED ANIMATIONS - ULTRA FAST TRANSITIONS */
        .speed-fade-in {
            animation: speedFadeIn 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
        }

        .speed-slide-up {
            animation: speedSlideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
        }

        .speed-zoom-in {
            animation: speedZoomIn 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;
        }

        .speed-bounce-in {
            animation: speedBounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;
        }

        @keyframes speedFadeIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        @keyframes speedSlideUp {
            0% { transform: translateY(100px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        @keyframes speedZoomIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes speedBounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* GPU hızlandırması için animasyonlu elementler */
        [style*="animation"] {
            will-change: transform, box-shadow;
            transform: translateZ(0); /* Hardware acceleration trigger */
        }

        /* 📱 HAPTIC FEEDBACK SUPPORT */
        .haptic-light { --haptic-intensity: 'light'; }
        .haptic-medium { --haptic-intensity: 'medium'; }
        .haptic-heavy { --haptic-intensity: 'heavy'; }

        /* Performans optimizasyonu */
        * {
            scroll-behavior: auto !important; /* Smooth scroll'u devre dışı bırak */
        }

    /* gestures removed per cleanup: swipe handlers intentionally disabled */

        body {
            overflow-anchor: auto; /* Chrome'da scroll anchor'ı optimize et */
        }
        
        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
            to {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
        }
        
        @keyframes comboPopIn {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @keyframes comboShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }
        
        @keyframes correctPulse {
            0% { 
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 0 20px rgba(34, 197, 94, 0);
                transform: scale(1.05);
            }
            100% { 
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
                transform: scale(1);
            }
        }
        
        @keyframes wrongShake {
            0%, 100% { 
                transform: translateX(0);
            }
            10%, 30%, 50%, 70%, 90% { 
                transform: translateX(-8px);
            }
            20%, 40%, 60%, 80% { 
                transform: translateX(8px);
            }
        }
    </style>
</head>
<body>
    <!-- Loading Sayfası -->
    <div class="loading-screen" id="loadingScreen">
        <img src="icon-512-v4-RED-MUSHAF.png" alt="Hasene Logo" class="loading-logo">
        
        <div class="loading-title">HASENE</div>
        
        <div class="hadis-box">
            <div class="hadis-arabic">
                مَنْ قَرَأَ حَرْفًا مِنْ كِتَابِ اللَّهِ فَلَهُ بِهِ حَسَنَةٌ وَالْحَسَنَةُ بِعَشْرِ أَمْثَالِهَا
            </div>
            <div class="hadis-turkish">
                "Kim Allah'ın kitabından bir harf okursa, ona bir sevap verilir. O sevap da on mislidir."
                <br><small style="opacity: 0.7; font-size: 13px; margin-top: 10px; display: block;">(Tirmizi, Sevâbü'l-Kur'ân 16)</small>
            </div>
        </div>
        
        <div class="loading-spinner"></div>
        <div class="loading-text">Yükleniyor...</div>
        
        <div class="copyright">© YZOKUMUS 2025</div>
    </div>

    <div class="container" id="mainContainer" style="display: none;">




        <!-- Ana Menü -->
        <div class="main-menu" id="mainMenu">


            <!-- Günlük Hedef Progress Bar -->
            <div class="daily-goal-section">
                <!-- Kompakt Panel -->
                <div style="background: linear-gradient(135deg, rgba(102,126,234,0.08), rgba(118,75,162,0.08)); border-radius: 0; padding: 12px; margin: 0; position: relative;">
                    <!-- Hedef Butonu -->
                    <button onclick="showDailyGoalSettings()" style="position: absolute; top: 8px; right: 8px; background: #667eea; border: none; border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                        <span style="font-size: 16px;">🎯</span>
                    </button>
                    
                    <!-- Stats - İslami Terminoloji -->
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 12px; padding-right: 32px;">
                        <div style="text-align: center;">
                            <div style="color: #FF8F00; font-weight: 700; font-size: 16px;" id="gamePoints">0</div>
                            <div style="color: rgba(0,0,0,0.6); font-size: 10px; font-weight: 600;">HASENE</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: #FFC107; font-weight: 700; font-size: 16px;" id="starPoints">0</div>
                            <div style="color: rgba(0,0,0,0.6); font-size: 10px; font-weight: 600;">YILDIZ</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: #9C27B0; font-weight: 700; font-size: 16px;" id="playerLevel">1. Mertebe</div>
                            <div style="color: rgba(0,0,0,0.6); font-size: 10px; font-weight: 600;">MERTEBE</div>
                        </div>
                    </div>
                    
                    <!-- Progress -->
                    <div style="background: rgba(0,0,0,0.1); height: 6px; border-radius: 3px; overflow: hidden;">
                        <div id="dailyGoalProgress" style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: 0%; transition: width 0.5s;"></div>
                    </div>
                    <div style="text-align: center; margin-top: 4px; color: rgba(0,0,0,0.6); font-size: 10px; font-weight: 600;">
                        <span id="dailyGoalText">Günlük Vird: 2700 Hasene</span> • <span id="dailyGoalProgressText">0 / 2700 Hasene</span>
                    </div>
                </div>
            </div>

            
            <!-- Hasene Bilgi Butonu -->
            <div style="margin: 0 20px 3px 20px;">
                <button id="xpInfoBtn" style="width: 100%; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white; border: none; border-radius: 8px; padding: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; box-shadow: 0 2px 6px rgba(251,191,36,0.3); transition: all 0.3s; font-weight: 600; font-size: 0.8em;">
                    <span style="font-size: 1em;">📿</span>
                    <div>Hasene Nasıl Kazanılır?</div>
                    <span style="font-size: 0.8em;">ℹ️</span>
                </button>
            </div>
            
            <!-- Zorluk Butonları -->
            <div style="display: flex; gap: 2px; margin: 0 20px 3px 20px; flex-wrap: nowrap; justify-content: center;">
                <button class="diff-btn" id="mainDiffKolay" style="flex: 1; min-width: 60px; max-width: 85px; margin: 0; padding: 4px; font-size: 0.7em; background: white; color: #4CAF50; border: 1px solid #4CAF50; border-radius: 5px;">
                    <strong>🌱 Kolay</strong>
                </button>
                <button class="diff-btn active" id="mainDiffOrta" style="flex: 1; min-width: 60px; max-width: 85px; margin: 0; padding: 4px; font-size: 0.7em; background: #FF9800; color: white; border: 1px solid #FF9800; border-radius: 5px;">
                    <strong>⚖️ Orta</strong>
                </button>
                <button class="diff-btn" id="mainDiffZor" style="flex: 1; min-width: 60px; max-width: 85px; margin: 0; padding: 4px; font-size: 0.7em; background: white; color: #f44336; border: 1px solid #f44336; border-radius: 5px;">
                    <strong>🔥 Zor</strong>
                </button>
            </div>

            <!-- Flutter Oyun Kartları -->
            <div class="flutter-game-grid">
                <button class="flutter-game-card kelime" id="kelimeCevirBtn">
                    <div class="game-card-icon">🔄</div>
                    <div class="game-card-title">Kelime Çevir</div>
                    <div class="game-card-desc">Arapça kelimeleri Türkçe'ye çevir</div>
                </button>

                <button class="flutter-game-card dinle" id="dinleBulBtn">
                    <div class="game-card-icon">🎧</div>
                    <div class="game-card-title">Dinle ve Bul</div>
                    <div class="game-card-desc">Kelimeyi dinle ve sahih kelimeyi seç</div>
                </button>

                <button class="flutter-game-card bosluk" id="boslukDoldurBtn">
                    <div class="game-card-icon">✏️</div>
                    <div class="game-card-title">Boşluk Doldur</div>
                    <div class="game-card-desc">Ayetteki eksik kelimeyi tamamla</div>
                </button>

                <button class="flutter-game-card dua" id="duaEtBtn">
                    <div class="game-card-icon">🤲</div>
                    <div class="game-card-title">Dua Et</div>
                    <div class="game-card-desc">Kur'an'dan duaları öğren ve dinle</div>
                </button>

                <button class="flutter-game-card ayet" id="ayetOkuBtn">
                    <div class="game-card-icon">📖</div>
                    <div class="game-card-title">Ayet Oku</div>
                    <div class="game-card-desc">Ayetleri oku ve anlamlarını öğren</div>
                </button>

                <button class="flutter-game-card hadis" id="hadisOkuBtn">
                    <div class="game-card-icon">📜</div>
                    <div class="game-card-title">Hadis Oku</div>
                    <div class="game-card-desc">Hadis-i şerifleri oku ve öğren</div>
                </button>
            </div>

            <!-- 🔍 STREAK DEBUG PANEL (DEV MODE) -->
            
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                    
                
                   
                </div>
            </div>
        </div>

        <!-- Kelime Çevir Alt Mod Seçimi -->
        <div class="mode-selector" id="modeSelector" style="display: none;">
            <button class="back-btn" id="backToMenuBtn" style="margin: 6px 8px 4px 8px; padding: 4px 8px; font-size: 0.75em;">
                <i class="material-icons" style="font-size: 14px;">west</i>
                Geri
            </button>
            
            <div id="modeButtons"></div>
            
            <button class="start-btn" id="startBtn">Oyunu Başlat</button>
        </div>

        <!-- Ayet Okuma Modu -->
        <div class="ayet-mode" id="ayetMode" style="display: none;">
            <button class="back-btn" id="backFromAyetBtn" style="margin: 6px 8px 4px 8px; padding: 4px 8px; font-size: 0.75em;">
                <i class="material-icons" style="font-size: 14px;">west</i>
                Geri
            </button>
            <div class="ayet-card">
                <div class="sure-info" id="ayetSureInfo">Yükleniyor...</div>
                <div class="arabic" id="ayetArabic">بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ</div>
                <div class="translation" id="ayetTranslation">Yükleniyor...</div>
                <button class="audio-btn" id="ayetAudioBtn"></button>
                <div class="navigation-btns">
                    <button class="nav-btn" id="prevAyetBtn">← Önceki</button>
                    <button class="nav-btn" id="nextAyetBtn">Sonraki →</button>
                </div>
            </div>
        </div>

        <!-- Dua Modu -->
        <div class="dua-mode" id="duaMode" style="display: none;">
            <button class="back-btn" id="backFromDuaBtn" style="margin: 6px 8px 4px 8px; padding: 4px 8px; font-size: 0.75em;">
                <i class="material-icons" style="font-size: 14px;">west</i>
                Geri
            </button>
            <div class="dua-card">
                <div class="sure-info" id="duaSureInfo">Yükleniyor...</div>
                <div class="arabic" id="duaArabic">Arapça Metin</div>
                <div class="translation" id="duaTranslation">Anlamı</div>
                <button class="audio-btn" id="duaAudioBtn"></button>
                <div class="navigation-btns">
                    <button class="nav-btn" id="prevDuaBtn">← Önceki</button>
                    <button class="nav-btn" id="nextDuaBtn">Sonraki →</button>
                </div>
            </div>
        </div>

        <!-- Hadis Oku Modu -->
        <div class="hadis-mode" id="hadisMode" style="display: none;">
            <button class="back-btn" id="backFromHadisBtn" style="margin: 6px 8px 4px 8px; padding: 4px 8px; font-size: 0.75em;">
                <i class="material-icons" style="font-size: 14px;">west</i>
                Geri
            </button>
            <div class="hadis-card">
                <div class="hadis-category" id="hadisCategory">Kategori</div>
                <div class="hadis-title" id="hadisTitle">Başlık</div>
                <div class="hadis-header" id="hadisHeader">Ravi</div>
                <div class="hadis-text" id="hadisText">Hadis Metni</div>
                <div class="hadis-ref" id="hadisRef">Referans</div>
                <div class="navigation-btns">
                    <button class="nav-btn" id="prevHadisBtn">← Önceki</button>
                    <button class="nav-btn" id="nextHadisBtn">Sonraki →</button>
                </div>
            </div>
        </div>

        <!-- Boşluk Doldur Modu -->
        <div class="bosluk-mode" id="boslukMode" style="display: none;">
            <button class="back-btn" id="backFromBoslukBtn" style="margin: 6px 8px 4px 8px; padding: 4px 8px; font-size: 0.75em;">
                <i class="material-icons" style="font-size: 14px;">west</i>
                Geri
            </button>
            
            <!-- İstatistikler -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; margin: 4px;">
                <div class="flutter-stat-card" style="padding: 4px 1px; min-height: auto;">
                    <div class="flutter-stat-value" id="boslukScore" style="font-size: 0.95em; margin-bottom: 1px;">0</div>
                    <div class="flutter-stat-label" style="font-size: 0.5em; line-height: 1;">HASENE</div>
                </div>
                <div class="flutter-stat-card" style="padding: 4px 1px; min-height: auto;">
                    <div class="flutter-stat-value" id="boslukCorrect" style="font-size: 0.95em; margin-bottom: 1px;">0</div>
                    <div class="flutter-stat-label" style="font-size: 0.5em; line-height: 1;">SAHİH</div>
                </div>
                <div class="flutter-stat-card" style="padding: 4px 1px; min-height: auto;">
                    <div class="flutter-stat-value" id="boslukWrong" style="font-size: 0.95em; margin-bottom: 1px;">0</div>
                    <div class="flutter-stat-label" style="font-size: 0.5em; line-height: 1;">HATALI</div>
                </div>
            </div>

            <div class="game-box">
                <div class="arabic" id="boslukAyetText">Ayet metni yükleniyor...</div>
                <button class="audio-btn" id="boslukAudioBtn"></button>
                <div class="options" id="boslukOptions"></div>
                <div class="feedback" id="boslukFeedback"></div>
                <button class="flutter-btn flutter-btn-primary" id="boslukNextBtn" style="width: 100%; margin-top: 16px;">Sonraki Soru →</button>
            </div>
        </div>

        <!-- Dinle ve Bul Modu -->
        <div class="dinle-mode" id="dinleMode" style="display: none;">
            <button class="back-btn" id="backFromDinleBtn" style="margin: 6px 8px 4px 8px; padding: 4px 8px; font-size: 0.75em;">
                <i class="material-icons" style="font-size: 14px;">west</i>
                Geri
            </button>
            
            <!-- İstatistikler -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; margin: 4px;">
                <div class="flutter-stat-card" style="padding: 4px 1px; min-height: auto;">
                    <div class="flutter-stat-value" id="dinleScore" style="font-size: 0.95em; margin-bottom: 1px;">0</div>
                    <div class="flutter-stat-label" style="font-size: 0.5em; line-height: 1;">HASENE</div>
                </div>
                <div class="flutter-stat-card" style="padding: 4px 1px; min-height: auto;">
                    <div class="flutter-stat-value" id="dinleCorrect" style="font-size: 0.95em; margin-bottom: 1px;">0</div>
                    <div class="flutter-stat-label" style="font-size: 0.5em; line-height: 1;">SAHİH</div>
                </div>
                <div class="flutter-stat-card" style="padding: 4px 1px; min-height: auto;">
                    <div class="flutter-stat-value" id="dinleWrong" style="font-size: 0.95em; margin-bottom: 1px;">0</div>
                    <div class="flutter-stat-label" style="font-size: 0.5em; line-height: 1;">HATALI</div>
                </div>
            </div>

            <div class="game-box">
                <div style="text-align: center; margin: 30px 0;">
                    <div style="font-size: 4em; color: #00CED1; text-shadow: 0 0 10px #00CED1;">🎧</div>
                </div>
                <div class="sure-info" id="dinleSureInfo" style="text-align: center; color: var(--md-on-surface-variant); font-size: 12px; margin: 8px 0;">ID: 0</div>
                <button class="audio-btn" id="dinleAudioBtn"></button>
                <div class="options" id="dinleOptions"></div>
                <div class="feedback" id="dinleFeedback"></div>
                <button class="flutter-btn flutter-btn-primary" id="dinleNextBtn" style="width: 100%; margin-top: 16px;">Sonraki Soru →</button>
            </div>
        </div>

        <!-- Oyun Ekranı -->
        <div class="game-screen" id="gameScreen" style="display: none;">
        <!-- Geri Butonu -->
        <button class="back-btn" id="backFromGameBtn" style="margin: 6px 8px 4px 8px; padding: 4px 8px; font-size: 0.75em;">
            <i class="material-icons" style="font-size: 14px;">west</i>
            Geri
        </button>

        <!-- İstatistikler -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 2px; margin: 4px;">
            <div class="flutter-stat-card" style="padding: 4px 1px; min-height: auto;">
                <div class="flutter-stat-value" id="score" style="font-size: 0.95em; margin-bottom: 1px;">0</div>
                <div class="flutter-stat-label" style="font-size: 0.5em; line-height: 1;">HASENE</div>
            </div>
            <div class="flutter-stat-card" style="padding: 4px 1px; min-height: auto;">
                <div class="flutter-stat-value" id="level" style="font-size: 0.95em; margin-bottom: 1px;">1</div>
                <div class="flutter-stat-label" style="font-size: 0.5em; line-height: 1;">MERTEBE</div>
            </div>
            <div class="flutter-stat-card" style="padding: 4px 1px; min-height: auto;">
                <div class="flutter-stat-value" id="correct" style="font-size: 0.95em; margin-bottom: 1px;">0</div>
                <div class="flutter-stat-label" style="font-size: 0.5em; line-height: 1;">SAHİH</div>
            </div>
            <div class="flutter-stat-card" style="padding: 4px 1px; min-height: auto;">
                <div class="flutter-stat-value" id="wrong" style="font-size: 0.95em; margin-bottom: 1px;">0</div>
                <div class="flutter-stat-label" style="font-size: 0.5em; line-height: 1;">HATALI</div>
            </div>
        </div>

        <!-- Combo Indicator -->
        <div id="comboIndicator" style="display: none; text-align: center; padding: 12px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; margin: 10px 0; animation: comboPopIn 0.3s ease; box-shadow: 0 4px 15px rgba(245,87,108,0.4);">
            <div style="font-size: 1.8em; font-weight: bold; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
                🔥 COMBO <span id="comboCount">3</span>x 🔥
            </div>
            <div style="font-size: 0.9em; color: rgba(255,255,255,0.9); margin-top: 4px;">
                +<span id="comboBonus">5</span> Bonus Hasene!
            </div>
            <div style="font-size: 0.7em; color: rgba(255,255,255,0.7); margin-top: 2px;">
                (Her 3 combo = +5 Hasene)
            </div>
        </div>

        <!-- Can ve Süre -->
        <div class="game-info">
            <div id="livesDisplay" style="display: none;">
                ❤️ Can: <span id="lives">3</span>
            </div>
            <div id="timerDisplay" style="display: none;">
                ⏱️ Süre: <span id="timer">30</span>s
            </div>
            <div>
                📊 Mod: <span id="currentMode">Klasik</span>
            </div>
        </div>

        <!-- Oyun Alanı -->
        <div class="game-box">
            <div class="arabic-text arabic-large" id="arabicWord">رَكَّبَكَ</div>
            <div class="sure-info" id="sureInfo">ID: 0</div>
            
            <div style="display: flex; justify-content: center; gap: 16px; margin: 20px 0;">
                <button class="flutter-fab" id="audioBtn" style="background: transparent; box-shadow: none; border: none;">
                    <img src="hoparlor.png" alt="Ses" style="width: 50px; height: 50px;">
                </button>
                <button class="flutter-fab" id="hintBtn" style="display: none; background: transparent; box-shadow: none; border: none;">
                    <img src="clue.png" alt="İpucu" style="width: 50px; height: 50px;">
                </button>
            </div>
            
            <div class="options" id="options"></div>
            <div class="feedback" id="feedback"></div>
            <button class="flutter-btn flutter-btn-primary" id="nextBtn" style="width: 100%; margin-top: 16px;">Sonraki Soru →</button>
        </div>
        </div>  <!-- gameScreen sonu -->
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h2>🎉 Tebrikler!</h2>
            <p><span id="newLevel"></span>. Mertebeye yükseldiniz!</p>
            <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                Toplam Haseneleriniz: <strong id="modalTotalPoints">0</strong><br>
                Bir sonraki mertebe için: <strong id="modalNextLevelPoints">0</strong> hasene gerekli
            </p>
            <button class="modal-btn" id="modalBtn">Devam Et</button>
        </div>
    </div>

    <!-- Müjdeler Modal -->
    <div class="modal" id="badgesModal">
        <div class="modal-content" style="max-width: 400px; max-height: 80vh; overflow-y: auto;">
            <h3 style="margin: 15px 0 10px 0; font-size: 1.3em;">🏆 Kazanımlarınız</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0;">
                <!-- Mütebahhir -->
                <div style="text-align: center; padding: 8px; border-radius: 8px; background: linear-gradient(135deg, #e1f5fe 0%, #b3e5fc 100%);">
                    <div style="font-size: 1.2em;">💎</div>
                    <div style="font-weight: bold; margin: 2px 0; font-size: 0.8em;">Mütebahhir</div>
                    <div style="font-size: 1em; font-weight: bold; color: #00bcd4;" id="diamondBadgeCount">0</div>
                    <div style="font-size: 0.6em; color: #666;">5 Mütecaviz = 1 Mütebahhir</div>
                </div>
                
                <!-- Mütecaviz -->
                <div style="text-align: center; padding: 8px; border-radius: 8px; background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);">
                    <div style="font-size: 1.2em;">🥇</div>
                    <div style="font-weight: bold; margin: 2px 0; font-size: 0.8em;">Mütecaviz</div>
                    <div style="font-size: 1em; font-weight: bold; color: #ff9800;" id="goldBadgeCount">0</div>
                    <div style="font-size: 0.6em; color: #666;">5 Müterakki = 1 Mütecaviz</div>
                </div>
                
                <!-- Müterakki -->
                <div style="text-align: center; padding: 8px; border-radius: 8px; background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);">
                    <div style="font-size: 1.2em;">🥈</div>
                    <div style="font-weight: bold; margin: 2px 0; font-size: 0.8em;">Müterakki</div>
                    <div style="font-size: 1em; font-weight: bold; color: #9c27b0;" id="silverBadgeCount">0</div>
                    <div style="font-size: 0.6em; color: #666;">5 Mübtedi = 1 Müterakki</div>
                </div>
                
                <!-- Mübtedi -->
                <div style="text-align: center; padding: 8px; border-radius: 8px; background: linear-gradient(135deg, #fff3e0 0%, #ffcc80 100%);">
                    <div style="font-size: 1.2em;">🥉</div>
                    <div style="font-weight: bold; margin: 2px 0; font-size: 0.8em;">Mübtedi</div>
                    <div style="font-size: 1em; font-weight: bold; color: #ff5722;" id="bronzeBadgeCount">0</div>
                    <div style="font-size: 0.6em; color: #666;">5 Yıldız = 1 Mübtedi</div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 15px 0; padding: 10px; background: #f5f5f5; border-radius: 8px;">
                <div style="font-size: 1.1em; margin-bottom: 5px;">📊 Terakkiniz</div>
                <div>⭐ <span id="badgesModalStars">0</span> Yıldız</div>
                <div>📈 <span id="badgesModalLevel">1</span>. Mertebe</div>
                <div>📿 <span id="badgesModalPoints">0</span> Hasene</div>
            </div>
            
            <button id="closeBadgesBtn" style="width: auto; max-width: 200px; padding: 10px 30px; background: #e74c3c; color: white; border: none; border-radius: 8px; font-size: 0.9em; font-weight: bold; cursor: pointer; margin: 20px auto 0; display: block;">Kapat</button>
        </div>
    </div>

    <!-- Takvim Modal -->
    <div class="modal" id="calendarModal">
        <div class="modal-content" style="max-width: 580px; max-height: 90vh; overflow-y: auto; padding: 18px; background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);">
            
            <!-- Başlık -->
            <div style="text-align: center; margin-bottom: 20px;">
                <h2 style="margin: 0; font-size: 1.4em; color: #f39c12; font-weight: bold;">günlük seri!</h2>
            </div>
            
            <!-- Haftalık Streak Gösterimi -->
            <div id="weeklyStreakDisplay" style="margin: 15px 0; padding: 0 5px;">
                <!-- Bu alan JavaScript ile doldurulacak -->
            </div>
            
            <!-- Aylık Takvim Bölümü -->
            <div style="margin: 20px 0; background: rgba(44, 62, 80, 0.3); border-radius: 12px; padding: 15px;">
                <!-- (removed) header intentionally omitted -->
                
                <!-- Mini Takvim -->
                <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 8px;">
                    <div style="text-align: center; font-weight: bold; margin-bottom: 10px; font-size: 0.95em; color: #ecf0f1;" id="calendarMonth">Kasım 2025</div>
                    <div id="calendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; text-align: center; max-width: 100%;">
                        <!-- Takvim günleri buraya eklenecek -->
                    </div>
                    
                    <!-- Legend (Minimal, No Label) -->
                    <div style="margin-top: 12px; padding-top: 8px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 0.55em; color: #bdc3c7;">
                            <span style="display: flex; align-items: center; gap: 2px;">
                                <div style="font-size: 1.2em;">🎯</div>
                                Bugün
                            </span>
                            <span style="display: flex; align-items: center; gap: 2px;">
                                <div style="font-size: 1.2em;">✅</div>
                                Tamamlandı
                            </span>
                            <span style="display: flex; align-items: center; gap: 2px;">
                                <div style="font-size: 1.2em;">🔥</div>
                                Streak
                            </span>
                            <span style="display: flex; align-items: center; gap: 2px;">
                                <div style="font-size: 1.2em;">❄️</div>
                                Boş
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <button id="closeCalendarBtn" style="width: auto; max-width: 200px; padding: 10px 30px; background: #e74c3c; color: white; border: none; border-radius: 8px; font-size: 0.9em; font-weight: bold; cursor: pointer; margin: 20px auto 0; display: block;">Kapat</button>
        </div>
    </div>

    <!-- Günlük Görevler Modal -->
    <div class="modal" id="dailyTasksModal">
        <div class="modal-content" style="max-width: 480px; max-height: 80vh; overflow-y: auto;">
            <h3 style="margin: 8px 0 6px 0; font-size: 1em;">🎯 Günlük Görevler</h3>
            
            <!-- Genel İlerleme -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 6px; border-radius: 6px; margin: 8px 0; text-align: center;">
                <div style="font-size: 0.8em; font-weight: bold;">Bugünkü İlerleme</div>
                <div style="font-size: 0.7em; margin-top: 2px;">
                    <span id="completedTasks">0</span>/<span id="totalTasks">5</span> Görev Tamamlandı
                </div>
                <div style="background: rgba(255,255,255,0.3); border-radius: 8px; height: 4px; margin: 4px 0;">
                    <div id="taskProgress" style="background: white; height: 100%; border-radius: 8px; width: 0%; transition: width 0.3s;"></div>
                </div>
            </div>

            <!-- Temel Görevler -->
            <div style="margin: 16px 0;">
                <div id="dailyTasksList">
                    <!-- Görevler buraya dinamik eklenecek -->
                </div>
            </div>

            <!-- Bonus Görevler -->
            <div style="margin: 16px 0;">
                <div id="bonusTasksList">
                    <!-- Bonus görevler buraya dinamik eklenecek -->
                </div>
            </div>

            <!-- Ödül Toplama -->
            <div id="rewardsSection" style="display: none; background: #e8f5e8; border-radius: 8px; padding: 12px; margin: 12px 0; text-align: center;">
                <div style="font-size: 1em; color: #2e7d2e; font-weight: bold;">🎉 Tebrikler!</div>
                <div style="font-size: 0.8em; color: #666; margin: 4px 0;">Tüm görevleri tamamladın!</div>
                <button id="claimRewardsBtn" onclick="claimDailyRewards()" style="background: #4caf50; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 0.8em; cursor: pointer;">
                    +5 ⭐ Ödül Topla
                </button>
            </div>

            <button id="closeDailyTasksBtn" style="width: auto; max-width: 200px; padding: 10px 30px; background: #e74c3c; color: white; border: none; border-radius: 8px; font-size: 0.9em; font-weight: bold; cursor: pointer; margin: 20px auto 0; display: block;">Kapat</button>
        </div>
    </div>

    <!-- İstatistikler Modal -->
    <div class="modal" id="statsModal">
        <div class="modal-content" style="max-width: 420px; max-height: 90vh; overflow-y: auto; padding: 20px;">
            <h3 style="margin: 10px 0 15px 0; font-size: 1.1em; text-align: center;">📊 İstatistikler</h3>
            
            <!-- Tab Butonları -->
            <div style="display: flex; gap: 8px; margin-bottom: 15px; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px;">
                <button id="statsTabGeneral" onclick="switchStatsTab('general')" style="flex: 1; padding: 10px; background: linear-gradient(135deg, #8B4513 0%, #D2691E 100%); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 0.9em; cursor: pointer; transition: all 0.3s ease;">
                    📈 Genel
                </button>
                <button id="statsTabWords" onclick="switchStatsTab('words')" style="flex: 1; padding: 10px; background: white; color: #666; border: 2px solid #e0e0e0; border-radius: 8px; font-weight: 600; font-size: 0.9em; cursor: pointer; transition: all 0.3s ease;">
                    📚 Kelimeler
                </button>
            </div>

            <!-- Genel İstatistikler Tab -->
            <div id="statsContentGeneral" style="display: block;">
            <!-- Genel Özet -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px; border-radius: 8px; margin: 8px 0; text-align: center;">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; text-align: center; margin-bottom: 10px;">
                    <div>
                        <div style="font-size: 1.4em; font-weight: bold;" id="statsLevel">1</div>
                        <div style="font-size: 0.7em; opacity: 0.9;">Mertebe</div>
                    </div>
                    <div>
                        <div style="font-size: 1.4em; font-weight: bold;" id="statsPoints">0</div>
                        <div style="font-size: 0.7em; opacity: 0.9;">Hasene (Ana Sevap)</div>
                    </div>
                    <div>
                        <div style="font-size: 1.4em; font-weight: bold;" id="statsStars">0</div>
                        <div style="font-size: 0.7em; opacity: 0.9;">⭐ Yıldız (100 Hasene)</div>
                    </div>
                </div>
                
                <!-- Seviye İlerleme Barı -->
                <div style="margin-top: 10px;">
                    <div style="display: flex; justify-content: space-between; font-size: 0.75em; margin-bottom: 5px; opacity: 0.9;">
                        <span>Mertebe <span id="statsCurrentLevel">1</span></span>
                        <span>Mertebe <span id="statsNextLevel">2</span></span>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); height: 6px; border-radius: 3px; overflow: hidden;">
                        <div id="statsLevelProgress" style="background: rgba(255,255,255,0.9); height: 100%; width: 0%; border-radius: 3px; transition: width 0.3s ease;"></div>
                    </div>
                    <div style="font-size: 0.75em; margin-top: 4px; opacity: 0.8;">
                        <span id="statsLevelPointsNeeded">0</span> hasene daha
                    </div>
                </div>
            </div>

            <!-- Rozet Sistemi -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 12px; border-radius: 12px; margin: 12px 0; box-shadow: 0 4px 12px rgba(102,126,234,0.3);">
                <h4 style="margin: 0 0 10px 0; color: white; font-size: 1em; text-align: center;">🏆 Hasene Bazlı Rozet Sistemi</h4>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; text-align: center;">
                    <div style="padding: 6px 4px; background: white; border-radius: 8px; border: 2px solid #cd7f32;">
                        <div style="font-size: 1.3em;">🥉</div>
                        <div style="font-size: 0.65em; color: #666; margin: 2px 0;">Bronz</div>
                        <div style="font-weight: bold; font-size: 0.85em; color: #cd7f32;" id="statsBronze">0</div>
                        <div style="font-size: 0.55em; color: #888; margin-top: 2px;">2K Hasene</div>
                    </div>
                    <div style="padding: 6px 4px; background: white; border-radius: 8px; border: 2px solid #c0c0c0;">
                        <div style="font-size: 1.3em;">🥈</div>
                        <div style="font-size: 0.65em; color: #666; margin: 2px 0;">Gümüş</div>
                        <div style="font-weight: bold; font-size: 0.85em; color: #c0c0c0;" id="statsSilver">0</div>
                        <div style="font-size: 0.55em; color: #888; margin-top: 2px;">8.5K Hasene</div>
                    </div>
                    <div style="padding: 6px 4px; background: white; border-radius: 8px; border: 2px solid #ffd700;">
                        <div style="font-size: 1.3em;">🥇</div>
                        <div style="font-size: 0.65em; color: #666; margin: 2px 0;">Altın</div>
                        <div style="font-weight: bold; font-size: 0.85em; color: #ffd700;" id="statsGold">0</div>
                        <div style="font-size: 0.55em; color: #888; margin-top: 2px;">25.5K Hasene</div>
                    </div>
                    <div style="padding: 6px 4px; background: white; border-radius: 8px; border: 2px solid #b9f2ff;">
                        <div style="font-size: 1.3em;">💎</div>
                        <div style="font-size: 0.65em; color: #666; margin: 2px 0;">Elmas</div>
                        <div style="font-weight: bold; font-size: 0.85em; color: #00d9ff;" id="statsDiamond">0</div>
                        <div style="font-size: 0.55em; color: #888; margin-top: 2px;">85K Hasene</div>
                    </div>
                </div>
                <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 0.75em; text-align: center;">
                    💡 1 saat oyun = ~8500 Hasene (1 Müterakki)
                </div>
            </div>

            <!-- Başarı Analizi -->
            <div style="background: #f0f8ff; padding: 8px; border-radius: 6px; margin: 8px 0;">
                <h4 style="margin: 0 0 6px 0; color: #2980b9; font-size: 0.9em;">📈 Başarı Analizi</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px;">
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #27ae60;" id="statsSuccessRate">0%</div>
                        <div style="font-size: 0.7em; color: #666;">Başarı Oranı</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #3498db;" id="statsAvgPointsPerDay">0</div>
                        <div style="font-size: 0.7em; color: #666;">Günlük Ort. Hasene</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #e67e22;" id="statsPlayConsistency">0%</div>
                        <div style="font-size: 0.7em; color: #666;">Talim Tutarlılığı</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #9b59b6;" id="statsLevelProgress">0%</div>
                        <div style="font-size: 0.7em; color: #666;">Mertebe İlerlemesi</div>
                    </div>
                </div>
            </div>

            <!-- Devam (Streak) Bilgileri -->
            <div style="background: #fff7e6; padding: 12px; border-radius: 8px; margin: 12px 0;">
                <h4 style="margin: 0 0 8px 0; color: #d68910; font-size: 1em;">🔥 Muvazebet İstatistikleri</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                        <div style="font-size: 1.3em; font-weight: bold; color: #e67e22;" id="statsCurrentStreak">0</div>
                        <div style="font-size: 0.8em; color: #666;">Mevcut Devam</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                        <div style="font-size: 1.3em; font-weight: bold; color: #e67e22;" id="statsBestStreak">0</div>
                        <div style="font-size: 0.8em; color: #666;">En İyi Devam</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                        <div style="font-size: 1.3em; font-weight: bold; color: #27ae60;" id="statsTotalDays">0</div>
                        <div style="font-size: 0.8em; color: #666;">Toplam Amel Günü</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                        <div style="font-size: 1.3em; font-weight: bold; color: #3498db;" id="statsTodayProgress">0</div>
                        <div style="font-size: 0.8em; color: #666;">Bugünkü Amel</div>
                    </div>
                </div>
            </div>

            <!-- Oyun Türü İstatistikleri -->
            <div style="background: #f0fff4; padding: 8px; border-radius: 6px; margin: 8px 0;">
                <h4 style="margin: 0 0 6px 0; color: #27ae60; font-size: 0.9em;">🎮 Oyun Türü İstatistikleri (Bugün)</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 0.8em;">
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>📚 Kelime Çevir:</span>
                        <strong id="statsKelimeCevir">0</strong>
                    </div>
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>🎧 Dinle & Bul:</span>
                        <strong id="statsDinleBul">0</strong>
                    </div>
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>📝 Boşluk Doldur:</span>
                        <strong id="statsBoslukDoldur">0</strong>
                    </div>
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>📖 Ayet Oku:</span>
                        <strong id="statsAyetOku">0</strong>
                    </div>
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>🤲 Dua Öğren:</span>
                        <strong id="statsDuaOgre">0</strong>
                    </div>
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>📜 Hadis Oku:</span>
                        <strong id="statsHadisOku">0</strong>
                    </div>
                </div>
            </div>

            <!-- Bugünkü Toplam İstatistikler -->
            <div style="background: #fef9e7; padding: 8px; border-radius: 6px; margin: 8px 0;">
                <h4 style="margin: 0 0 6px 0; color: #b7950b; font-size: 0.9em;">⚡ Bugünkü Performans</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px;">
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #27ae60;" id="statsTodayCorrect">0</div>
                        <div style="font-size: 0.7em; color: #666;">Toplam Sahih</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #f39c12;" id="statsTodayPoints">0</div>
                        <div style="font-size: 0.7em; color: #666;">Toplam Hasene</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #e74c3c;" id="statsPerfectStreak">0</div>
                        <div style="font-size: 0.7em; color: #666;">Mükemmel Seri</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #8e44ad;" id="statsDifficultyCount">0</div>
                        <div style="font-size: 0.7em; color: #666;">Farklı Zorluk</div>
                    </div>
                </div>
            </div>

            <!-- İstatistik Sıfırlama Uyarısı -->
            <div style="background: #ffebee; padding: 10px; border-radius: 6px; margin: 12px 0; border-left: 4px solid #f44336;">
                <div style="font-size: 0.85em; color: #c62828; margin-bottom: 8px;">⚠️ Dikkat: Tüm istatistikleri sıfırlamak istiyorsan:</div>
                <button onclick="confirmResetStats()" style="background: #f44336; color: white; border: none; padding: 8px 12px; border-radius: 4px; font-size: 0.8em; cursor: pointer;">
                    🔄 Tüm İstatistikleri Sıfırla
                </button>
            </div>
            </div>
            <!-- Genel İstatistikler Tab Sonu -->

            <!-- Kelime İstatistikleri Tab -->
            <div id="statsContentWords" style="display: none;">
            <!-- Genel Özet -->
            <div style="background: linear-gradient(135deg, #845EC2 0%, #4E8397 100%); color: white; padding: 15px; border-radius: 12px; margin: 15px 0; text-align: center;">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; text-align: center;">
                    <div>
                        <div style="font-size: 1.4em; font-weight: bold;" id="wordStatsTotal">0</div>
                        <div style="font-size: 0.8em; opacity: 0.9;">Kelime Görüldü</div>
                    </div>
                    <div>
                        <div style="font-size: 1.4em; font-weight: bold;" id="wordStatsMastered">0</div>
                        <div style="font-size: 0.8em; opacity: 0.9;">Öğrenildi</div>
                    </div>
                    <div>
                        <div style="font-size: 1.4em; font-weight: bold;" id="wordStatsStruggling">0</div>
                        <div style="font-size: 0.8em; opacity: 0.9;">Zorlanılan</div>
                    </div>
                </div>
            </div>

            <!-- Filtreleme Butonları -->
            <div style="display: flex; gap: 8px; margin: 15px 0; flex-wrap: wrap;">
                <button id="filterAll" class="filter-btn active" style="flex: 1; min-width: 80px; padding: 8px; border: none; border-radius: 6px; background: #3498db; color: white; font-size: 0.85em; cursor: pointer;">
                    Hepsi
                </button>
                <button id="filterMastered" class="filter-btn" style="flex: 1; min-width: 80px; padding: 8px; border: none; border-radius: 6px; background: #95a5a6; color: white; font-size: 0.85em; cursor: pointer;">
                    Öğrenildi
                </button>
                <button id="filterStruggling" class="filter-btn" style="flex: 1; min-width: 80px; padding: 8px; border: none; border-radius: 6px; background: #95a5a6; color: white; font-size: 0.85em; cursor: pointer;">
                    Zorlanılan
                </button>
                <button id="filterRecent" class="filter-btn" style="flex: 1; min-width: 80px; padding: 8px; border: none; border-radius: 6px; background: #95a5a6; color: white; font-size: 0.85em; cursor: pointer;">
                    Son Görülen
                </button>
            </div>

            <!-- Kelime Listesi -->
            <div id="wordStatsList" style="max-height: 400px; overflow-y: auto; margin: 15px 0;">
                <!-- Kelime istatistikleri buraya dinamik eklenecek -->
            </div>

            <!-- Öğrenme İpuçları -->
            <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #f39c12;">
                <div style="font-size: 0.9em; color: #856404; font-weight: bold; margin-bottom: 6px;">💡 Öğrenme İpuçları</div>
                <div style="font-size: 0.8em; color: #666;">
                    • Zorlandığın kelimeler otomatik olarak daha sık gösterilir<br>
                    • %60'ın üzerinde başarı oranı olan kelimeler "öğrenildi" sayılır<br>
                    • Uzun süre görülmeyen kelimeler tekrar önceliklendirilir
                </div>
            </div>

            </div>
            <!-- Kelime İstatistikleri Tab Sonu -->

            <!-- Kapat Butonu -->
            <button id="closeStatsBtn" style="width: auto; max-width: 200px; padding: 10px 30px; background: #e74c3c; color: white; border: none; border-radius: 8px; font-size: 0.9em; font-weight: bold; cursor: pointer; margin: 20px auto 0; display: block;">Kapat</button>
        </div>
    </div>

    <!-- Daily Goal Settings Modal -->
    <div class="modal" id="dailyGoalModal">
        <div class="modal-content" style="max-width: 360px;">
            <h3 style="margin: 0 0 15px 0; font-size: 1.05em; text-align: center;">🎯 Günlük Hedef Seç</h3>
            <p style="text-align: center; color: #666; font-size: 0.8em; margin-bottom: 20px;">
                Ne kadar çalışmak istiyorsun?
            </p>
            
            <div style="display: flex; flex-direction: column; gap: 12px;">
                <button onclick="setDailyGoal('easy')" style="background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%); color: white; border: none; padding: 16px; border-radius: 12px; cursor: pointer; text-align: left; transition: transform 0.3s; box-shadow: 0 4px 12px rgba(74,222,128,0.3);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.8em;">🌱</span>
                        <div>
                            <div style="font-weight: 600; font-size: 0.95em;">Rahat</div>
                            <div style="font-size: 0.75em; opacity: 0.9;">Günde 1,300 Hasene - ~10 dakika</div>
                        </div>
                    </div>
                </button>
                
                <button onclick="setDailyGoal('normal')" style="background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%); color: white; border: none; padding: 16px; border-radius: 12px; cursor: pointer; text-align: left; transition: transform 0.3s; box-shadow: 0 4px 12px rgba(96,165,250,0.3);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.8em;">🎯</span>
                        <div>
                            <div style="font-weight: 600; font-size: 0.95em;">Normal</div>
                            <div style="font-size: 0.75em; opacity: 0.9;">Günde 2,700 Hasene - ~20 dakika</div>
                        </div>
                    </div>
                </button>
                
                <button onclick="setDailyGoal('serious')" style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color: white; border: none; padding: 16px; border-radius: 12px; cursor: pointer; text-align: left; transition: transform 0.3s; box-shadow: 0 4px 12px rgba(249,115,22,0.3);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.8em;">🔥</span>
                        <div>
                            <div style="font-weight: 600; font-size: 0.95em;">Ciddi</div>
                            <div style="font-size: 0.75em; opacity: 0.9;">Günde 6,000 Hasene - ~45 dakika</div>
                        </div>
                    </div>
                </button>
            </div>
            
            <button id="closeDailyGoalBtn" style="width: auto; max-width: 200px; padding: 10px 30px; background: #e74c3c; color: white; border: none; border-radius: 8px; font-size: 0.9em; font-weight: bold; cursor: pointer; margin: 20px auto 0; display: block;">
                Kapat
            </button>
        </div>
    </div>

    <!-- Hasene Info Modal -->
    <div class="modal" id="xpInfoModal">
        <div class="modal-content" style="max-width: 400px;">
            <h3 style="margin: 0 0 15px 0; font-size: 1.1em; text-align: center; color: #667eea;">� Hasene Sistemi</h3>
            
            <div style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); padding: 12px; border-radius: 10px; margin-bottom: 15px; text-align: center;">
                <div style="font-size: 0.8em; color: #555; font-weight: 600;">1 Saat Amel = ~8,500 Hasene</div>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                <h4 style="margin: 0 0 10px 0; color: #667eea; font-size: 0.9em;">⭐ Yıldız Sistemi</h4>
                <div style="font-size: 0.75em; color: #555; line-height: 1.6;">
                    <strong>100 Hasene = 1 Yıldız</strong><br>
                    Her sahih cevabın mükâfatı. Sürekli ilerleme görürsün!
                </div>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                <h4 style="margin: 0 0 10px 0; color: #667eea; font-size: 0.9em;">🏆 Mertebe Sistemi</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.75em; color: #555;">
                    <div>🥉 <strong>2,000 Hasene</strong><br><span style="font-size: 0.85em; color: #888;">Mübtedi (~15 dk)</span></div>
                    <div>🥈 <strong>8,500 Hasene</strong><br><span style="font-size: 0.85em; color: #888;">Müterakki (~1 saat)</span></div>
                    <div>🥇 <strong>25,500 Hasene</strong><br><span style="font-size: 0.85em; color: #888;">Mütecaviz (~3 gün)</span></div>
                    <div>💎 <strong>85,000 Hasene</strong><br><span style="font-size: 0.85em; color: #888;">Mütebahhir (~10 gün)</span></div>
                </div>
            </div>
            
            <div style="background: #fff7e6; padding: 12px; border-radius: 10px; margin-bottom: 15px;">
                <h4 style="margin: 0 0 8px 0; color: #f97316; font-size: 0.9em;">🔥 Silsile Bonusu</h4>
                <div style="font-size: 0.75em; color: #555;">
                    <strong>Her 3 sahih cevap = +5 Hasene bonus!</strong><br>
                    Tevali yap, ilave mükâfat kazan!
                </div>
            </div>
            
            <div style="background: #f0f9ff; padding: 12px; border-radius: 10px; margin-bottom: 15px;">
                <h4 style="margin: 0 0 8px 0; color: #3b82f6; font-size: 0.9em;">🎯 Günlük Vird Bonusu</h4>
                <div style="font-size: 0.75em; color: #555;">
                    Günlük virdini tamamla:<br>
                    <strong style="color: #3b82f6; font-size: 1.1em;">+1,000 Hasene Müjdesi!</strong>
                </div>
            </div>
            
            <button id="closeXPInfoBtn" style="width: auto; max-width: 200px; padding: 10px 30px; background: #e74c3c; color: white; border: none; border-radius: 8px; font-size: 0.9em; font-weight: bold; cursor: pointer; margin: 20px auto 0; display: block;">
                Bâreke'llahu fîke! 🤲
            </button>
        </div>
    </div>

    <!-- Oyun Bitti Modal -->
    <div class="modal" id="gameOverModal">
        <div class="modal-content">
            <h2 id="gameOverTitle">😢 Oyun Bitti</h2>
            <p id="gameOverText"></p>
            <p>Toplam Hasene: <strong id="finalScore">0</strong></p>
            <button class="modal-btn" id="restartBtn">Yeniden Başla</button>
        </div>
    </div>

    <!-- Custom Alert Modal (Professional Replacement for alert()) -->
    <div id="customAlertModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 420px; text-align: center; padding: 30px;">
            <div id="customAlertIcon" style="font-size: 2.5em; margin-bottom: 12px;">ℹ️</div>
            <div id="customAlertTitle" style="font-size: 1.1em; font-weight: bold; color: #333; margin-bottom: 8px;">Bilgi</div>
            <div id="customAlertMessage" style="font-size: 0.9em; color: #666; margin-bottom: 20px; line-height: 1.5;"></div>
            <button id="customAlertOKBtn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 35px; border-radius: 8px; font-size: 0.95em; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(102,126,234,0.3); transition: transform 0.2s;">
                Tamam
            </button>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; align-items: center; justify-content: center;">
        <div style="text-align: center; color: white;">
            <div style="border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid white; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 15px;"></div>
            <div style="font-size: 1.1em; font-weight: 600;">Yükleniyor...</div>
        </div>
    </div>
    
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <script>
        // ============ PRODUCTION CONFIG - DEBUG SISTEMI ============
        const CONFIG = {
            debug: false,              // Ana debug modu (production'da false)
            debugStats: false,          // İstatistik debug'ları (filterWordStats, updateWordStatistics)
            debugElements: false,       // DOM element kontrolleri
            debugAudio: false,          // Ses sistemi debug'ları
            debugGameFlow: false,       // Oyun akışı debug'ları
            showCriticalErrors: true    // Kritik hataları her zaman göster
        };
        
        // Helper fonksiyon - güvenli console.log
        // Keep a reference to the original console.log so we can gate raw calls
        const __orig_console_log = console.log.bind(console);

        const log = {
            // Use the original console for wrapper logs so each wrapper flag works independently
            debug: (...args) => { if (CONFIG.debug) __orig_console_log(...args); },
            stats: (...args) => { if (CONFIG.debugStats) __orig_console_log(...args); },
            elements: (...args) => { if (CONFIG.debugElements) __orig_console_log(...args); },
            audio: (...args) => { if (CONFIG.debugAudio) __orig_console_log(...args); },
            game: (...args) => { if (CONFIG.debugGameFlow) __orig_console_log(...args); },
            error: (...args) => { if (CONFIG.showCriticalErrors) console.error(...args); },
            warn: (...args) => { if (CONFIG.showCriticalErrors) console.warn(...args); }
        };

        // Gate any remaining raw console.log calls via CONFIG.debug (global toggle).
        // This lets us avoid replacing hundreds of console.log occurrences while keeping
        // a single control to enable verbose logs during debugging.
        console.log = (...args) => { if (typeof CONFIG !== 'undefined' && CONFIG.debug) __orig_console_log(...args); };
        
        // ============ SECURITY - HTML SANITIZATION ============
        function sanitizeHTML(input) {
            // XSS koruması için HTML özel karakterlerini escape et
            if (typeof input !== 'string') return '';
            const div = document.createElement('div');
            div.textContent = input;
            return div.innerHTML;
        }
        
        function safeSetHTML(element, html, isStaticTrusted = false) {
            // innerHTML kullanımı için güvenli wrapper
            if (!element) return;
            if (isStaticTrusted) {
                // Statik, güvenilir HTML için direkt set (template literals)
                element.innerHTML = html;
            } else {
                // User input veya dinamik içerik için sanitize
                element.innerHTML = sanitizeHTML(html);
            }
        }
        
        // ============ LOADING INDICATOR ============
        function showLoading(message = 'Yükleniyor...') {
            const spinner = document.getElementById('loadingSpinner');
            if (spinner) {
                spinner.style.display = 'flex';
                const textEl = spinner.querySelector('div > div:last-child');
                if (textEl) textEl.textContent = message;
            }
        }
        
        function hideLoading() {
            const spinner = document.getElementById('loadingSpinner');
            if (spinner) spinner.style.display = 'none';
        }
        
        // ============ SECURITY - LOCALSTORAGE ENCRYPTION ============
        function encryptData(data) {
            // Basit Base64 encoding (production'da daha güçlü encryption kullanılabilir)
            try {
                const jsonStr = JSON.stringify(data);
                return btoa(unescape(encodeURIComponent(jsonStr)));
                } catch(e) {
                log.error('Encryption error:', e);
                return data;
            }
        }
        
        function decryptData(encrypted) {
            // Base64 decoding
            try {
                const jsonStr = decodeURIComponent(escape(atob(encrypted)));
                return JSON.parse(jsonStr);
            } catch(e) {
                log.error('Decryption error:', e);
                // Eğer decrypt edilemezse, belki encrypt edilmemiş eski veri
                try {
                    return JSON.parse(encrypted);
                } catch(e2) {
                    return encrypted;
                }
            }
        }
        
        function secureSetItem(key, value) {
            // localStorage'a şifreli kaydet
            const encrypted = encryptData(value);
            localStorage.setItem(key, encrypted);
        }
        
        function secureGetItem(key) {
            // localStorage'dan şifreli oku
            const encrypted = localStorage.getItem(key);
            if (!encrypted) return null;
            return decryptData(encrypted);
        }
        
        // ============ CUSTOM ALERT SYSTEM (Professional UI) ============
        function showCustomAlert(message, type = 'info', title = null) {
            const modal = document.getElementById('customAlertModal');
            const iconEl = document.getElementById('customAlertIcon');
            const titleEl = document.getElementById('customAlertTitle');
            const messageEl = document.getElementById('customAlertMessage');
            const okBtn = document.getElementById('customAlertOKBtn');
            
            // Type-based styling
            const types = {
                success: { icon: '🎉', title: 'Başarılı!', color: '#4caf50' },
                error: { icon: '❌', title: 'Hata!', color: '#f44336' },
                warning: { icon: '⚠️', title: 'Uyarı!', color: '#ff9800' },
                info: { icon: 'ℹ️', title: 'Bilgi', color: '#2196f3' }
            };
            
            const config = types[type] || types.info;
            iconEl.textContent = config.icon;
            titleEl.textContent = title || config.title;
            titleEl.style.color = config.color;
            messageEl.textContent = message;
            
            // Show modal
            modal.style.display = 'flex';
            
            // OK button handler
            const handleOK = () => {
                modal.style.display = 'none';
                okBtn.removeEventListener('click', handleOK);
            };
            
            okBtn.addEventListener('click', handleOK);
            
            // ESC key to close
            const handleEsc = (e) => {
                if (e.key === 'Escape') {
                    modal.style.display = 'none';
                    okBtn.removeEventListener('click', handleOK);
                    document.removeEventListener('keydown', handleEsc);
                }
            };
            document.addEventListener('keydown', handleEsc);
        }
        
        // ============ GLOBAL FONKSİYONLAR (onclick için erişilebilir olmalı) ============
        
        function switchStatsTab(tabName) {
            log.stats('🔄 switchStatsTab ÇAĞRILDI, tabName:', tabName);
            
            // İçerik divlerini gizle/göster
            const generalContent = document.getElementById('statsContentGeneral');
            const wordsContent = document.getElementById('statsContentWords');
            const generalTab = document.getElementById('statsTabGeneral');
            const wordsTab = document.getElementById('statsTabWords');
            
            // NULL KONTROL - Elementler yoksa hata ver
            if (!generalContent || !wordsContent || !generalTab || !wordsTab) {
                log.error('❌ HATA: İstatistik tab elementleri bulunamadı!', {
                    generalContent: !!generalContent,
                    wordsContent: !!wordsContent,
                    generalTab: !!generalTab,
                    wordsTab: !!wordsTab
                });
                return;
            }
            
            log.elements('📍 Element kontrol:', {
                generalContent: !!generalContent,
                wordsContent: !!wordsContent,
                generalTab: !!generalTab,
                wordsTab: !!wordsTab
            });
            
            if (tabName === 'general') {
                generalContent.style.display = 'block';
                wordsContent.style.display = 'none';
                
                // Tab butonlarını güncelle
                generalTab.style.background = 'linear-gradient(135deg, #8B4513 0%, #D2691E 100%)';
                generalTab.style.color = 'white';
                generalTab.style.border = 'none';
                
                wordsTab.style.background = 'white';
                wordsTab.style.color = '#666';
                wordsTab.style.border = '2px solid #e0e0e0';
            } else if (tabName === 'words') {
                log.stats('📝 Kelimeler sekmesine geçiliyor...');
                generalContent.style.display = 'none';
                wordsContent.style.display = 'block';
                
                log.elements('📍 wordsContent display SONRASI:', window.getComputedStyle(wordsContent).display);
                log.elements('📍 wordsContent visibility:', window.getComputedStyle(wordsContent).visibility);
                log.elements('📍 wordsContent height:', window.getComputedStyle(wordsContent).height);
                log.elements('📍 wordsContent offsetHeight:', wordsContent.offsetHeight);
                
                // Tab butonlarını güncelle
                wordsTab.style.background = 'linear-gradient(135deg, #8B4513 0%, #D2691E 100%)';
                wordsTab.style.color = 'white';
                wordsTab.style.border = 'none';
                
                generalTab.style.background = 'white';
                generalTab.style.color = '#666';
                generalTab.style.border = '2px solid #e0e0e0';
                
                // Kelime istatistiklerini güncelle
                log.stats('🔍 updateWordStatistics fonksiyon tipi:', typeof updateWordStatistics);
                if (typeof updateWordStatistics === 'function') {
                    log.stats('✅ updateWordStatistics çağrılıyor...');
                    updateWordStatistics();
                } else {
                    log.error('❌ updateWordStatistics fonksiyon DEĞİL!');
                }
            }
        }
        
        // Daily Goal Functions
        function showDailyGoalSettings() {
            document.getElementById('dailyGoalModal').style.display = 'flex';
        }
        
        function closeDailyGoalModal() {
            document.getElementById('dailyGoalModal').style.display = 'none';
        }
        
        function setDailyGoal(level) {
            // 1 saat oyun = ~8000 Hasene
            // Kolay: 10 dakika (~1300 Hasene)
            // Normal: 20 dakika (~2700 Hasene)  
            // Ciddi: 45 dakika (~6000 Hasene)
            const goals = {
                easy: { hasene: 1300, name: 'Rahat', icon: '🌱' },
                normal: { hasene: 2700, name: 'Normal', icon: '🎯' },
                serious: { hasene: 6000, name: 'Ciddi', icon: '🔥' }
            };
            
            const goal = goals[level];
            localStorage.setItem('dailyGoalLevel', level);
            localStorage.setItem('dailyGoalHasene', goal.hasene);
            
            // Günlük Hasene'yi sıfırla (her gün başta)
            const today = new Date().toDateString();
            const lastDate = localStorage.getItem('lastDailyGoalDate');
            if (lastDate !== today) {
                localStorage.setItem('dailyXP', '0');
                localStorage.setItem('lastDailyGoalDate', today);
            }
            
            updateDailyGoalDisplay();
            closeDailyGoalModal();
            
            // Başarı mesajı
            showSuccessMessage(goal.icon + ' Günlük hedefin ' + goal.name + ' olarak ayarlandı!');
        }
        
        function updateDailyGoalDisplay() {
            const goalXP = parseInt(localStorage.getItem('dailyGoalHasene')) || 2700;
            const dailyXP = parseInt(localStorage.getItem('dailyHasene')) || 0;
            const goalLevel = localStorage.getItem('dailyGoalLevel') || 'normal';
            
            const goals = {
                easy: { name: 'Rahat', icon: '🌱' },
                normal: { name: 'Normal', icon: '🎯' },
                serious: { name: 'Ciddi', icon: '🔥' }
            };
            
            const progressPercent = Math.min((dailyXP / goalXP) * 100, 100);
            
            // NULL KONTROL - Elementleri kontrol et
            const progressEl = document.getElementById('dailyGoalProgress');
            const progressTextEl = document.getElementById('dailyGoalProgressText');
            const goalTextEl = document.getElementById('dailyGoalText');
            
            if (!progressEl || !progressTextEl || !goalTextEl) {
                log.error('❌ HATA: Günlük hedef elementleri bulunamadı!');
                return;
            }
            
            progressEl.style.width = progressPercent + '%';
            progressTextEl.textContent = dailyXP + ' / ' + goalXP + ' Hasene';
            goalTextEl.textContent = goalXP + ' hasene hedefine ulaş! (' + goals[goalLevel].name + ')';
            
            // Hedef tamamlandıysa
            if (dailyXP >= goalXP) {
                goalTextEl.textContent = '✅ Günlük hedef tamamlandı!';
            }
        }
        
        function addDailyXP(xp) {
            const today = new Date().toDateString();
            const lastDate = localStorage.getItem('lastDailyGoalDate');
            
            // Yeni gün başladıysa sıfırla
            if (lastDate !== today) {
                localStorage.setItem('dailyXP', '0');
                localStorage.setItem('lastDailyGoalDate', today);
            }
            
            const currentXP = parseInt(localStorage.getItem('dailyHasene')) || 0;
            const goalXP = parseInt(localStorage.getItem('dailyGoalHasene')) || 2700;
            const newXP = currentXP + xp;
            
            localStorage.setItem('dailyHasene', newXP.toString());
            
            // Hedef tamamlandıysa
            if (currentXP < goalXP && newXP >= goalXP) {
                setTimeout(() => {
                    showSuccessMessage('🎉 Günlük hedefini tamamladın! +1000 bonus Hasene!');
                    // Bonus Hasene ekle (puan sistemine direkt ekle)
                    totalPoints += 1000;
                    updateStatsBar();
                    saveStats();
                    checkAchievements();
                }, 1000);
            }
            
            updateDailyGoalDisplay();
        }
        
        function showSuccessMessage(message) {
            const msg = document.createElement('div');
            msg.textContent = message;
            msg.style.cssText = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%); color: white; padding: 15px 25px; border-radius: 12px; font-weight: 600; z-index: 10000; box-shadow: 0 8px 24px rgba(74,222,128,0.4); animation: slideDown 0.3s ease;';
            document.body.appendChild(msg);
            
            setTimeout(() => {
                msg.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => msg.remove(), 300);
            }, 3000);
        }
        
        // Ses sistemi (GLOBAL)
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            const now = audioContext.currentTime;
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'correct':
                    // Yükselen tonlar (C5 -> E5 -> G5)
                    oscillator.frequency.setValueAtTime(523.25, now); // C5
                    oscillator.frequency.setValueAtTime(659.25, now + 0.1); // E5
                    oscillator.frequency.setValueAtTime(783.99, now + 0.2); // G5
                    gainNode.gain.setValueAtTime(0.3, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                    oscillator.start(now);
                    oscillator.stop(now + 0.3);
                    break;
                    
                case 'wrong':
                    // Düşen ton (G4 -> C4)
                    oscillator.frequency.setValueAtTime(392.00, now); // G4
                    oscillator.frequency.exponentialRampToValueAtTime(261.63, now + 0.2); // C4
                    gainNode.gain.setValueAtTime(0.2, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                    oscillator.start(now);
                    oscillator.stop(now + 0.2);
                    break;
                    
                case 'levelup':
                    // Fanfar (C5 -> E5 -> G5 -> C6)
                    oscillator.frequency.setValueAtTime(523.25, now); // C5
                    oscillator.frequency.setValueAtTime(659.25, now + 0.1); // E5
                    oscillator.frequency.setValueAtTime(783.99, now + 0.2); // G5
                    oscillator.frequency.setValueAtTime(1046.50, now + 0.3); // C6
                    gainNode.gain.setValueAtTime(0.3, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                    oscillator.start(now);
                    oscillator.stop(now + 0.5);
                    break;
                    
                case 'combo':
                    // Hızlı yükselen tonlar
                    oscillator.frequency.setValueAtTime(523.25, now); // C5
                    oscillator.frequency.setValueAtTime(783.99, now + 0.05); // G5
                    oscillator.frequency.setValueAtTime(1046.50, now + 0.1); // C6
                    gainNode.gain.setValueAtTime(0.25, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
                    oscillator.start(now);
                    oscillator.stop(now + 0.15);
                    break;
            }
        }
        
        // ============ KELİME İSTATİSTİKLERİ FONKSİYONLARI ============
        function updateWordStatistics() {
            log.stats('📊 updateWordStatistics ÇAĞRILDI!');
            
            const wordStats = loadWordStats();
            log.stats('📦 wordStats yüklendi:', wordStats);
            
            // Genel istatistikleri hesapla
            const totalWords = Object.keys(wordStats).length;
            const masteredWords = Object.values(wordStats).filter(stat => stat.masteryLevel >= 3.0 && stat.successRate >= 0.6).length;
            const strugglingWords = Object.values(wordStats).filter(stat => stat.successRate < 0.6 || stat.masteryLevel < 1.0).length;
            
            // Genel özet güncelle
            document.getElementById('wordStatsTotal').textContent = totalWords;
            document.getElementById('wordStatsMastered').textContent = masteredWords;
            document.getElementById('wordStatsStruggling').textContent = strugglingWords;
            
            // Kelime listesini göster (varsayılan: hepsi)
            filterWordStats('all');
            
            // Event listener'ları ekle (sadece bir kez)
            const statsContentWords = document.getElementById('statsContentWords');
            if (!statsContentWords.hasAttribute('data-listeners-added')) {
                document.getElementById('filterAll').onclick = () => filterWordStats('all');
                document.getElementById('filterMastered').onclick = () => filterWordStats('mastered');
                document.getElementById('filterStruggling').onclick = () => filterWordStats('struggling');
                document.getElementById('filterRecent').onclick = () => filterWordStats('recent');
                statsContentWords.setAttribute('data-listeners-added', 'true');
            }
        }
        
        function filterWordStats(filterType) {
            try {
                log.stats('🔍 filterWordStats BAŞLADI, filterType:', filterType);
                
                const wordStats = loadWordStats();
                const listContainer = document.getElementById('wordStatsList');
                log.stats('🔍 filterWordStats çağrıldı, filterType:', filterType, 'wordStats:', wordStats, 'toplam kelime:', Object.keys(wordStats).length);
                log.elements('📦 listContainer elementi:', listContainer ? 'BULUNDU ✅' : 'BULUNAMADI ❌');
                
                if (!listContainer) {
                    log.error('❌ HATA: wordStatsList elementi bulunamadı!');
                    return;
                }
                
                // Filtre butonlarını güncelle
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                const filterBtn = document.getElementById('filter' + filterType.charAt(0).toUpperCase() + filterType.slice(1));
                if (filterBtn) filterBtn.classList.add('active');
                
                let filteredStats = [];
                
                log.stats('🎯 kelimeCevirData uzunluğu:', window.kelimeCevirData ? window.kelimeCevirData.length : 'undefined');
                log.stats('📦 wordStats keyleri:', Object.keys(wordStats));
                
                // Filtreleme
                Object.entries(wordStats).forEach(([wordId, stat]) => {
                    log.stats('🔄 İşleniyor:', wordId, stat);
                    
                    // Kelime verisini bul
                    let wordData = null;
                    
                    // ID formatı: "sure:ayet:kelime" (örn: "105:4:1" veya "2:51:4")
                    // kelimeCevirData'da ID aynı formatta
                    if (window.kelimeCevirData && window.kelimeCevirData.length > 0) {
                        wordData = window.kelimeCevirData.find(w => w.id === wordId);
                    }
                    
                    log.stats('🔍 wordId:', wordId, 'wordData bulundu mu?', wordData ? 'EVET ✅' : 'HAYIR ❌');
                    
                    // Bulunamazsa - ID'den parse et
                    if (!wordData) {
                        const [sure, ayet, kelimeIndex] = wordId.split(':');
                        wordData = { 
                            kelime: wordId, // Geçici olarak ID'yi göster
                            anlam: `Sure ${sure}, Ayet ${ayet}, Kelime ${kelimeIndex}`,
                            id: wordId
                        };
                        log.warn('⚠️ Kelime verisi bulunamadı, geçici veri oluşturuldu:', wordData);
                    }
                    
                    const shouldShow = 
                        filterType === 'all' ||
                        (filterType === 'mastered' && stat.masteryLevel >= 3.0 && stat.successRate >= 0.6) ||
                        (filterType === 'struggling' && (stat.successRate < 0.6 || stat.masteryLevel < 1.0)) ||
                        (filterType === 'recent' && (Date.now() - stat.lastSeen) < 7 * 24 * 60 * 60 * 1000); // Son 7 gün
                    
                    log.stats('🤔 shouldShow:', shouldShow, 'filterType:', filterType, 'stat:', stat);
                    
                    if (shouldShow) {
                        filteredStats.push({ wordId, ...stat, wordData });
                        log.stats('✅ Listeye eklendi:', wordId);
                    } else {
                        log.stats('❌ Listeye EKLENMEDİ:', wordId);
                    }
                });
                
                log.stats('📋 Filtreleme TAMAMLANDI, sonuç:', filteredStats.length, 'kelime');
                
                // Sıralama (öncelik puanına göre)
                filteredStats.sort((a, b) => {
                    if (filterType === 'recent') {
                        return b.lastSeen - a.lastSeen; // En son görülenler önce
                    }
                    return b.priority - a.priority; // Yüksek öncelik önce
                });
                
                log.stats('📋 Sıralama sonrası:', filteredStats.length, 'kelime');
                log.stats('📦 İlk 3 kelime:', filteredStats.slice(0, 3));
                
                // Liste içeriğini oluştur
                if (filteredStats.length === 0) {
                    log.stats('⚠️ filteredStats boş, empty state gösteriliyor');
                // Toplam kelime sayısını kontrol et
                const totalWords = Object.keys(wordStats).length;
                log.stats('📝 Filtrelenmiş liste boş. totalWords:', totalWords, 'filterType:', filterType);
                
                if (totalWords === 0) {
                    // Hiç oyun oynanmamış
                    log.stats('🎮 Hiç oyun oynanmamış - onboarding kartı gösteriliyor');
                    const cardHTML = `
                        <div style="text-align: center; padding: 40px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white; margin: 20px 0;">
                            <div style="font-size: 3em; margin-bottom: 15px;">🎮</div>
                            <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 10px;">Henüz Hiç Oyun Oynamadın!</div>
                            <div style="font-size: 0.95em; opacity: 0.95; margin-bottom: 20px; line-height: 1.5;">
                                Kelime istatistiklerini görmek için oyun oynamaya başla!<br>
                                Her kelimeyle çalıştıkça ilerleme kaydedilecek 📈
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 300px; margin: 0 auto;">
                                <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">📚</div>
                                    <div style="font-size: 0.8em;">Kelime Çevir</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">🎧</div>
                                    <div style="font-size: 0.8em;">Dinle ve Bul</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">✏️</div>
                                    <div style="font-size: 0.8em;">Boşluk Doldur</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">📖</div>
                                    <div style="font-size: 0.8em;">Ayet Oku</div>
                                </div>
                            </div>
                            <div style="margin-top: 20px; font-size: 0.9em; opacity: 0.9;">
                                Ana menüden bir oyun seç ve başla! 🚀
                            </div>
                        </div>
                    `;
                    listContainer.innerHTML = cardHTML;
                    log.elements('✅ Kart HTML\'i listContainer\'a eklendi, innerHTML uzunluğu:', listContainer.innerHTML.length);
                    log.elements('📍 listContainer display:', window.getComputedStyle(listContainer).display);
                    log.elements('📍 listContainer visibility:', window.getComputedStyle(listContainer).visibility);
                } else {
                    // Oyun oynanmış ama bu kategoride kelime yok
                    log.stats('📋 Oyun oynanmış ama bu kategoride kelime yok - filtre mesajı gösteriliyor');
                    const filterMessages = {
                        'all': 'Henüz hiç kelime istatistiği yok',
                        'mastered': 'Henüz öğrenilmiş kelime yok. Daha fazla pratik yap! 💪',
                        'struggling': 'Harika! Zorlandığın kelime yok. Devam et! 🎉',
                        'recent': 'Son 7 günde kelime çalışılmamış. Bugün pratik yap! 📅'
                    };
                    
                    listContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px 20px; color: #666;">
                            <div style="font-size: 2.5em; margin-bottom: 15px;">
                                ${filterType === 'struggling' ? '🎉' : '🔍'}
                            </div>
                            <div style="font-size: 1.1em; font-weight: 600; margin-bottom: 10px; color: #333;">
                                ${filterMessages[filterType] || 'Bu kategoride kelime bulunamadı'}
                            </div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 10px;">
                                ${filterType === 'mastered' ? 'Daha fazla oyun oyna ve kelimeleri öğren!' : 
                                  filterType === 'struggling' ? 'Tüm kelimeler iyi durumda!' :
                                  filterType === 'recent' ? 'Oyun oynayarak listeni güncel tut!' :
                                  'Oyun oynayarak istatistik oluşturmaya başla!'}
                            </div>
                        </div>
                    `;
                }
                return;
            }
            
            // (commented) Kelime listesi log removed during cleanup
            listContainer.innerHTML = filteredStats.slice(0, 50).map(item => { // En fazla 50 kelime göster
                // Kelime verisi yoksa veya geçersizse bu kartı gösterme
                if (!item.wordData || !item.wordData.kelime || item.wordData.kelime.includes('undefined') || item.wordData.kelime.includes('bosluk')) {
                    return ''; // Boş string döndür
                }
                
                const masteryColor = item.masteryLevel >= 3 ? '#27ae60' : item.masteryLevel >= 1.5 ? '#f39c12' : '#e74c3c';
                const masteryText = item.masteryLevel >= 3 ? 'Öğrenildi' : item.masteryLevel >= 1.5 ? 'Öğreniliyor' : 'Zorlanıyor';
                const successPercent = Math.round(item.successRate * 100);
                
                return `
                    <div style="background: white; border-radius: 8px; padding: 12px; margin: 8px 0; border-left: 4px solid ${masteryColor}; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                            <div style="flex: 1;">
                                <div style="font-size: 1.1em; font-weight: bold; color: #2c3e50; margin-bottom: 2px;">${item.wordData.kelime || item.wordId}</div>
                                <div style="font-size: 0.9em; color: #666;">${item.wordData.anlam || 'Bilinmiyor'}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="background: ${masteryColor}; color: white; padding: 3px 8px; border-radius: 4px; font-size: 0.75em; font-weight: bold;">${masteryText}</div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; font-size: 0.8em;">
                            <div style="text-align: center; padding: 6px; background: #f8f9fa; border-radius: 4px;">
                                <div style="font-weight: bold; color: #27ae60;">${successPercent}%</div>
                                <div style="color: #666;">Başarı</div>
                            </div>
                            <div style="text-align: center; padding: 6px; background: #f8f9fa; border-radius: 4px;">
                                <div style="font-weight: bold; color: #3498db;">${item.attempts}</div>
                                <div style="color: #666;">Deneme</div>
                            </div>
                            <div style="text-align: center; padding: 6px; background: #f8f9fa; border-radius: 4px;">
                                <div style="font-weight: bold; color: #f39c12;">${Math.round(item.priority * 100) / 100}</div>
                                <div style="color: #666;">Öncelik</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 8px; font-size: 0.75em; color: #666; text-align: center;">
                            Son görülme: ${new Date(item.lastSeen).toLocaleDateString('tr-TR')}
                        </div>
                    </div>
                `;
                }).join('');
                
                log.stats('✅ HTML oluşturuldu ve listContainer\'a yazıldı!');
                
            } catch (error) {
                log.error('🚨 filterWordStats HATA:', error);
                log.error('Stack trace:', error.stack);
            }
        }
        
        // ============ KELİME İSTATİSTİK YÖNETİMİ ============
        function loadWordStats() {
            try {
                const saved = localStorage.getItem('hasene_wordStats');
                return saved ? JSON.parse(saved) : {};
            } catch (error) {
                log.error('📊 Kelime istatistikleri yüklenirken hata:', error);
                return {};
            }
        }

        function saveWordStats(wordStats) {
            try {
                localStorage.setItem('hasene_wordStats', JSON.stringify(wordStats));
                // (commented) Kelime istatistikleri kaydedildi
            } catch (error) {
                log.error('📊 Kelime istatistikleri kaydedilirken hata:', error);
            }
        }

        function updateWordStats(wordId, isCorrect) {
            // NULL KONTROL - wordId geçerli mi?
            if (!wordId || typeof wordId !== 'string') {
                log.error('❌ Geçersiz wordId:', wordId);
                return;
            }
            
            const wordStats = loadWordStats();
            
            if (!wordStats[wordId]) {
                wordStats[wordId] = {
                    attempts: 0,
                    correct: 0,
                    wrong: 0,
                    lastSeen: Date.now(),
                    masteryLevel: 0,
                    priority: 1.0
                };
            }

            const stats = wordStats[wordId];
            stats.attempts++;
            stats.lastSeen = Date.now();

            if (isCorrect) {
                stats.correct++;
                // Doğru cevap - ustalık artır, öncelik azalt
                stats.masteryLevel = Math.min(5, stats.masteryLevel + 0.2);
                stats.priority = Math.max(0.1, stats.priority * 0.8);
            } else {
                stats.wrong++;
                // Yanlış cevap - ustalık azalt, öncelik artır
                stats.masteryLevel = Math.max(0, stats.masteryLevel - 0.5);
                stats.priority = Math.min(3.0, stats.priority * 1.5);
            }

            // Başarı oranı hesapla
            stats.successRate = stats.attempts > 0 ? (stats.correct / stats.attempts) : 0;

            saveWordStats(wordStats);
            log.stats(`📊 ${wordId} kelimesi istatistiği güncellendi:`, stats);
        }

        function selectIntelligentWord(filteredData) {
            const wordStats = loadWordStats();
            const now = Date.now();
            const oneDay = 24 * 60 * 60 * 1000;

            // Her kelime için öncelik puanı hesapla
            const wordsWithPriority = filteredData.map(word => {
                const stats = wordStats[word.id];
                let priorityScore = 1.0;

                if (stats) {
                    // Temel öncelik puanı (yanlış cevaplanan kelimeler daha öncelikli)
                    priorityScore = stats.priority;

                    // Zaman faktörü (uzun süredir görülmeyen kelimeler)
                    const daysSinceLastSeen = (now - stats.lastSeen) / oneDay;
                    if (daysSinceLastSeen > 3) {
                        priorityScore *= (1 + daysSinceLastSeen * 0.1);
                    }

                    // Başarı oranı faktörü (düşük başarı oranı = yüksek öncelik)
                    if (stats.successRate < 0.6) {
                        priorityScore *= (1.5 - stats.successRate);
                    }

                    // Ustalık seviyesi faktörü (düşük ustalık = yüksek öncelik)
                    priorityScore *= (2.0 - stats.masteryLevel / 5.0);
                } else {
                    // Hiç görülmemiş kelimeler orta öncelikli
                    priorityScore = 1.2;
                }

                return {
                    word,
                    priority: priorityScore
                };
            });

            // Önceliğe göre sırala
            wordsWithPriority.sort((a, b) => b.priority - a.priority);

            // Weighted random selection (en öncelikli kelimeler daha fazla seçilir)
            const totalWeight = wordsWithPriority.reduce((sum, item) => sum + item.priority, 0);
            let random = Math.random() * totalWeight;

            for (const item of wordsWithPriority) {
                random -= item.priority;
                if (random <= 0) {
                    // (commented) Seçilen kelime log removed during cleanup
                    return item.word;
                }
            }

            // Fallback: ilk kelimeyi döndür
            return wordsWithPriority[0]?.word || filteredData[0];
        }
        
        // ============ GLOBAL FONKSİYONLAR SONU ============
        
        // DOM yüklendikten sonra çalıştır
        document.addEventListener('DOMContentLoaded', function() {
            // (commented) DOM yüklendi log removed during cleanup
            
            // Daily Goal'u başlat
            if (!localStorage.getItem('dailyGoalHasene')) {
                localStorage.setItem('dailyGoalHasene', '2700');
                localStorage.setItem('dailyGoalLevel', 'normal');
            }
            updateDailyGoalDisplay();
            
            // Modal butonlarına event listener ekle
            const dailyTasksBtn = document.getElementById('dailyTasksBtn');
            const statsBtn = document.getElementById('statsBtn');
            const calendarBtn = document.getElementById('calendarBtn');
            const xpInfoBtn = document.getElementById('xpInfoBtn');
            
            // ============ AYARLAR - BURADAN KONTROLEDEBİLİRSİN ============
            const CONFIG = {
            // OYUN MODLARI
            gameModes: {
                klasik: {
                    name: '📚 Klasik',
                    description: 'Normal oyun modu',
                    questionsPerLevel: 10,
                    timeLimit: 0,  // 0 = süre yok
                    lives: 0,      // 0 = sınırsız can
                    showHint: true
                },
                hizli: {
                    name: '⚡ Hızlı',
                    description: '30 saniye süre',
                    questionsPerLevel: 15,
                    timeLimit: 30,
                    lives: 0,
                    showHint: false
                },
                hayat: {
                    name: '❤️ 3 Can',
                    description: '3 hak, yanlış = -1 can',
                    questionsPerLevel: 20,
                    timeLimit: 0,
                    lives: 3,
                    showHint: true
                },
                zorluk: {
                    name: '🔥 Zorluk',
                    description: 'Sadece zor kelimeler',
                    questionsPerLevel: 10,
                    timeLimit: 20,
                    lives: 3,
                    showHint: false,
                    minDifficulty: 7  // 7-10 arası zorluk
                }
            },

            // ZORLUK SEVİYELERİ (1 saat oyun = ~8000 Hasene hedefli)
            // Ortalama: ~22 XP/soru (360 soru/saat = 7920 XP + combolar)
            difficultyLevels: {
                kolay: {
                    name: '😊 Kolay',
                    minDiff: 5,
                    maxDiff: 9,
                    pointsMultiplier: 2  // ~13 XP/soru
                },
                orta: {
                    name: '😐 Orta',
                    minDiff: 10,
                    maxDiff: 11,
                    pointsMultiplier: 2  // ~21 XP/soru (ideal)
                },
                zor: {
                    name: '😤 Zor',
                    minDiff: 12,
                    maxDiff: 21,
                    pointsMultiplier: 2  // ~33 XP/soru
                },
                karisik: {
                    name: '🎲 Karışık',
                    minDiff: 5,
                    maxDiff: 21,
                    pointsMultiplier: 2  // ~26 XP/soru ortalama
                }
            },

            // VARSAYILAN AYARLAR
            defaultMode: 'klasik',
            defaultDifficulty: 'orta',  // UI'da mevcut olan zorluk seviyesi
            wrongAnswerPenalty: 5  // Yanlış cevap puan cezası
        };

        // ============ ÖZEL ONAY POP-UP ============
        function showCustomConfirm(correct, wrong, xp) {
            return new Promise((resolve) => {
                const confirmModal = document.getElementById('customConfirm');
                const confirmCorrect = document.getElementById('confirmCorrect');
                const confirmWrong = document.getElementById('confirmWrong');
                const confirmXP = document.getElementById('confirmXP');
                const confirmOK = document.getElementById('confirmOK');
                const confirmCancel = document.getElementById('confirmCancel');

                // Değerleri güncelle
                confirmCorrect.textContent = correct;
                confirmWrong.textContent = wrong;
                confirmXP.textContent = xp;

                // Pop-up'ı göster
                confirmModal.style.display = 'flex';

                // Event listener'ları ekle
                const handleOK = () => {
                    confirmModal.style.display = 'none';
                    cleanup();
                    resolve(true);
                };

                const handleCancel = () => {
                    confirmModal.style.display = 'none';
                    cleanup();
                    resolve(false);
                };

                const cleanup = () => {
                    confirmOK.removeEventListener('click', handleOK);
                    confirmCancel.removeEventListener('click', handleCancel);
                };

                confirmOK.addEventListener('click', handleOK);
                confirmCancel.addEventListener('click', handleCancel);
            });
        }

        // ============ ACHIEVEMENT SİSTEMİ (DOMContentLoaded İÇİNDE) ============
        function checkAchievements() {
            const achievements = [
                { id: 'first_win', name: 'İlk Zafer', desc: 'İlk sahih cevabin', icon: '🎯', condition: () => sessionCorrect >= 1 },
                { id: 'combo_master', name: 'Combo Ustası', desc: '5x combo yap', icon: '🔥', condition: () => comboCount >= 5 },
                { id: 'daily_goal', name: 'Günlük Kahraman', desc: 'Günlük hedefini tamamla', icon: '⭐', condition: () => {
                    const dailyHasene = parseInt(localStorage.getItem('dailyHasene')) || 0;
                    const goalHasene = parseInt(localStorage.getItem('dailyGoalHasene')) || 2700;
                    return dailyHasene >= goalHasene;
                }},
                { id: 'streak_7', name: '7 Gün Streak', desc: '7 gün üst üste oyna', icon: '🔥', condition: () => streakData.currentStreak >= 7 },
                { id: 'level_5', name: 'Seviye 5', desc: 'Seviye 5\'e ulaş', icon: '🏆', condition: () => level >= 5 },
                { id: 'level_10', name: 'Seviye 10', desc: 'Seviye 10\'a ulaş', icon: '💎', condition: () => level >= 10 },
                { id: 'level_20', name: 'Seviye 20', desc: 'Seviye 20\'ye ulaş', icon: '🌟', condition: () => level >= 20 },
                // XP bazlı başarımlar (1 saat oyun = 8500 XP mantığında)
                { id: 'xp_500', name: 'İlk Adım', desc: '500 XP topla (~4 dk)', icon: '🌱', condition: () => totalPoints >= 500 },
                { id: 'xp_2000', name: 'Bronz Yolcu', desc: '2,000 XP (1 Bronz)', icon: '🥉', condition: () => totalPoints >= 2000 },
                { id: 'xp_4000', name: 'Hızlı Başlangıç', desc: '4,000 XP topla', icon: '⚡', condition: () => totalPoints >= 4000 },
                { id: 'xp_8500', name: 'Gümüş Master', desc: '8,500 XP (1 Gümüş)', icon: '🥈', condition: () => totalPoints >= 8500 },
                { id: 'xp_17000', name: 'Çift Gümüş', desc: '17,000 XP topla', icon: '💯', condition: () => totalPoints >= 17000 },
                { id: 'xp_25500', name: 'Altın Master', desc: '25,500 XP (1 Altın)', icon: '🥇', condition: () => totalPoints >= 25500 },
                { id: 'xp_51000', name: 'Çift Altın', desc: '51,000 XP topla', icon: '🔥', condition: () => totalPoints >= 51000 },
                { id: 'xp_85000', name: 'Elmas Master', desc: '85,000 XP (1 Elmas)', icon: '💎', condition: () => totalPoints >= 85000 },
                { id: 'xp_170000', name: 'Efsane', desc: '170,000 XP topla', icon: '✨', condition: () => totalPoints >= 170000 }
            ];
            
            const unlockedAchievements = JSON.parse(localStorage.getItem('unlockedAchievements')) || [];
            let newUnlocks = [];
            
            achievements.forEach(ach => {
                if (!unlockedAchievements.includes(ach.id) && ach.condition()) {
                    unlockedAchievements.push(ach.id);
                    newUnlocks.push(ach);
                }
            });
            
            if (newUnlocks.length > 0) {
                localStorage.setItem('unlockedAchievements', JSON.stringify(unlockedAchievements));
                newUnlocks.forEach(ach => {
                    setTimeout(() => {
                        showAchievementUnlock(ach);
                    }, 500);
                });
            }
        }

        // ============ ARAPÇA HAREKE RENKLENDİRME ============
        function colorizeArabicDiacritics(text) {
            if (!text) return text;
            
            // Arapça hareke karakterleri (Unicode: U+064B - U+065F)
            const diacritics = /[\u064B-\u065F]/g;
            
            return text.replace(diacritics, function(match) {
                return `<span style="color: #e74c3c; font-weight: 600;">${match}</span>`;
            });
        }

        function applyDiacriticColoring(element) {
            if (!element) return;
            
            // Eğer element bir text node ise
            if (element.nodeType === Node.TEXT_NODE) {
                const colorizedText = colorizeArabicDiacritics(element.textContent);
                if (colorizedText !== element.textContent) {
                    const wrapper = document.createElement('span');
                    wrapper.innerHTML = colorizedText;
                    element.parentNode.replaceChild(wrapper, element);
                }
                return;
            }
            
            // Element ise, child node'ları kontrol et
            if (element.childNodes) {
                Array.from(element.childNodes).forEach(child => {
                    applyDiacriticColoring(child);
                });
            }
        }

        function updateArabicTextColoring() {
            // Tüm Arapça text elementlerini bul ve hareke renklerini uygula
            const arabicElements = document.querySelectorAll('.arabic-option, .arabic-text, .hadis-arabic, [dir="rtl"], [style*="direction: rtl"], [class*="arabic"]');
            
            arabicElements.forEach(element => {
                // Arapça metinleri kömür karası yap
                element.style.color = '#2C2C2C';
                applyDiacriticColoring(element);
            });
        }
        
        function showAchievementUnlock(achievement) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                left: 50%;
                transform: translateX(-50%) translateY(-100px);
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 20px 30px;
                border-radius: 16px;
                z-index: 10001;
                box-shadow: 0 10px 40px rgba(102,126,234,0.5);
                text-align: center;
                min-width: 280px;
                animation: achievementSlide 0.5s ease forwards;
            `;
            
            notification.innerHTML = `
                <div style="font-size: 3em; margin-bottom: 10px;">${achievement.icon}</div>
                <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 5px;">Müjde Kazanıldı!</div>
                <div style="font-size: 1em; font-weight: 600; margin-bottom: 3px;">${achievement.name}</div>
                <div style="font-size: 0.85em; opacity: 0.9;">${achievement.desc}</div>
            `;
            
            document.body.appendChild(notification);
            
            // CSS animation ekle
            if (!document.getElementById('achievementAnim')) {
                const style = document.createElement('style');
                style.id = 'achievementAnim';
                style.textContent = `
                    @keyframes achievementSlide {
                        to { transform: translateX(-50%) translateY(0); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.5s ease forwards';
                setTimeout(() => notification.remove(), 500);
            }, 4000);
        }

        // ============ OYUN DURUMU ============
        let kelimeBulData = [];  // kelimebul.json
        let ayetOkuData = [];    // ayetoku_formatted.json (optimized)
        let duaData = [];        // duaet.json
        let hadisData = [];      // hadisoku.json
        
        let currentQuestion = null;
        let currentAyetIndex = 0;
        let currentDuaIndex = 0;
        let currentHadisIndex = 0;
        
        // Ses kontrolü için
        let currentAudio = null;

        // Arapça karakter tespiti için yardımcı fonksiyon
        function isArabic(text) {
            const arabicRegex = /[\u0600-\u06FF]/;
            return arabicRegex.test(text);
        }
        
        // Kelime Çevir oyunu için
        let kelimeCevirScore = 0;
        let kelimeCevirCorrect = 0;
        let kelimeCevirWrong = 0;
        
        // Dinle ve Bul oyunu için
        let dinleScore = 0;
        let dinleCorrect = 0;
        let dinleWrong = 0;
        
        // Boşluk Doldur oyunu için
        let boslukScore = 0;
        let boslukCorrect = 0;
        let boslukWrong = 0;
        
        // GLOBAL (KALICI) PUANLAR
        let totalPoints = 0;  // Toplam oyun puanı (kalıcı)
        let starPoints = 0;   // Yıldız puanı (her 500 puan = 1 yıldız)
        let level = 1;        // Global seviye

        // ROZET SİSTEMİ
        let badges = {
            bronze: 0,   // Bronz rozetler (5 yıldız = 1 bronz)
            silver: 0,   // Gümüş rozetler (5 bronz = 1 gümüş)
            gold: 0,     // Altın rozetler (5 gümüş = 1 altın)
            diamond: 0   // Elmas rozetler (5 altın = 1 elmas)
        };

        // STREAK SİSTEMİ (GÜNLİK TAKİP)
        let streakData = {
            currentStreak: 0,    // Mevcut ardışık gün sayısı
            bestStreak: 0,       // En iyi streak rekoru
            lastPlayDate: '',    // Son oyun oynanan tarih (YYYY-MM-DD)
            totalPlayDays: 0,    // Toplam oyun oynanan gün sayısı
            dailyGoal: 5,        // Günlük hedef (doğru cevap sayısı)
            todayProgress: 0,    // Bugünkü ilerleme
            todayDate: '',       // Bugünün tarihi
            playDates: []        // Oyun oynanan tarihler listesi
        };

        // GÜNLİK GÖREVLER SİSTEMİ
        let dailyTasks = {
            lastTaskDate: '',    // Son görev yenileme tarihi
            tasks: [],           // Günlük görevler listesi
            bonusTasks: [],      // Bonus görevler listesi
            completedTasks: [],  // Tamamlanan görevler
            rewardsClaimed: false, // Ödül toplandı mı?
            todayStats: {        // Bugünkü oyun istatistikleri
                kelimeCevir: 0,
                dinleBul: 0,
                boslukDoldur: 0,
                ayetOku: 0,
                duaOgre: 0,
                hadisOku: 0,
                toplamDogru: 0,
                toplamPuan: 0,
                perfectStreak: 0,
                farklıZorluk: new Set()
            }
        };

        // SESSION (OYUN İÇİ) PUANLAR
        let sessionScore = 0;     // Bu oyunun puanı
        let sessionCorrect = 0;   // Bu oyunun doğru sayısı
        let sessionWrong = 0;     // Bu oyunun yanlış sayısı
        let comboCount = 0;       // Üst üste doğru sayısı (combo)

        // ESKI DEĞİŞKENLER (Geriye uyumluluk için)
        let score = 0;
        let correct = 0;
        let wrong = 0;
        let questionCount = 0;
        let currentMode = CONFIG.defaultMode;
        let currentDifficulty = CONFIG.defaultDifficulty;
        
    log.debug('Session değişkenleri başlatıldı:', {sessionScore, sessionCorrect, sessionWrong});
    log.debug(`🏁 Varsayılan zorluk seviyesi: ${currentDifficulty}`);
        let lives = 0;
        let timer = null;
        let timeLeft = 0;

        // ============ DOM ELEMANLARI ============
        const elements = {
            // Ana menü
            mainMenu: document.getElementById('mainMenu'),
            kelimeCevirBtn: document.getElementById('kelimeCevirBtn'),
            dinleBulBtn: document.getElementById('dinleBulBtn'),
            boslukDoldurBtn: document.getElementById('boslukDoldurBtn'),
            duaEtBtn: document.getElementById('duaEtBtn'),
            ayetOkuBtn: document.getElementById('ayetOkuBtn'),
            hadisOkuBtn: document.getElementById('hadisOkuBtn'),
            
            // Kelime oyunu
            score: document.getElementById('score'),
            level: document.getElementById('level'),
            correct: document.getElementById('correct'),
            wrong: document.getElementById('wrong'),
            progressBar: document.getElementById('progressBar'),
            sureInfo: document.getElementById('sureInfo'),
            arabicWord: document.getElementById('arabicWord'),
            audioBtn: document.getElementById('audioBtn'),
            hintBtn: document.getElementById('hintBtn'),
            options: document.getElementById('options'),
            feedback: document.getElementById('feedback'),
            nextBtn: document.getElementById('nextBtn'),
            difficulty: document.getElementById('difficulty'),
            modal: document.getElementById('modal'),
            newLevel: document.getElementById('newLevel'),
            modalBtn: document.getElementById('modalBtn'),
            modeSelector: document.getElementById('modeSelector'),
            gameScreen: document.getElementById('gameScreen'),
            settingsBtn: document.getElementById('settingsBtn'),
            startBtn: document.getElementById('startBtn'),
            modeButtons: document.getElementById('modeButtons'),
            difficultyButtons: document.getElementById('difficultyButtons'),
            lives: document.getElementById('lives'),
            livesDisplay: document.getElementById('livesDisplay'),
            timer: document.getElementById('timer'),
            timerDisplay: document.getElementById('timerDisplay'),
            currentMode: document.getElementById('currentMode'),
            gameOverModal: document.getElementById('gameOverModal'),
            gameOverTitle: document.getElementById('gameOverTitle'),
            gameOverText: document.getElementById('gameOverText'),
            finalScore: document.getElementById('finalScore'),
            restartBtn: document.getElementById('restartBtn'),
            backToMenuBtn: document.getElementById('backToMenuBtn'),
            backFromGameBtn: document.getElementById('backFromGameBtn'),
            
            // Ayet modu
            ayetMode: document.getElementById('ayetMode'),
            ayetSureInfo: document.getElementById('ayetSureInfo'),
            ayetArabic: document.getElementById('ayetArabic'),
            ayetTranslation: document.getElementById('ayetTranslation'),
            ayetAudioBtn: document.getElementById('ayetAudioBtn'),
            prevAyetBtn: document.getElementById('prevAyetBtn'),
            nextAyetBtn: document.getElementById('nextAyetBtn'),
            backFromAyetBtn: document.getElementById('backFromAyetBtn'),
            
            // Dua modu
            duaMode: document.getElementById('duaMode'),
            duaSureInfo: document.getElementById('duaSureInfo'),
            duaArabic: document.getElementById('duaArabic'),
            duaTranslation: document.getElementById('duaTranslation'),
            duaAudioBtn: document.getElementById('duaAudioBtn'),
            prevDuaBtn: document.getElementById('prevDuaBtn'),
            nextDuaBtn: document.getElementById('nextDuaBtn'),
            backFromDuaBtn: document.getElementById('backFromDuaBtn'),
            
            // Hadis modu
            hadisMode: document.getElementById('hadisMode'),
            hadisCategory: document.getElementById('hadisCategory'),
            hadisTitle: document.getElementById('hadisTitle'),
            hadisHeader: document.getElementById('hadisHeader'),
            hadisText: document.getElementById('hadisText'),
            hadisRef: document.getElementById('hadisRef'),
            prevHadisBtn: document.getElementById('prevHadisBtn'),
            nextHadisBtn: document.getElementById('nextHadisBtn'),
            backFromHadisBtn: document.getElementById('backFromHadisBtn'),
            
            // Boşluk Doldur modu
            boslukMode: document.getElementById('boslukMode'),
            boslukSureInfo: document.getElementById('boslukSureInfo'),
            boslukAyetText: document.getElementById('boslukAyetText'),
            boslukAudioBtn: document.getElementById('boslukAudioBtn'),
            boslukOptions: document.getElementById('boslukOptions'),
            boslukFeedback: document.getElementById('boslukFeedback'),
            boslukNextBtn: document.getElementById('boslukNextBtn'),
            boslukScore: document.getElementById('boslukScore'),
            boslukCorrect: document.getElementById('boslukCorrect'),
            boslukWrong: document.getElementById('boslukWrong'),
            backFromBoslukBtn: document.getElementById('backFromBoslukBtn'),
            
            // Dinle ve Bul modu
            dinleMode: document.getElementById('dinleMode'),
            dinleSureInfo: document.getElementById('dinleSureInfo'),
            dinleAudioBtn: document.getElementById('dinleAudioBtn'),
            dinleOptions: document.getElementById('dinleOptions'),
            dinleFeedback: document.getElementById('dinleFeedback'),
            dinleNextBtn: document.getElementById('dinleNextBtn'),
            dinleScore: document.getElementById('dinleScore'),
            dinleCorrect: document.getElementById('dinleCorrect'),
            dinleWrong: document.getElementById('dinleWrong'),
            backFromDinleBtn: document.getElementById('backFromDinleBtn')
        };
        
        // ============ KRİTİK: NULL KONTROL - EKSIK ELEMENTLER ============
        function checkElements() {
            const missing = [];
            const critical = ['mainMenu', 'kelimeCevirBtn', 'dinleBulBtn', 'boslukDoldurBtn', 
                            'ayetOkuBtn', 'gameScreen', 'modeSelector'];
            
            for (const [key, value] of Object.entries(elements)) {
                if (!value) {
                    missing.push(key);
                    if (critical.includes(key)) {
                        log.error(`❌ KRİTİK: '${key}' elementi bulunamadı!`);
                    }
                }
            }
            
            if (missing.length > 0) {
                log.warn('⚠️ Eksik elementler:', missing.join(', '));
            }
            
            return missing.length === 0;
        }

        // ============ SES DURDURMA FONKSİYONU ============
        function stopCurrentAudio() {
            if (currentAudio) {
                log.audio('⏹️ Mevcut ses durduruluyor:', {
                    paused: currentAudio.paused,
                    currentTime: currentAudio.currentTime,
                    duration: currentAudio.duration,
                    src: currentAudio.src
                });
                
                if (!currentAudio.paused) {
                    currentAudio.pause();
                    log.audio('⏸️ Ses durduruldu');
                }
                
                // Event listener'ları comprehensive cleanup
                cleanupAudioListeners();
                log.audio('🧹 Event listenerlar temizlendi');
                
                currentAudio.currentTime = 0;
                log.audio('🔄 Ses başa sarıldı');
                currentAudio = null;
                log.audio('🗑️ Audio object temizlendi');
            } else {
                log.audio('ℹ️ Durduracak ses yok');
            }
        }

        // ============ SES ÇALMA FONKSİYONU ============
        function cleanupAudioListeners() {
            // Tüm audio event listener'larını temizle (memory leak önleme)
            if (currentAudio) {
                currentAudio.onloadeddata = null;
                currentAudio.oncanplay = null;
                currentAudio.onended = null;
                currentAudio.onerror = null;
                currentAudio.ontimeupdate = null;
                currentAudio.onpause = null;
                currentAudio.onplay = null;
            }
        }

        // Hide all mode containers so only the requested mode is visible
        function hideAllModes() {
            const modeKeys = ['dinleMode','hadisMode','boslukMode','ayetMode','duaMode','modeSelector','gameScreen','mainMenu'];
            modeKeys.forEach(k => {
                try {
                    const el = elements[k];
                    if (el && el.style) el.style.display = 'none';
                } catch (e) {
                    // ignore missing elements
                }
            });
        }
        
        function playAudio(audioUrl, button) {
            // Eğer ses çalıyorsa durdur
            stopCurrentAudio();
            
            if (!audioUrl) {
                log.error('Ses dosyası bulunamadı');
                if (button) button.disabled = false;
                return;
            }
            
            // Butonu devre dışı bırak
            if (button) button.disabled = true;
            
            try {
                currentAudio = new Audio(audioUrl);
                
                // Ses yüklendiğinde çal
                currentAudio.addEventListener('loadeddata', () => {
                    currentAudio.play().catch(err => {
                        log.error('Ses çalma hatası:', err);
                        if (button) button.disabled = false;
                        cleanupAudioListeners();
                        currentAudio = null;
                    });
                });
                
                // Ses bittiğinde butonu aktif et ve cleanup
                currentAudio.onended = () => {
                    if (button) button.disabled = false;
                    cleanupAudioListeners();
                    currentAudio = null;
                };
                
                // Hata durumunda cleanup
                currentAudio.onerror = () => {
                    log.error('Ses dosyası yüklenemedi:', audioUrl);
                    if (button) button.disabled = false;
                    cleanupAudioListeners();
                    currentAudio = null;
                };
                
                // Ses dosyasını yükle
                currentAudio.load();
                
            } catch (err) {
                log.error('Audio oluşturma hatası:', err);
                if (button) button.disabled = false;
                currentAudio = null;
            }
        }

        // ============ NETWORK - FETCH WITH RETRY ============
        async function fetchWithRetry(url, retries = 3, delay = 1000) {
            // JSON yükleme hatalarında otomatik retry
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return await response.json();
                } catch (error) {
                    log.debug(`📡 Fetch attempt ${i + 1}/${retries} failed for ${url}`);
                    if (i === retries - 1) {
                        // Son deneme de başarısız
                        throw new Error(`Failed to load ${url} after ${retries} attempts: ${error.message}`);
                    }
                    // Retry öncesi bekle (exponential backoff)
                    await new Promise(resolve => setTimeout(resolve, delay * (i + 1)));
                }
            }
        }

        // ============ VERİ YÜKLEME ============
        async function loadData() {
            try {
                // Loading göster
                showLoading('Veriler yükleniyor...');
                
                // Kelime verilerini yükle (Kelime Çevir ve Dinle ve Bul için) - 3x retry
                kelimeBulData = await fetchWithRetry('kelimebul.json');
                // (commented) kelimeBulData length log removed during cleanup
                
                // Ayet verilerini yükle (Boşluk Doldur ve Ayet Oku için) - 3x retry
                ayetOkuData = await fetchWithRetry('ayetoku_formatted.json');
                // (commented) ayetOkuData length log removed during cleanup
                
                // Dua verilerini yükle (Dua Et için) - 3x retry
                duaData = await fetchWithRetry('duaet.json');
                // (commented) duaData length log removed during cleanup
                
                // Hadis verilerini yükle (Hadis Oku için) - 3x retry
                hadisData = await fetchWithRetry('hadisoku.json');
                // (commented) hadisData length log removed during cleanup
                
                // Mod seçiciyi başlat
                initModeSelector();

                // Ana menü zorluk butonlarını başlat
                initMainMenuDifficultyButtons();
                
                // Loading gizle
                hideLoading();
                
            } catch (error) {
                hideLoading();
                log.error('Veri yükleme hatası:', error);
                // NULL KONTROL - mainMenu varsa hata mesajı göster
                if (elements.mainMenu) {
                    elements.mainMenu.innerHTML = '<p style="color: red; text-align: center;">Veriler yüklenemedi!</p>';
                } else {
                    log.error('❌ KRİTİK: mainMenu elementi bulunamadı!');
                }
            }
        }

        // ============ İNDEXEDDB SİSTEMİ (ÜÇÜNCü TARAF ÇEREZİ SORUNU İÇİN) ============
        let db = null;
        
        function initIndexedDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('HaseneGameDB', 1);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains('gameData')) {
                        db.createObjectStore('gameData');
                    }
                };
            });
        }
        
        function saveToIndexedDB(key, value) {
            if (!db) return;
            try {
                const transaction = db.transaction(['gameData'], 'readwrite');
                const store = transaction.objectStore('gameData');
                store.put(value, key);
            } catch(e) { log.error('IndexedDB save failed:', e); }
        }
        
        function loadFromIndexedDB(key) {
            return new Promise((resolve) => {
                if (!db) { resolve(null); return; }
                try {
                    const transaction = db.transaction(['gameData'], 'readonly');
                    const store = transaction.objectStore('gameData');
                    const request = store.get(key);
                    request.onsuccess = () => resolve(request.result || null);
                    request.onerror = () => resolve(null);
                } catch(e) { resolve(null); }
            });
        }

        // URL TABANLI VERİ SAKLAMA (Mobil fallback - hiçbir şey çalışmazsa)
        function saveToURL() {
            const gameData = {
                p: totalPoints, // points
                b: badges.bronze + ',' + badges.silver + ',' + badges.gold + ',' + badges.diamond, // badges
                s: streakData.currentStreak, // streak
                d: new Date().toISOString().split('T')[0] // date
            };
            const encoded = btoa(JSON.stringify(gameData));
            const newUrl = window.location.origin + window.location.pathname + '?data=' + encoded;
            
            // URL'yi geçmişe ekle (geri butonu ile erişilebilir)
            if (window.history.pushState) {
                window.history.pushState({gameData: encoded}, '', newUrl);
            }
            log.debug('🔗 URL\'ye kaydedildi:', totalPoints, 'puan');
        }
        
        function loadFromURL() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const data = urlParams.get('data');
                if (data) {
                    const decoded = JSON.parse(atob(data));
                    totalPoints = parseInt(decoded.p) || 0;
                    
                    // Rozet verilerini yükle
                    if (decoded.b) {
                        const badgeArray = decoded.b.split(',');
                        badges.bronze = parseInt(badgeArray[0]) || 0;
                        badges.silver = parseInt(badgeArray[1]) || 0;
                        badges.gold = parseInt(badgeArray[2]) || 0;
                        badges.diamond = parseInt(badgeArray[3]) || 0;
                    }
                    
                    // Streak verilerini yükle
                    if (decoded.s) {
                        streakData.currentStreak = parseInt(decoded.s) || 0;
                    }
                    
                    log.debug('🔗 URL\'den yüklendi:', totalPoints, 'puan');
                    return true;
                }
            } catch(e) {
                log.error('URL yükleme hatası:', e);
            }
            return false;
        }

        // ============ İSTATİSTİK BAR FONKSİYONLARI ============
        async function loadStats() {
            try {
                // IndexedDB'den yükle (üçüncü taraf çerez sorunu için)
                const savedPoints = await loadFromIndexedDB('hasene_totalPoints');
                const savedBadges = await loadFromIndexedDB('hasene_badges');
                const savedStreak = await loadFromIndexedDB('hasene_streak');
                const savedTasks = await loadFromIndexedDB('hasene_dailyTasks');
                
                // Puanları yükle (IndexedDB öncelikli, localStorage yedek)
                totalPoints = parseInt(savedPoints || localStorage.getItem('hasene_totalPoints') || '0');
                starPoints = Math.floor(totalPoints / 500);
                level = calculateLevel(totalPoints);
                
                log.debug('📊 IndexedDB yüklendi:', {totalPoints, savedPoints});
            } catch (error) {
                log.debug('IndexedDB hatası, localStorage denenecek:', error);
                try {
                    // localStorage dene
                    totalPoints = parseInt(localStorage.getItem('hasene_totalPoints') || '0');
                    starPoints = Math.floor(totalPoints / 500);
                    level = calculateLevel(totalPoints);
                    log.debug('📊 localStorage yüklendi:', totalPoints);
                } catch (localError) {
                    log.debug('localStorage da çalışmıyor, URL deneniyor:', localError);
                    // Son çare: URL'den yükle
                    const urlLoaded = loadFromURL();
                    if (urlLoaded) {
                        starPoints = Math.floor(totalPoints / 500);
                        level = calculateLevel(totalPoints);
                    } else {
                        // Hiçbir şey çalışmıyor, varsayılan değerler
                        totalPoints = 0;
                        starPoints = 0;
                        level = 1;
                        log.warn('⚠️ Hiçbir veri sistemi çalışmıyor, sıfırdan başlatılıyor');
                    }
                }
            }
            
            // Rozet sistemi yükle (IndexedDB öncelikli)
            const savedBadgesIndexedDB = await loadFromIndexedDB('hasene_badges');
            const savedBadgesData = savedBadgesIndexedDB || localStorage.getItem('hasene_badges');
            if (savedBadgesData) {
                badges = JSON.parse(typeof savedBadgesData === 'string' ? savedBadgesData : JSON.stringify(savedBadgesData));
            }
            
            // Streak sistemi yükle (IndexedDB öncelikli)
            const savedStreakIndexedDB = await loadFromIndexedDB('hasene_streak');
            const savedStreak = savedStreakIndexedDB || localStorage.getItem('hasene_streak');
            if (savedStreak) {
                streakData = { ...streakData, ...JSON.parse(typeof savedStreak === 'string' ? savedStreak : JSON.stringify(savedStreak)) };
            }
            
            // Günlük görevler yükle (IndexedDB öncelikli) - BU ÇOOK ÖNEMLİ!
            const savedTasksIndexedDB = await loadFromIndexedDB('hasene_dailyTasks');
            const savedTasks = savedTasksIndexedDB || localStorage.getItem('hasene_dailyTasks');
            if (savedTasks) {
                dailyTasks = { ...dailyTasks, ...JSON.parse(typeof savedTasks === 'string' ? savedTasks : JSON.stringify(savedTasks)) };
                // Set nesnelerini yeniden oluştur
                dailyTasks.todayStats.farklıZorluk = new Set(dailyTasks.todayStats.farklıZorluk || []);
            }
            
            // Oyun ayarları yükle (currentMode ve currentDifficulty) - ÇOOK ÖNEMLİ!
            const savedModeIndexedDB = await loadFromIndexedDB('hasene_currentMode');
            const savedMode = savedModeIndexedDB || localStorage.getItem('hasene_currentMode');
            if (savedMode && CONFIG.gameModes[savedMode]) {
                currentMode = savedMode;
                log.debug(`🎮 Kaydedilen mod yüklendi: ${currentMode}`);
            }
            
            const savedDifficultyIndexedDB = await loadFromIndexedDB('hasene_currentDifficulty');
            const savedDifficulty = savedDifficultyIndexedDB || localStorage.getItem('hasene_currentDifficulty');
            if (savedDifficulty && CONFIG.difficultyLevels[savedDifficulty]) {
                currentDifficulty = savedDifficulty;
                log.debug(`🎯 Kaydedilen zorluk yüklendi: ${currentDifficulty}`);
            }
            
            log.debug('📋 Günlük görevler yüklendi:', {
                completedTasks: dailyTasks.completedTasks.length,
                todayStats: dailyTasks.todayStats,
                lastTaskDate: dailyTasks.lastTaskDate
            });
            
            log.debug('🎮 Oyun ayarları yüklendi:', {
                currentMode: currentMode,
                currentDifficulty: currentDifficulty
            });
            
            // Günlük kontrol
            checkDailyProgress();
            checkDailyTasks();
        }

        // Daha zorlu seviye hesaplama sistemi
        function calculateLevel(points) {
            if (points < 1000) return 1;        // Level 1: 0-999 puan
            if (points < 2500) return 2;        // Level 2: 1000-2499 puan  
            if (points < 5000) return 3;        // Level 3: 2500-4999 puan
            if (points < 8500) return 4;        // Level 4: 5000-8499 puan
            if (points < 13000) return 5;       // Level 5: 8500-12999 puan
            if (points < 19000) return 6;       // Level 6: 13000-18999 puan
            if (points < 26500) return 7;       // Level 7: 19000-26499 puan
            if (points < 35500) return 8;       // Level 8: 26500-35499 puan
            if (points < 46000) return 9;       // Level 9: 35500-45999 puan
            if (points < 58000) return 10;      // Level 10: 46000-57999 puan
            
            // Level 10'dan sonra her seviye için 15000 puan artış
            const afterLevel10 = points - 58000;
            return 10 + Math.floor(afterLevel10 / 15000) + 1;
        }

        // Bir sonraki seviye için gereken puan
        function getNextLevelRequiredPoints(currentLevel) {
            const levelThresholds = [0, 1000, 2500, 5000, 8500, 13000, 19000, 26500, 35500, 46000, 58000];
            
            // currentLevel 1-10 arasındaysa threshold'u döndür
            if (currentLevel >= 1 && currentLevel <= 10) {
                return levelThresholds[currentLevel];
            }
            
            // Level 10'dan sonra - her seviye için 15000 puan artış
            if (currentLevel > 10) {
                return 58000 + ((currentLevel - 10) * 15000);
            }
            
            // Level 0 veya geçersiz değerler için
            return levelThresholds[1]; // Level 1 threshold'u
        }

        async function saveStats() {
            try {
                // ÇOKLU KAYDETME SİSTEMİ (Üçüncü taraf çerez sorunu için)
                
                // 1. IndexedDB (ana sistem - çerez engellemelerinden etkilenmez)
                if (db) {
                    saveToIndexedDB('hasene_totalPoints', totalPoints.toString());
                    saveToIndexedDB('hasene_badges', JSON.stringify(badges));
                    saveToIndexedDB('hasene_streak', JSON.stringify(streakData));
                    
                    const tasksToSave = { 
                        ...dailyTasks, 
                        todayStats: {
                            ...dailyTasks.todayStats,
                            farklıZorluk: Array.from(dailyTasks.todayStats.farklıZorluk)
                        }
                    };
                    saveToIndexedDB('hasene_dailyTasks', JSON.stringify(tasksToSave));
                    
                    // Oyun ayarları da kaydet (currentMode & currentDifficulty) - KRİTİK!
                    saveToIndexedDB('hasene_currentMode', currentMode);
                    saveToIndexedDB('hasene_currentDifficulty', currentDifficulty);
                }
                
                // 2. localStorage (yedek sistem)
                try {
                    localStorage.setItem('hasene_totalPoints', totalPoints.toString());
                    localStorage.setItem('hasene_badges', JSON.stringify(badges));
                    localStorage.setItem('hasene_streak', JSON.stringify(streakData));
                    
                    // GÜNLÜK GÖREVLER de localStorage'a kaydet (kritik!)
                    const tasksToSave = { 
                        ...dailyTasks, 
                        todayStats: {
                            ...dailyTasks.todayStats,
                            farklıZorluk: Array.from(dailyTasks.todayStats.farklıZorluk)
                        }
                    };
                    localStorage.setItem('hasene_dailyTasks', JSON.stringify(tasksToSave));
                    
                    // Oyun ayarları da localStorage'a kaydet - KRİTİK!
                    localStorage.setItem('hasene_currentMode', currentMode);
                    localStorage.setItem('hasene_currentDifficulty', currentDifficulty);
                } catch(e) { log.error('localStorage failed:', e); }
                
                // 3. URL sistemi (son çare - mobil için)
                try {
                    saveToURL();
                } catch(e) { log.error('URL save failed:', e); }
                
                log.debug('💾 ÜÇLÜ KORUMA: IndexedDB + localStorage + URL ile kaydedildi!', totalPoints);
                
            } catch (error) {
                log.error('❌ Kaydetme hatası:', error);
            }
        }

        function resetAllStats() {
            // Tüm istatistikleri sıfırla
            totalPoints = 0;
            starPoints = 0;
            level = 1;
            sessionScore = 0;
            sessionCorrect = 0;
            sessionWrong = 0;
            comboCount = 0;
            
            // Rozetleri sıfırla
            badges = { bronze: 0, silver: 0, gold: 0, diamond: 0 };
            
            // Streak verilerini sıfırla
            streakData = {
                currentStreak: 0,
                playDates: [],
                dailyGoal: 5,
                dailyCorrect: 0
            };
            
            // Daily tasks sıfırla
            dailyTasks = {
                lastTaskDate: null,
                tasks: [],
                bonusTasks: [],
                completedTasks: [],
                rewardsClaimed: false,
                todayStats: {
                    kelimeCevir: 0,
                    dinleBul: 0,
                    boslukDoldur: 0,
                    ayetOku: 0,
                    duaOgre: 0,
                    hadisOku: 0,
                    toplamDogru: 0,
                    toplamPuan: 0,
                    perfectStreak: 0,
                    farklıZorluk: new Set()
                }
            };
            
            // ÜÇ SİSTEMİ DE TAMAMEN TEMİZLE!
            
            // 1. IndexedDB'yi temizle (ANA SİSTEM)
            if (db) {
                try {
                    const transaction = db.transaction(['gameData'], 'readwrite');
                    const store = transaction.objectStore('gameData');
                    store.clear(); // Tüm IndexedDB verilerini sil
                    log.debug('🗑️ IndexedDB temizlendi');
                } catch(e) { 
                    log.error('IndexedDB temizleme hatası:', e); 
                }
            }
            
            // 2. localStorage'ı tamamen temizle
            localStorage.removeItem('hasene_totalPoints');
            localStorage.removeItem('hasene_badges');
            localStorage.removeItem('hasene_streak');
            localStorage.removeItem('hasene_dailyTasks');
            localStorage.removeItem('hasene_currentMode');
            localStorage.removeItem('hasene_currentDifficulty');
            localStorage.removeItem('hasene_wordStats'); // KELİME PANELİ İSTATİSTİKLERİ TEMİZLE!
            localStorage.removeItem('dailyXP'); // GÜNLÜK XP'Yİ SIFIRLA!
            localStorage.removeItem('dailyGoalLevel'); // GÜNLÜK HEDEF SEVİYESİNİ SIFIRLA!
            localStorage.removeItem('lastDailyXPReset'); // GÜNLÜK XP RESET TARİHİNİ TEMİZLE!
            log.debug('🗑️ localStorage tamamen temizlendi (kelime paneli + günlük XP dahil)');
            
            // 3. URL geçmişini temizle (mümkünse)
                try {
                if (window.history.replaceState) {
                    window.history.replaceState({}, '', window.location.pathname);
                }
                log.debug('🗑️ URL geçmişi temizlendi');
            } catch(e) { 
                log.error('URL temizleme hatası:', e); 
            }
            
            // Yeni günlük görevler oluştur
            generateDailyTasks(new Date().toISOString().split('T')[0]);
            
            // Ekranı güncelle
            updateStatsBar();
            updateUI();
            updateDailyGoalDisplay(); // GÜNLÜK HEDEF UI'INI SIFIRLA!
            
            log.game('✅ TÜM 3 SİSTEM TEMİZLENDİ! IndexedDB + localStorage + URL + Günlük XP');
            showCustomAlert('Tüm veriler TAMAMEN sıfırlandı! IndexedDB, localStorage, URL geçmişi ve Günlük XP temizlendi.', 'success', 'Veriler Sıfırlandı');
        }

        function updateStatsBar() {
            // NULL KONTROL - Kritik elementler
            const gamePointsEl = document.getElementById('gamePoints');
            const starPointsEl = document.getElementById('starPoints');
            const playerLevelEl = document.getElementById('playerLevel');
            
            if (!gamePointsEl || !starPointsEl || !playerLevelEl) {
                log.error('❌ HATA: Stats bar elementleri bulunamadı!');
                return;
            }
            
            // Üst bar güncelle
            gamePointsEl.textContent = totalPoints;
            
            // Yıldız puanı güncelle (her 100 puana 1 yıldız - sık geri bildirim için)
            starPoints = Math.floor(totalPoints / 100);
            starPointsEl.textContent = starPoints;
            
            // Rozet sistemini güncelle
            updateBadgeSystem();
            
            // Seviye güncelle (yeni hesaplama sistemi)
            level = calculateLevel(totalPoints);
            playerLevelEl.textContent = level;
            
            // Seviye ilerleme çubuğunu güncelle
            let currentLevelStart, nextLevelStart;
            
            if (level === 1) {
                currentLevelStart = 0;
                nextLevelStart = 1000;
            } else if (level <= 10) {
                const thresholds = [0, 1000, 2500, 5000, 8500, 13000, 19000, 26500, 35500, 46000, 58000];
                currentLevelStart = thresholds[level - 1];
                nextLevelStart = thresholds[level];
            } else {
                // Level 10'dan sonra
                currentLevelStart = 58000 + ((level - 11) * 15000);
                nextLevelStart = 58000 + ((level - 10) * 15000);
            }
            
            const currentLevelPoints = totalPoints - currentLevelStart;
            const levelRequiredPoints = nextLevelStart - currentLevelStart;
            const progressPercentage = Math.max(0, Math.min((currentLevelPoints / levelRequiredPoints) * 100, 100));
            
            const levelProgressElement = document.getElementById('levelProgress');
            if (levelProgressElement) {
                levelProgressElement.style.width = progressPercentage + '%';
            }
            
            // Alt bar (oyun içi stats) güncelle
            const scoreElement = document.getElementById('score');
            const levelElement = document.getElementById('level');
            if (scoreElement) scoreElement.textContent = totalPoints;
            if (levelElement) levelElement.textContent = level;
            
            // Kaydet
            saveStats();
            
            // Debug için mevcut değerleri logla
            log.debug('📊 Mevcut İstatistikler:', {
                totalPoints: totalPoints,
                starPoints: starPoints, 
                level: level,
                sessionScore: sessionScore,
                sessionCorrect: sessionCorrect,
                sessionWrong: sessionWrong
            });
        }
        
        // COMBO FONKSİYONLARI
        function updateCombo() {
            const comboIndicator = document.getElementById('comboIndicator');
            const comboCountEl = document.getElementById('comboCount');
            const comboBonusEl = document.getElementById('comboBonus');
            
            // NULL KONTROL
            if (!comboIndicator || !comboCountEl || !comboBonusEl) {
                log.warn('⚠️ Combo elementleri bulunamadı');
                return;
            }
            
            if (comboCount >= 3) {
                const bonusXP = Math.floor(comboCount / 3) * 5;
                comboCountEl.textContent = comboCount;
                comboBonusEl.textContent = bonusXP;
                
                comboIndicator.style.display = 'block';
                comboIndicator.style.animation = 'comboPopIn 0.3s ease, comboShake 0.5s ease 0.3s';
                
                // Her 3 comboda mesaj göster (bonus zaten addSessionPoints'te eklendi)
                if (comboCount % 3 === 0) {
                    // Combo sesi çal
                    playSound('combo');
                    
                    // Bonus mesajı göster
                    setTimeout(() => {
                        showSuccessMessage(`🔥 COMBO x${comboCount}! +${bonusXP} Bonus XP!`);
                    }, 300);
                }
                
                // 3 saniye sonra gizle
                setTimeout(() => {
                    hideCombo();
                }, 3000);
            }
        }
        
        function hideCombo() {
            const comboIndicator = document.getElementById('comboIndicator');
            comboIndicator.style.animation = 'slideUp 0.3s ease';
            setTimeout(() => {
                comboIndicator.style.display = 'none';
            }, 300);
        }

        // SESSION PUAN FONKSİYONLARI
        function addSessionPoints(points) {
            log.game(`💰 === addSessionPoints(${points}) ÇAĞRILDI ===`);
            log.game(`📊 Önce: sessionScore=${sessionScore}, totalPoints=${totalPoints}`);
            
            // Güvenli puan ekleme - NaN kontrolü
            if (typeof points !== 'number' || isNaN(points)) {
                log.error('❌ Geçersiz puan değeri:', points);
                return;
            }
            
            // Session puanlarını güncelle
            sessionScore += points;
            sessionCorrect++;
            
            // Global puanlara da ekle
            totalPoints += points;
            
            // Bugünkü toplam puana da ekle (günlük performans için)
            dailyTasks.todayStats.toplamPuan += points;
            
            // Daily XP ekle
            addDailyXP(points);
            
            // Doğru cevap sesi
            playSound('correct');
            
            // Combo sistemi
            comboCount++;
            updateCombo();
            
            // Her 3 doğru cevapda combo bonusu
            if (comboCount > 0 && comboCount % 3 === 0) {
                const comboBonus = 5;
                totalPoints += comboBonus;
                dailyTasks.todayStats.toplamPuan += comboBonus; // Bugünkü puana da ekle!
                
                // COMBO BONUSUNU DAILY XP'YE DE EKLE
                addDailyXP(comboBonus);
                
                log.game(`🔥 Combo bonusu: +${comboBonus} XP`);
                
                // COMBO BONUS SONRASI HEMEN UI GÜNCELLE
                updateStatsBar(); // Üst barı hemen güncelle
            }
            
            // Geriye uyumluluk için eski değişkenleri de güncelle
            score = sessionScore;
            correct = sessionCorrect;
            
            // UI güncelle
            updateUI(); // Oyun içi barı güncelle
            updateStatsBar(); // Üst barı güncelle
            checkAchievements(); // Başarımları kontrol et
            
            log.game(`📊 Sonra: sessionScore=${sessionScore}, totalPoints=${totalPoints}, combo=${comboCount}`);
            log.game(`✅ addSessionPoints tamamlandı!`);
        }

        function addSessionWrong() {
            log.game(`❌ === addSessionWrong() ÇAĞRILDI ===`);
            log.game(`📊 Önce: sessionWrong=${sessionWrong}, wrong=${wrong}`);
            sessionWrong++;
            
            // Yanlış cevap sesi
            playSound('wrong');
            
            // Combo kır
            if (comboCount > 0) {
                comboCount = 0;
                hideCombo();
            }
            wrong = sessionWrong; // Geriye uyumluluk
            log.debug(`📊 Sonra: sessionWrong=${sessionWrong}, wrong=${wrong}`);
            log.debug(`🎨 updateUI() çağrılıyor...`);
            updateUI();
            log.debug(`✅ addSessionWrong tamamlandı!`);
        }

        // ============ ROZET SİSTEMİ ============
        function updateBadgeSystem() {
            // 🎯 XP BAZLI ROZET SİSTEMİ (1 saat oyun = ~8500 XP)
            // 🥉 Bronz: 2,000 XP = 1 bronz (~15 dk)
            // 🥈 Gümüş: 8,500 XP = 1 gümüş (~1 saat, 1 günlük hedef)
            // 🥇 Altın: 25,500 XP = 1 altın (~3 gün)
            // 💎 Elmas: 85,000 XP = 1 elmas (~10 gün)
            
            const xp = totalPoints;
            const newBronze = Math.floor(xp / 2000);
            const newSilver = Math.floor(xp / 8500);
            const newGold = Math.floor(xp / 25500);
            const newDiamond = Math.floor(xp / 85000);
            
            // Rozet seviye kontrolü ve modal gösterimi (önce en yüksek rozetleri kontrol et)
            if (newDiamond > badges.diamond) {
                badges.diamond = newDiamond;
                showBadgeUpModal('diamond', '💎 Mütebahhir');
                playSound('levelup'); // Elmas çok önemli, levelup sesi çal
            } else if (newGold > badges.gold) {
                badges.gold = newGold;
                showBadgeUpModal('gold', '🥇 Mütecaviz');
                playSound('levelup');
            } else if (newSilver > badges.silver) {
                badges.silver = newSilver;
                showBadgeUpModal('silver', '🥈 Müterakki');
                playSound('correct');
            } else if (newBronze > badges.bronze) {
                badges.bronze = newBronze;
                showBadgeUpModal('bronze', '🥉 Mübtedi');
                playSound('correct');
            }
            
            // Tüm rozet sayılarını güncelle
            badges.bronze = newBronze;
            badges.silver = newSilver;
            badges.gold = newGold;
            badges.diamond = newDiamond;
        }

        function showBadgeUpModal(badgeType, badgeName) {
            // Rozet kazanma modalı - profesyonel UI
            showCustomAlert(`${badgeName} rozeti kazandınız!`, 'success', 'Tebrikler');
        }

        function showBadgesModal() {
            // Tüm rozet sayılarını güncelle
            document.getElementById('diamondBadgeCount').textContent = badges.diamond;
            document.getElementById('goldBadgeCount').textContent = badges.gold;
            document.getElementById('silverBadgeCount').textContent = badges.silver;
            document.getElementById('bronzeBadgeCount').textContent = badges.bronze;
            
            // İlerleme bilgilerini güncelle
            document.getElementById('badgesModalStars').textContent = starPoints;
            document.getElementById('badgesModalLevel').textContent = level;
            document.getElementById('badgesModalPoints').textContent = totalPoints.toLocaleString();
            
            // Modal'ı göster
            document.getElementById('badgesModal').style.display = 'flex';
        }

        function closeBadgesModal() {
            document.getElementById('badgesModal').style.display = 'none';
        }
        
        function showXPInfoModal() {
            document.getElementById('xpInfoModal').style.display = 'flex';
        }
        
        function closeXPInfoModal() {
            document.getElementById('xpInfoModal').style.display = 'none';
        }

        // ============ İSTATİSTİKLER SİSTEMİ ============
        function showStatsModal() {
            // Genel istatistikleri güncelle
            document.getElementById('statsLevel').textContent = level;
            document.getElementById('statsPoints').textContent = totalPoints.toLocaleString();
            document.getElementById('statsStars').textContent = starPoints;
            
            // Seviye ilerleme barını hesapla
            let currentLevelStart, nextLevelStart;
            const nextLevel = level + 1;
            
            if (level === 1) {
                currentLevelStart = 0;
                nextLevelStart = 1000;
            } else if (level <= 10) {
                const thresholds = [0, 1000, 2500, 5000, 8500, 13000, 19000, 26500, 35500, 46000, 58000];
                currentLevelStart = thresholds[level - 1];
                nextLevelStart = thresholds[level] || (58000 + ((level - 10) * 15000));
            } else {
                // Level 10'dan sonra
                currentLevelStart = 58000 + ((level - 11) * 15000);
                nextLevelStart = 58000 + ((level - 10) * 15000);
            }
            
            const currentLevelPoints = totalPoints - currentLevelStart;
            const levelRequiredPoints = nextLevelStart - currentLevelStart;
            const progressPercentage = Math.max(0, Math.min((currentLevelPoints / levelRequiredPoints) * 100, 100));
            const pointsNeeded = Math.max(0, nextLevelStart - totalPoints);
            
            document.getElementById('statsCurrentLevel').textContent = level;
            document.getElementById('statsNextLevel').textContent = nextLevel;
            document.getElementById('statsLevelProgress').style.width = progressPercentage + '%';
            document.getElementById('statsLevelPointsNeeded').textContent = pointsNeeded.toLocaleString();
            
            // Rozet sayılarını güncelle
            document.getElementById('statsBronze').textContent = badges.bronze;
            document.getElementById('statsSilver').textContent = badges.silver;
            document.getElementById('statsGold').textContent = badges.gold;
            document.getElementById('statsDiamond').textContent = badges.diamond;
            
            // Başarı analizi hesapla
            const totalGameActions = dailyTasks.todayStats.kelimeCevir + dailyTasks.todayStats.dinleBul + 
                                   dailyTasks.todayStats.boslukDoldur + dailyTasks.todayStats.ayetOku + 
                                   dailyTasks.todayStats.duaOgre + dailyTasks.todayStats.hadisOku;
            
            const successRate = totalGameActions > 0 ? Math.round((dailyTasks.todayStats.toplamDogru / totalGameActions) * 100) : 0;
            const avgPointsPerDay = streakData.totalPlayDays > 0 ? Math.round(totalPoints / streakData.totalPlayDays) : totalPoints;
            const playConsistency = Math.round((streakData.totalPlayDays / Math.max(1, getDaysFromFirstPlay())) * 100);
            const levelProgressPercent = Math.round(progressPercentage);
            
            document.getElementById('statsSuccessRate').textContent = successRate + '%';
            document.getElementById('statsAvgPointsPerDay').textContent = avgPointsPerDay.toLocaleString();
            document.getElementById('statsPlayConsistency').textContent = Math.min(100, playConsistency) + '%';
            document.getElementById('statsLevelProgress').textContent = levelProgressPercent + '%';
            
            // Streak bilgilerini güncelle
            document.getElementById('statsCurrentStreak').textContent = streakData.currentStreak;
            document.getElementById('statsBestStreak').textContent = streakData.bestStreak;
            document.getElementById('statsTotalDays').textContent = streakData.totalPlayDays;
            document.getElementById('statsTodayProgress').textContent = Math.min(streakData.todayProgress, streakData.dailyGoal) + '/' + streakData.dailyGoal;
            
            // Bugünkü oyun türü istatistikleri
            document.getElementById('statsKelimeCevir').textContent = dailyTasks.todayStats.kelimeCevir;
            document.getElementById('statsDinleBul').textContent = dailyTasks.todayStats.dinleBul;
            document.getElementById('statsBoslukDoldur').textContent = dailyTasks.todayStats.boslukDoldur;
            document.getElementById('statsAyetOku').textContent = dailyTasks.todayStats.ayetOku;
            document.getElementById('statsDuaOgre').textContent = dailyTasks.todayStats.duaOgre;
            document.getElementById('statsHadisOku').textContent = dailyTasks.todayStats.hadisOku;
            
            // Bugünkü performans
            document.getElementById('statsTodayCorrect').textContent = dailyTasks.todayStats.toplamDogru;
            document.getElementById('statsTodayPoints').textContent = dailyTasks.todayStats.toplamPuan;
            document.getElementById('statsPerfectStreak').textContent = dailyTasks.todayStats.perfectStreak;
            document.getElementById('statsDifficultyCount').textContent = dailyTasks.todayStats.farklıZorluk.size;
            
            // Modal'ı göster
            document.getElementById('statsModal').style.display = 'flex';
            
            // Varsayılan tab'ı göster (Genel)
            switchStatsTab('general');
            
            log.debug('📊 İstatistikler modalı açıldı');
        }

        function getDaysFromFirstPlay() {
            if (streakData.playDates.length === 0) return 1;
            
            const firstPlayDate = new Date(streakData.playDates[0]);
            const today = new Date();
            const diffTime = Math.abs(today - firstPlayDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return Math.max(1, diffDays);
        }
        
        function closeStatsModal() {
            document.getElementById('statsModal').style.display = 'none';
        }
        
        function confirmResetStats() {
            const confirmed = confirm('🚨 DİKKAT!\n\nTüm oyun verilerini sıfırlamak istediğinden emin misin?\n\n• Tüm puanlar (0\'a döner)\n• Tüm rozetler (silinir)\n• Tüm streak verileri (sıfırlanır)\n• Tüm günlük görevler (yenilenir)\n• Tüm istatistikler (temizlenir)\n• KELİME PANELİ istatistikleri (sıfırlanır)\n• GÜNLÜK HEDEF XP (0\'a döner)\n\nBu işlem GERİ ALINMAZ!\n\nDevam etmek istiyor musun?');
            
            if (confirmed) {
                // İkinci onay
                const doubleConfirmed = confirm('🔥 SON UYARI!\n\nGerçekten TÜM VERİLERİ sıfırlamak istiyor musun?\n\nBu işlemden sonra oyuna sıfırdan başlayacaksın!\n\n✅ EVET = Sıfırla\n❌ HAYIR = İptal et');
                
                if (doubleConfirmed) {
                    closeStatsModal(); // Modal'ı kapat
                    resetAllStats(); // Mevcut fonksiyonu kullan
                }
            }
        }

        // Global fonksiyonlar (window'a ekle)
        window.showStatsModal = showStatsModal;
        window.closeStatsModal = closeStatsModal;
        window.confirmResetStats = confirmResetStats;

        // ============ TAKVİM SİSTEMİ ============
        function checkDailyProgress() {
            const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
            
            // Eğer bugün ilk defa açılıyorsa
            if (streakData.todayDate !== today) {
                log.debug(`🕐 Gün değişikliği algılandı: ${streakData.todayDate} → ${today}`);
                
                // Gelişmiş streak kontrolü
                const streakValidation = validateCurrentStreak(today);
                if (!streakValidation.isValid) {
                    log.debug(`🔴 Streak tutarsızlığı: ${streakValidation.reason}`);
                    streakData.currentStreak = streakValidation.correctStreak;
                }
                
                // Bugünün verilerini sıfırla
                streakData.todayDate = today;
                streakData.todayProgress = 0;
                
                log.debug(`📅 Yeni gün başladı: ${today}, mevcut streak: ${streakData.currentStreak}`);
            }
        }

        // 🔍 Streak doğruluğunu kapsamlı kontrol eden fonksiyon
        function validateCurrentStreak(today) {
            if (streakData.playDates.length === 0) {
                return { isValid: true, correctStreak: 0, reason: 'Hiç oyun oynammış' };
            }

            // Tarihleri sırala (en yeniden eskiye)
            const sortedDates = [...streakData.playDates].sort().reverse();
            
            // Bugünden başlayarak geriye doğru ardışık günleri say
            let consecutiveDays = 0;
            let currentDate = today;
            
            for (let i = 0; i < sortedDates.length; i++) {
                if (sortedDates[i] === currentDate) {
                    consecutiveDays++;
                    // Bir önceki günü hesapla
                    const prevDate = new Date(currentDate);
                    prevDate.setDate(prevDate.getDate() - 1);
                    currentDate = prevDate.toISOString().split('T')[0];
                } else {
                    // Ardışık olmayan tarih bulundu, streak burada bitiyor
                    break;
                }
            }

            const isValid = consecutiveDays === streakData.currentStreak;
            const reason = isValid ? 'Streak doğru' : 
                          `Hesaplanan: ${consecutiveDays}, kayıtlı: ${streakData.currentStreak}`;

            return { 
                isValid, 
                correctStreak: consecutiveDays, 
                reason: reason
            };
        }

        // 📅 Mevcut streak'in gerçek tarihlerini hesapla
        function calculateCurrentStreakDates() {
            if (streakData.playDates.length === 0 || streakData.currentStreak === 0) {
                return [];
            }

            // Son oyun tarihinden başlayarak geriye doğru ardışık tarihleri bul
            const sortedDates = [...streakData.playDates].sort().reverse();
            const streakDates = [];
            let currentDate = sortedDates[0]; // En son oyun tarihi

            for (let i = 0; i < sortedDates.length && streakDates.length < streakData.currentStreak; i++) {
                if (sortedDates[i] === currentDate) {
                    streakDates.push(currentDate);
                    // Bir önceki günü hesapla
                    const prevDate = new Date(currentDate);
                    prevDate.setDate(prevDate.getDate() - 1);
                    currentDate = prevDate.toISOString().split('T')[0];
                } else {
                    // Ardışık olmayan tarih, streak burada bitiyor
                    break;
                }
            }

            log.debug(`🔥 Streak tarihleri hesaplandı: [${streakDates.join(', ')}]`);
            return streakDates;
        }

        function updateDailyProgress(correctAnswers) {
            const today = new Date().toISOString().split('T')[0];
            
            // Günlük ilerleme güncelle
            streakData.todayProgress += correctAnswers;
            
            // Takvim açıksa bugünkü hedefi gerçek zamanlı güncelle
            const todayProgressElement = document.getElementById('todayProgress');
            const todayProgressIconElement = document.getElementById('todayProgressIcon');
            
            if (todayProgressElement) {
                const currentProgress = Math.min(streakData.todayProgress, streakData.dailyGoal);
                todayProgressElement.textContent = currentProgress;
                
                // İlerlemeye göre dinamik emoji
                if (todayProgressIconElement) {
                    if (currentProgress >= 5) {
                        todayProgressIconElement.textContent = '✅'; // Tamamlandı
                    } else if (currentProgress >= 3) {
                        todayProgressIconElement.textContent = '🔥'; // İyi gidiyor  
                    } else if (currentProgress >= 1) {
                        todayProgressIconElement.textContent = '💪'; // Başlamış
                    } else {
                        todayProgressIconElement.textContent = '⏳'; // Henüz başlamamış
                    }
                }
            }
            
            // Günlük hedef tamamlandı mı?
            if (streakData.todayProgress >= streakData.dailyGoal && streakData.lastPlayDate !== today) {
                log.debug(`🎯 Günlük hedef tamamlandı! İlerleme: ${streakData.todayProgress}/${streakData.dailyGoal}`);
                
                // İlk defa bugün hedefi tamamladı
                streakData.lastPlayDate = today;
                streakData.totalPlayDays++;
                
                log.debug(`📈 Toplam oyun günü: ${streakData.totalPlayDays}, önceki streak: ${streakData.currentStreak}`);
                
                // Oyun tarihi listesine ekle
                if (!streakData.playDates.includes(today)) {
                    streakData.playDates.push(today);
                    streakData.playDates.sort();
                }
                
                // Streak güncelle - bugün ilk kez hedefi tamamladı
                if (streakData.currentStreak === 0) {
                    // İlk gün veya streak kırılmışsa 1'den başla
                    streakData.currentStreak = 1;
                } else {
                    // Streak devam ediyorsa artır
                    streakData.currentStreak++;
                }
                
                // En iyi streak'i güncelle
                if (streakData.currentStreak > streakData.bestStreak) {
                    streakData.bestStreak = streakData.currentStreak;
                    log.debug(`🏆 Yeni rekor streak: ${streakData.bestStreak} gün!`);
                }
                
                log.debug(`🔥 Streak güncellendi: ${streakData.currentStreak} gün (en iyi: ${streakData.bestStreak})`);
                
                // Streak doğruluğunu kontrol et
                const validation = validateCurrentStreak(today);
                if (!validation.isValid) {
                    log.debug(`⚠️ Streak otomatik düzeltme: ${streakData.currentStreak} → ${validation.correctStreak}`);
                    streakData.currentStreak = validation.correctStreak;
                }

                // Veriyi kaydet
                saveStats();
                
                // Eğer takvim açıksa otomatik yenile (mavi -> yeşil)
                const calendarModal = document.getElementById('calendarModal');
                if (calendarModal && calendarModal.style.display === 'flex') {
                    generateCalendar();
                }
            }
        }

        function showCalendarModal() {
            // Haftalık streak gösterimini oluştur
            generateWeeklyStreakDisplay();
            
            // Aylık takvimi oluştur
            generateMonthlyCalendar();
            
            // Modal'ı göster
            document.getElementById('calendarModal').style.display = 'flex';
        }

        function closeCalendarModal() {
            document.getElementById('calendarModal').style.display = 'none';
        }

        function generateWeeklyStreakDisplay() {
            // Son 7 günü hesapla
            const today = new Date();
            const weekDays = [];
            const dayNames = ['Pz', 'Pt', 'Sl', 'Çr', 'Pr', 'Cm', 'Ct'];
            
            // Son 7 günü geriye doğru hesapla
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                weekDays.push({
                    date: date,
                    dateStr: date.toISOString().split('T')[0],
                    dayName: dayNames[date.getDay()],
                    isToday: i === 0
                });
            }
            
            // PlayDates set'ini oluştur
            const playDatesSet = new Set(streakData.playDates);
            
            // HTML oluştur
            let html = '';
            
            // Container wrapper
            html += '<div style="display: flex; flex-direction: column; gap: 8px; max-width: 100%; margin: 0 auto;">';
            
            // Gün isimleri
            html += '<div style="display: flex; justify-content: space-evenly; align-items: center;">';
            weekDays.forEach(day => {
                const dayColor = day.isToday ? '#f39c12' : '#7f8c8d';
                html += `<div style="text-align: center; font-size: 0.75em; color: ${dayColor}; font-weight: ${day.isToday ? 'bold' : 'normal'}; width: 42px;">${day.dayName}</div>`;
            });
            html += '</div>';
            
            // Streak gösterimi
            html += '<div style="display: flex; justify-content: space-evenly; align-items: center;">';
            weekDays.forEach(day => {
                const hasPlayed = playDatesSet.has(day.dateStr);
                let circleStyle = '';
                let iconContent = '';
                
                if (day.isToday) {
                    if (hasPlayed) {
                        // Bugün oynandı - mavi arka plan, beyaz tick
                        circleStyle = 'width: 42px; height: 42px; border-radius: 50%; background: #3498db; display: flex; align-items: center; justify-content: center; flex-shrink: 0;';
                        iconContent = '✓';
                    } else {
                        // Bugün oynanmadı - gri arka plan
                        circleStyle = 'width: 42px; height: 42px; border-radius: 50%; background: #7f8c8d; display: flex; align-items: center; justify-content: center; flex-shrink: 0;';
                        iconContent = '';
                    }
                } else {
                    if (hasPlayed) {
                        // Geçmiş günler oynandı - turuncu arka plan, beyaz tick
                        circleStyle = 'width: 42px; height: 42px; border-radius: 50%; background: #f39c12; display: flex; align-items: center; justify-content: center; flex-shrink: 0;';
                        iconContent = '✓';
                    } else {
                        // Geçmiş günler oynanmadı - gri arka plan
                        circleStyle = 'width: 42px; height: 42px; border-radius: 50%; background: #7f8c8d; display: flex; align-items: center; justify-content: center; flex-shrink: 0;';
                        iconContent = '';
                    }
                }
                
                html += `<div style="${circleStyle}">
                    <span style="color: white; font-size: 1.3em; font-weight: bold;">${iconContent}</span>
                </div>`;
            });
            html += '</div>'; // Streak gösterimi kapanış
            html += '</div>'; // Container wrapper kapanış
            
            // HTML'i yerleştir
            document.getElementById('weeklyStreakDisplay').innerHTML = html;
        }

        function generateMonthlyCalendar() {
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            const todayDate = today.getDate();
            
            // Ay adını güncelle
            const monthNames = [
                'Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran',
                'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'
            ];
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            // Takvim grid'ini temizle ve yeni HTML oluştur
            const grid = document.getElementById('calendarGrid');
            
            // HTML string olarak oluştur
            let html = '';
            
            // Haftanın günlerini ekle (daha kısa isimler + küçük font)
            const dayNames = ['Pz', 'Pt', 'Sl', 'Çr', 'Pr', 'Cm', 'Ct'];
            dayNames.forEach(day => {
                html += `<div style="font-weight: 600; font-size: 0.55em; color: #95a5a6; padding: 1px; text-align: center; min-height: 14px; display: flex; align-items: center; justify-content: center;">${day}</div>`;
            });
            
            // Ayın ilk gününün haftanın hangi günü olduğunu bul
            const firstDay = new Date(year, month, 1);
            const startingDayOfWeek = (firstDay.getDay() + 6) % 7; // Pazartesi = 0
            
            // Boş günler ekle
            for (let i = 0; i < startingDayOfWeek; i++) {
                html += '<div></div>';
            }
            
            // Mevcut streak'in gerçek tarih aralığını hesapla (doğru algoritma)
            const currentStreakDates = calculateCurrentStreakDates();
            const currentStreakSet = new Set(currentStreakDates);

            // playDates array'ini Set'e çevir
            const playDatesSet = new Set(streakData.playDates);
            
            // Ayın günlerini ekle
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                let style = 'padding: 4px 2px; border-radius: 50%; cursor: pointer; font-size: 0.6em; min-height: 24px; max-height: 28px; max-width: 28px; display: flex; align-items: center; justify-content: center; color: #ecf0f1; flex-direction: column;';
                
                let dayContent = day;
                let tooltip = dateStr;
                
                // Bugün ise vurgula
                if (day === todayDate) {
                    if (playDatesSet.has(dateStr)) {
                        style += ' background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; font-weight: bold; border: 3px solid #3498db; box-shadow: 0 0 12px rgba(52,152,219,0.6);';
                        dayContent = `<div style="font-size: 0.6em;">${day}</div><div style="font-size: 1.2em;">✅</div>`;
                        tooltip = `${dateStr} - Bugün tamamlandı!`;
                    } else {
                        style += ' background: #3498db; color: white; font-weight: bold; box-shadow: 0 0 8px rgba(52,152,219,0.5); animation: pulse 3s infinite;';
                        dayContent = `<div style="font-size: 0.6em;">${day}</div><div style="font-size: 1.2em;">🎯</div>`;
                        tooltip = `${dateStr} - Bugün (henüz oynanmadı)`;
                    }
                }
                // Mevcut streak'in bir parçasıysa (ALEV 🔥)
                else if (currentStreakSet.has(dateStr) && playDatesSet.has(dateStr)) {
                    style += ' background: linear-gradient(135deg, #e74c3c, #f39c12); color: white; font-weight: bold; border: 2px solid #f1c40f; box-shadow: 0 0 10px rgba(231,76,60,0.4);';
                    dayContent = `<div style="font-size: 0.5em;">${day}</div><div style="font-size: 1.4em;">🔥</div>`;
                    tooltip = `${dateStr} - Streak günü! Alev yakıyor! 🔥`;
                }
                // Oyun oynandı ama streak dışında (normal tik)
                else if (playDatesSet.has(dateStr)) {
                    style += ' background: #2ecc71; color: white; font-weight: 600;';
                    dayContent = `<div style="font-size: 0.6em;">${day}</div><div style="font-size: 1.1em;">✓</div>`;
                    tooltip = `${dateStr} - Tamamlandı`;
                }
                // Geçmiş günler - oynanmadı (BUZ ❄️)
                else if (day < todayDate) {
                    style += ' color: #95a5a6; background: rgba(149,165,166,0.1);';
                    dayContent = `<div style="font-size: 0.6em;">${day}</div><div style="font-size: 1.1em;">❄️</div>`;
                    tooltip = `${dateStr} - Oynanmadı (streak dondu!)`;
                }
                
                html += `<div style="${style}" title="${tooltip}">${dayContent}</div>`;
            }
            
            // HTML'i yerleştir
            grid.innerHTML = html;
        }

        // Global fonksiyonlar (window'a ekle ki HTML onclick çalışsın)
        window.showCalendarModal = showCalendarModal;
        window.closeCalendarModal = closeCalendarModal;

        // 🔍 STREAK ANALİZ SİSTEMİ - DEBUG TOOLS
        function analyzeStreakSystem() {
            log.stats('🔍 STREAK SİSTEMİ ANALİZ RAPORU');
            log.stats('=====================================');
            
            const today = new Date().toISOString().split('T')[0];
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            
            // Mevcut streak verilerini analiz et
            log.stats('📊 Mevcut Veriler:');
            log.stats(`├── Bugün: ${today}`);
            log.stats(`├── Dün: ${yesterdayStr}`);
            log.stats(`├── Son oyun tarihi: ${streakData.lastPlayDate}`);
            log.stats(`├── Mevcut streak: ${streakData.currentStreak} gün`);
            log.stats(`├── En iyi streak: ${streakData.bestStreak} gün`);
            log.stats(`├── Bugünkü ilerleme: ${streakData.todayProgress}/${streakData.dailyGoal}`);
            log.stats(`├── Toplam oyun günü: ${streakData.totalPlayDays}`);
            log.stats(`└── Oyun tarihleri: [${streakData.playDates.join(', ')}]`);
            
            // Streak mantık kontrolü
            log.stats('\n🧠 Streak Mantık Kontrolü:');
            const streakShouldBreak = streakData.lastPlayDate !== yesterdayStr && 
                                     streakData.lastPlayDate !== today && 
                                     streakData.lastPlayDate !== '';
            
            log.stats(`├── Streak kırılmalı mı? ${streakShouldBreak ? '✅ EVET' : '❌ HAYIR'}`);
            log.stats(`├── Bugün oynanmış mı? ${streakData.playDates.includes(today) ? '✅ EVET' : '❌ HAYIR'}`);
            log.stats(`├── Dün oynanmış mı? ${streakData.playDates.includes(yesterdayStr) ? '✅ EVET' : '❌ HAYIR'}`);
            
            // Ardışık gün analizi (gelişmiş)
            log.stats('\n📅 Ardışık Gün Analizi:');
            const validation = validateCurrentStreak(today);
            log.stats(`├── Hesaplanan ardışık gün: ${validation.correctStreak}`);
            log.stats(`├── Kayıtlı streak: ${streakData.currentStreak}`);
            log.stats(`├── Tutarlılık: ${validation.isValid ? '✅ DOĞRU' : '❌ YANLIŞ'}`);
            log.stats(`└── Açıklama: ${validation.reason}`);
            
            // Takvim görünümü kontrolü
            log.stats('\n📆 Takvim Görünümü Test:');
            const currentStreakDates = calculateCurrentStreakDates();
            log.stats(`├── Streak tarih aralığı: [${currentStreakDates.join(', ')}]`);
            log.stats(`├── Takvimde 🔥 gösterilecek günler: ${currentStreakDates.length}`);
            
            // Öneriler
            log.stats('\n💡 Öneriler:');
            if (consecutiveDays !== streakData.currentStreak) {
                log.stats('├── ⚠️ Streak hesaplaması düzeltilmeli');
                log.stats(`├── 🔧 Doğru değer: ${consecutiveDays} olmalı`);
            } else {
                log.stats('├── ✅ Streak hesaplaması doğru');
            }
            
            if (streakData.playDates.includes(today) && streakData.todayProgress < streakData.dailyGoal) {
                log.stats('├── ⚠️ Bugün oynanmış ama hedef tamamlanmamış - veri tutarsızlığı');
            }
            
            log.stats('\n=====================================');
            log.stats('🔍 Analiz tamamlandı!');
        }

        // Test fonksiyonları
        function testStreakScenarios() {
            log.stats('🧪 STREAK TEST SENARYOLARİ');
            log.stats('=============================');
            
            // Backup mevcut veri
            const backup = {
                currentStreak: streakData.currentStreak,
                bestStreak: streakData.bestStreak,
                lastPlayDate: streakData.lastPlayDate,
                totalPlayDays: streakData.totalPlayDays,
                todayProgress: streakData.todayProgress,
                playDates: [...streakData.playDates]
            };
            
            log.stats('Test 1: Streak kırılması simülasyonu');
            streakData.lastPlayDate = '2025-11-08'; // 2 gün önce
            checkDailyProgress();
            log.stats(`├── Streak kırıldı mı? ${streakData.currentStreak === 0 ? '✅ EVET' : '❌ HAYIR'}`);
            
            log.stats('\nTest 2: Hedef tamamlama simülasyonu');
            streakData.todayProgress = 0;
            updateDailyProgress(5); // 5 doğru cevap ekle
            log.stats(`├── Hedef tamamlandı mı? ${streakData.todayProgress >= streakData.dailyGoal ? '✅ EVET' : '❌ HAYIR'}`);
            
            // Restore backup
            Object.assign(streakData, backup);
            log.stats('\n🔄 Veriler geri yüklendi');
            log.stats('=============================');
        }

        // Geliştirici araçları - console'da çağırılabilir
        window.analyzeStreak = analyzeStreakSystem;
        window.testStreak = testStreakScenarios;

        // ============ GÜNLİK GÖREVLER SİSTEMİ ============
        function checkDailyTasks() {
            const today = new Date().toISOString().split('T')[0];
            
            log.debug('🔍 Günlük görev kontrolü:', {
                bugün: today,
                sonGörevTarihi: dailyTasks.lastTaskDate,
                yeniGünMü: dailyTasks.lastTaskDate !== today,
                mevcutTamamlananlar: dailyTasks.completedTasks.length,
                bugünküStats: dailyTasks.todayStats
            });
            
            // Eğer yeni gün başladıysa görevleri yenile
            if (dailyTasks.lastTaskDate !== today) {
                log.debug('🔄 Yeni gün başladı, görevler yenileniyor...');
                generateDailyTasks(today);
            } else {
                log.debug('✅ Aynı gün, mevcut görevler korunuyor');
            }
        }

        function generateDailyTasks(date) {
            // Temel görevler listesi
            const baseTasks = [
                { id: 'kelime5', name: '5 kelime çevir', target: 5, current: 0, type: 'kelimeCevir', reward: 1 },
                { id: 'ayet3', name: '3 ayet oku', target: 3, current: 0, type: 'ayetOku', reward: 1 },
                { id: 'dua2', name: '2 dua öğren', target: 2, current: 0, type: 'duaOgre', reward: 1 },
                { id: 'hadis1', name: '1 hadis oku', target: 1, current: 0, type: 'hadisOku', reward: 1 },
                { id: 'dogru10', name: '10 doğru cevap ver', target: 10, current: 0, type: 'toplamDogru', reward: 1 },
                { id: 'puan100', name: '100 puan topla', target: 100, current: 0, type: 'toplamPuan', reward: 1 }
            ];

            // Bonus görevler listesi
            const bonusTasksList = [
                { id: 'perfect5', name: 'Hiç yanlış yapmadan 5 soru çöz', target: 5, current: 0, type: 'perfectStreak', reward: 2 },
                { id: 'allDiff', name: '3 farklı zorlukta oyna', target: 3, current: 0, type: 'farklıZorluk', reward: 2 },
                { id: 'combo15', name: '15 doğru cevap ver (bonus)', target: 15, current: 0, type: 'toplamDogru', reward: 2 },
                { id: 'dinle3', name: '3 kelime dinle', target: 3, current: 0, type: 'dinleBul', reward: 2 },
                { id: 'bosluk2', name: '2 boşluk doldur', target: 2, current: 0, type: 'boslukDoldur', reward: 2 }
            ];

            // Rastgele 2 bonus görev seç
            const selectedBonus = bonusTasksList.sort(() => 0.5 - Math.random()).slice(0, 2);

            dailyTasks.lastTaskDate = date;
            dailyTasks.tasks = baseTasks;
            dailyTasks.bonusTasks = selectedBonus;
            dailyTasks.completedTasks = [];
            dailyTasks.rewardsClaimed = false;
            dailyTasks.todayStats = {
                kelimeCevir: 0,
                dinleBul: 0,
                boslukDoldur: 0,
                ayetOku: 0,
                duaOgre: 0,
                hadisOku: 0,
                toplamDogru: 0,
                toplamPuan: 0,
                perfectStreak: 0,
                farklıZorluk: new Set()
            };

            log.debug('🎯 Yeni günlük görevler oluşturuldu:', {
                tarih: date,
                temelGörevler: baseTasks.length,
                bonusGörevler: selectedBonus.length,
                tamamlananlar: dailyTasks.completedTasks.length,
                stats: dailyTasks.todayStats
            });

            saveStats();
        }

        function updateTaskProgress(gameType, amount = 1) {
            log.debug(`📋 updateTaskProgress çağrıldı: ${gameType} +${amount}`);
            
            // Oyun tipine göre istatistiği güncelle
            if (dailyTasks.todayStats[gameType] !== undefined) {
                const eskiDeger = dailyTasks.todayStats[gameType];
                dailyTasks.todayStats[gameType] += amount;
                log.debug(`📊 ${gameType}: ${eskiDeger} → ${dailyTasks.todayStats[gameType]}`);
            }

            // Zorluk takibi
            if (currentDifficulty) {
                dailyTasks.todayStats.farklıZorluk.add(currentDifficulty);
                log.debug(`🎯 Zorluk eklendi: ${currentDifficulty}, toplam: ${dailyTasks.todayStats.farklıZorluk.size}`);
            }

            // Görevleri kontrol et ve güncelle
            const allTasks = [...dailyTasks.tasks, ...dailyTasks.bonusTasks];
            
            allTasks.forEach(task => {
                const eskiCurrent = task.current;
                if (task.type === gameType) {
                    task.current = Math.min(task.target, dailyTasks.todayStats[gameType]);
                } else if (task.type === 'farklıZorluk') {
                    task.current = dailyTasks.todayStats.farklıZorluk.size;
                }

                // Görev tamamlandı mı?
                if (task.current >= task.target && !dailyTasks.completedTasks.includes(task.id)) {
                    dailyTasks.completedTasks.push(task.id);
                    log.debug(`✅ Görev tamamlandı: ${task.id} (${task.name})`);
                }
                
                if (eskiCurrent !== task.current) {
                    log.debug(`🎯 Görev ilerleme: ${task.id} ${eskiCurrent}/${task.target} → ${task.current}/${task.target}`);
                }
            });

            log.debug(`📋 Toplam tamamlanan görev: ${dailyTasks.completedTasks.length}`);
            saveStats();
        }

        function showDailyTasksModal() {
            // Günlük görevleri kontrol et ve güncelle
            checkDailyTasks();
            
            // Debug: Görev durumunu logla
            log.debug('📋 Daily Tasks Debug:', {
                tasks: dailyTasks.tasks.length,
                bonusTasks: dailyTasks.bonusTasks.length,
                completed: dailyTasks.completedTasks.length,
                lastDate: dailyTasks.lastTaskDate,
                today: new Date().toISOString().split('T')[0]
            });
            
            // Görev verilerini güncelle
            updateTasksDisplay();
            
            // Modal'ı göster
            document.getElementById('dailyTasksModal').style.display = 'flex';
        }

        function closeDailyTasksModal() {
            document.getElementById('dailyTasksModal').style.display = 'none';
        }

        function updateTasksDisplay() {
            // Güvenlik kontrolü: Eğer görevler boşsa, yeniden oluştur
            if (!dailyTasks.tasks || dailyTasks.tasks.length === 0) {
                log.debug('⚠️ Tasks boş, yeniden oluşturuluyor...');
                generateDailyTasks(new Date().toISOString().split('T')[0]);
            }
            
            const completedCount = dailyTasks.completedTasks.length;
            const totalCount = dailyTasks.tasks.length + dailyTasks.bonusTasks.length;
            
            log.debug('📊 updateTasksDisplay:', { completedCount, totalCount });
            
            // Genel ilerleme
            document.getElementById('completedTasks').textContent = completedCount;
            document.getElementById('totalTasks').textContent = totalCount;
            
            const progressPercent = (completedCount / totalCount) * 100;
            document.getElementById('taskProgress').style.width = progressPercent + '%';

            // Temel görevleri göster
            const dailyList = document.getElementById('dailyTasksList');
            dailyList.innerHTML = '';
            
            dailyTasks.tasks.forEach(task => {
                const taskElement = createTaskElement(task);
                dailyList.appendChild(taskElement);
            });

            // Bonus görevleri göster
            const bonusList = document.getElementById('bonusTasksList');
            bonusList.innerHTML = '';
            
            dailyTasks.bonusTasks.forEach(task => {
                const taskElement = createTaskElement(task);
                bonusList.appendChild(taskElement);
            });

            // Ödül bölümü
            const rewardsSection = document.getElementById('rewardsSection');
            if (completedCount === totalCount && !dailyTasks.rewardsClaimed) {
                rewardsSection.style.display = 'block';
            } else {
                rewardsSection.style.display = 'none';
            }
        }

        function createTaskElement(task) {
            const isCompleted = dailyTasks.completedTasks.includes(task.id);
            const progressPercent = (task.current / task.target) * 100;
            
            const div = document.createElement('div');
            div.style.cssText = `
                padding: 10px; 
                border: 2px solid ${isCompleted ? '#4caf50' : '#e0e0e0'}; 
                border-radius: 6px; 
                margin: 6px 0;
                background: ${isCompleted ? '#f1f8e9' : 'white'};
            `;
            
            div.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                    <span style="font-weight: 600; font-size: 0.85em; color: ${isCompleted ? '#2e7d2e' : '#333'};">
                        ${isCompleted ? '✅' : '⏳'} ${getTaskDisplayName(task)}
                    </span>
                    <span style="font-size: 0.75em; color: #666;">+${task.reward} ⭐</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1; background: #f0f0f0; border-radius: 8px; height: 5px; margin-right: 8px;">
                        <div style="background: ${isCompleted ? '#4caf50' : '#2196f3'}; height: 100%; border-radius: 8px; width: ${progressPercent}%; transition: width 0.3s;"></div>
                    </div>
                    <span style="font-size: 0.7em; color: #666; font-weight: 500;">${task.current}/${task.target}</span>
                </div>
            `;
            
            return div;
        }

        function getTaskDisplayName(task) {
            // Görev tipine göre uygun isim döndür
            const taskNames = {
                'kelime5': 'Kelime Çevir',
                'ayet3': 'Ayet Oku', 
                'dua2': 'Dua Öğren',
                'dogru10': 'Doğru Cevaplar',
                'puan100': 'Puan Topla',
                'perfect5': 'Mükemmel Seri',
                'allDiff': 'Farklı Zorluklar',
                'hadis1': 'Hadis Oku',
                'dinle3': 'Dinle & Bul',
                'bosluk2': 'Boşluk Doldur'
            };
            
            return taskNames[task.id] || task.name;
        }

        function claimDailyRewards() {
            const completedCount = dailyTasks.completedTasks.length;
            const totalCount = dailyTasks.tasks.length + dailyTasks.bonusTasks.length;
            
            if (completedCount === totalCount && !dailyTasks.rewardsClaimed) {
                // 2500 XP bonus ver (5 yıldız değerinde)
                const bonusXP = 2500;
                totalPoints += bonusXP;
                
                // Bugünkü toplam puana da ekle (istatistikler için)
                dailyTasks.todayStats.toplamPuan += bonusXP;
                
                // Daily XP'ye de ekle
                addDailyXP(bonusXP);
                
                dailyTasks.rewardsClaimed = true;
                saveStats();
                updateStatsBar();
                checkAchievements();
                
                // Ödül modalı göster
                showSuccessMessage('🎉 Tüm günlük görevleri tamamladın! +2,500 XP bonus!');
                
                updateTasksDisplay();
            }
        }

        // Ödül butonu event listener
        document.addEventListener('DOMContentLoaded', () => {
            const claimBtn = document.getElementById('claimRewardsBtn');
            if (claimBtn) {
                claimBtn.addEventListener('click', claimDailyRewards);
            }
        });

        // Global fonksiyonlar
        window.showDailyTasksModal = showDailyTasksModal;
        window.closeDailyTasksModal = closeDailyTasksModal;
        window.claimDailyRewards = claimDailyRewards;

        // OYUN BİTİŞ FONKSİYONU (Oyun bitince çağrılır)
        // NOT: Puanlar zaten addSessionPoints() ile eklendi, burada sadece kontrol yapıyoruz
        function addToGlobalPoints(points, correctAnswers = 0) {
            // Seviye kontrol et (puanlar zaten totalPoints'e eklendi)
            const oldLevel = level;
            const newLevel = calculateLevel(totalPoints);
            
            // Seviye atlama kontrolü
            if (newLevel > oldLevel) {
                level = newLevel;
                showLevelUpModal(newLevel);
                playSound('levelup');
            }
            
            // Günlük ilerlemeyi güncelle
            if (correctAnswers > 0) {
                updateDailyProgress(correctAnswers);
                
                // Günlük görevleri güncelle
                updateTaskProgress('toplamDogru', correctAnswers);
                // NOT: toplamPuan zaten addSessionPoints'te eklendi, burada tekrar ekleme!
            }
            
            updateStatsBar(); // Global barı güncelle
            checkAchievements(); // Başarımları kontrol et
            saveStats(); // Verileri kaydet
        }
        
        // ============ ZORLUK UI GÜNCELLEYICI ============
        function updateDifficultyUI() {
            // Kaydedilen zorluk seviyesine göre UI'yı ayarla
            log.debug(`🎯 Zorluk UI güncelleniyor: ${currentDifficulty}`);
            
            // Tüm butonları başlangıç durumuna getir
            document.getElementById('mainDiffKolay').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #4CAF50; border: 2px solid #4CAF50;';
            document.getElementById('mainDiffOrta').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #FF9800; border: 2px solid #FF9800;';
            document.getElementById('mainDiffZor').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #f44336; border: 2px solid #f44336;';
            
            // Active class'ları temizle
            document.querySelectorAll('#mainMenu .diff-btn').forEach(btn => btn.classList.remove('active'));
            
            // Seçili zorluk seviyesini vurgula
            if (currentDifficulty === 'kolay') {
                document.getElementById('mainDiffKolay').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #4CAF50; color: white; border: 2px solid #4CAF50;';
                document.getElementById('mainDiffKolay').classList.add('active');
            } else if (currentDifficulty === 'orta') {
                document.getElementById('mainDiffOrta').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #FF9800; color: white; border: 2px solid #FF9800;';
                document.getElementById('mainDiffOrta').classList.add('active');
            } else if (currentDifficulty === 'zor') {
                document.getElementById('mainDiffZor').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #f44336; color: white; border: 2px solid #f44336;';
                document.getElementById('mainDiffZor').classList.add('active');
            }
        }

        // ============ ANA MENÜ ZORLUK BUTONLARI ============
        function initMainMenuDifficultyButtons() {
            // (commented) initMainMenuDifficultyButtons called log removed during cleanup
            
            // Kaydedilen zorluk seviyesini UI'da göster
            updateDifficultyUI();
            
            document.getElementById('mainDiffKolay').onclick = () => {
                log.debug("===== ZORLUK DEĞİŞTİ =====");
                log.debug("YENİ ZORLUK: KOLAY");
                log.debug("Aralık: 5-9");
                log.debug("Çarpan: 2x");
                log.debug("=======================");
                currentDifficulty = 'kolay';
                saveStats(); // Zorluk değiştiğinde kaydet!
                // Kolay yeşil seçili, diğerleri kendi border renkleri ile beyaz
                document.getElementById('mainDiffKolay').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #4CAF50; color: white; border: 2px solid #4CAF50;';
                document.getElementById('mainDiffOrta').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #FF9800; border: 2px solid #FF9800;';
                document.getElementById('mainDiffZor').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #f44336; border: 2px solid #f44336;';
                // Active class'ları güncelle
                document.querySelectorAll('#mainMenu .diff-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('mainDiffKolay').classList.add('active');
            };
            
            document.getElementById('mainDiffOrta').onclick = () => {
                log.debug("===== ZORLUK DEĞİŞTİ =====");
                log.debug("YENİ ZORLUK: ORTA");
                log.debug("Aralık: 10-11");
                log.debug("Çarpan: 2x");
                log.debug("=======================");
                currentDifficulty = 'orta';
                saveStats(); // Zorluk değiştiğinde kaydet!
                // Orta turuncu seçili, diğerleri kendi border renkleri ile beyaz
                document.getElementById('mainDiffKolay').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #4CAF50; border: 2px solid #4CAF50;';
                document.getElementById('mainDiffOrta').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #FF9800; color: white; border: 2px solid #FF9800;';
                document.getElementById('mainDiffZor').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #f44336; border: 2px solid #f44336;';
                // Active class'ları güncelle
                document.querySelectorAll('#mainMenu .diff-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('mainDiffOrta').classList.add('active');
            };
            
            document.getElementById('mainDiffZor').onclick = () => {
                log.debug("===== ZORLUK DEĞİŞTİ =====");
                log.debug("YENİ ZORLUK: ZOR");
                log.debug("Aralık: 12-21");
                log.debug("Çarpan: 2x");
                log.debug("=======================");
                currentDifficulty = 'zor';
                saveStats(); // Zorluk değiştiğinde kaydet!
                // Zor kırmızı seçili, diğerleri kendi border renkleri ile beyaz
                document.getElementById('mainDiffKolay').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #4CAF50; border: 2px solid #4CAF50;';
                document.getElementById('mainDiffOrta').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #FF9800; border: 2px solid #FF9800;';
                document.getElementById('mainDiffZor').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #f44336; color: white; border: 2px solid #f44336;';
                // Active class'ları güncelle
                document.querySelectorAll('#mainMenu .diff-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('mainDiffZor').classList.add('active');
            };
        }

        // ============ ANA MENÜ NAVİGASYONU ============
        // Kelime Çevir modu - oyun modları seçici ile başlar
        elements.kelimeCevirBtn.onclick = () => {
            log.game('📚 === KELİME ÇEVİR OYUNU BAŞLATILIYOR ===');
            log.game('📋 1. Veri kontrol ediliyor...');
            
            if (kelimeBulData.length === 0) {
                log.warn('❌ Kelime verileri yüklenemedi!');
                showCustomAlert('Kelime verileri yüklenemedi! Lütfen sayfayı yenileyin.', 'error');
                return;
            }
            log.game(`✅ Kelime verileri OK: ${kelimeBulData.length} kelime mevcut`);
            log.game(`🎯 Mevcut zorluk: ${currentDifficulty}`);
            
            log.game('📋 2. Mode Selector açılıyor...');
            hideAllModes();
            if (elements.modeSelector) elements.modeSelector.style.display = 'block';
            if (elements.settingsBtn) elements.settingsBtn.style.display = 'block';
            log.game('✅ Mode Selector açıldı!');
        };

        // Dinle ve Bul modu - Doğrudan başlat
        elements.dinleBulBtn.onclick = () => {
            log.game('🔥 === DINLE VE BUL OYUNU BAŞLATILIYOR ===');
            log.game('📋 1. Veri kontrol ediliyor...');
            
            if (kelimeBulData.length === 0) {
                log.warn('❌ Kelime verileri yüklenemedi!');
                showCustomAlert('Kelime verileri yüklenemedi! Lütfen sayfayı yenileyin.', 'error');
                return;
            }
            log.game(`✅ Kelime verileri OK: ${kelimeBulData.length} kelime mevcut`);
            
            log.game('📋 2. Zorluk seviyesi kontrol ediliyor...');
            log.game(`🎯 Mevcut zorluk: ${currentDifficulty}`);
            log.game(`🎯 Zorluk config:`, CONFIG.difficultyLevels[currentDifficulty]);
            
            log.game('📋 3. UI değiştiriliyor...');
            hideAllModes();
            if (elements.dinleMode) elements.dinleMode.style.display = 'block';
            log.game('✅ UI değişikliği tamamlandı');
            
            log.game('📋 4. Oyun değişkenleri sıfırlanıyor...');
            log.game(`🔄 Önceki değerler: score=${dinleScore}, correct=${dinleCorrect}, wrong=${dinleWrong}, questionCount=${dinleQuestionCount}`);
            // Dinle modunu başlat
            dinleScore = 0;
            dinleCorrect = 0;
            dinleWrong = 0;
            dinleQuestionCount = 0;
            log.game(`✅ Yeni değerler: score=${dinleScore}, correct=${dinleCorrect}, wrong=${dinleWrong}, questionCount=${dinleQuestionCount}`);
            log.game(`📊 Session değerler: sessionScore=${sessionScore}, sessionCorrect=${sessionCorrect}, sessionWrong=${sessionWrong}`);
            
            // Audio butonu event handler
            elements.dinleAudioBtn.onclick = () => {
                if (currentDinleQuestion && currentDinleQuestion.ses_dosyasi) {
                    playAudio(currentDinleQuestion.ses_dosyasi, elements.dinleAudioBtn);
                }
            };
            
            // Next butonu event handler'ını buraya taşıdık
            elements.dinleNextBtn.onclick = () => {
                log.debug(`🔄 === NEXT BUTONU TIKLANDI! ===`);
                log.debug(`📊 Mevcut durum: dinleQuestionCount=${dinleQuestionCount}/${DINLE_MAX_QUESTIONS}`);
                log.debug(`🎯 Bir sonraki soru yükleniyor...`);
                elements.dinleNextBtn.style.display = 'none';
                loadDinleQuestion();
            };
            
            updateDinleUI();
            loadDinleQuestion();
        };

        // Boşluk Doldur modu
        elements.boslukDoldurBtn.onclick = () => {
            log.debug('📋 === BOŞLUK DOLDUR OYUNU BAŞLATILIYOR ===');
            log.debug('📋 1. Veri kontrol ediliyor...');

            if (ayetOkuData.length === 0) {
                log.error('❌ Ayet verileri yüklenemedi!');
                showCustomAlert('Ayet verileri yüklenemedi! Lütfen sayfayı yenileyin.', 'error');
                return;
            }
            log.debug(`✅ Ayet verileri OK: ${ayetOkuData.length} ayet mevcut`);
            log.debug(`🎯 Mevcut zorluk: ${currentDifficulty}`);

            log.debug('📋 2. UI değiştiriliyor...');
            hideAllModes();
            if (elements.boslukMode) elements.boslukMode.style.display = 'block';
            log.debug('✅ UI değişikliği tamamlandı');

            log.debug('📋 3. Oyun değişkenleri sıfırlanıyor...');
            log.debug(`🔄 Önceki değerler: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}`);
            // Boşluk modunu başlat
            boslukScore = 0;
            boslukCorrect = 0;
            boslukWrong = 0;
            log.debug(`✅ Yeni değerler: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}`);
            log.debug(`📊 Session değerler: sessionScore=${sessionScore}, sessionCorrect=${sessionCorrect}, sessionWrong=${sessionWrong}`);
            
            updateBoslukUI();
            loadBoslukQuestion();
        };

        // Dua Et modu
        elements.duaEtBtn.onclick = () => {
            if (duaData.length === 0) {
                showCustomAlert('Dua verileri yüklenemedi! Lütfen sayfayı yenileyin.', 'error');
                return;
            }
            hideAllModes();
            if (elements.duaMode) elements.duaMode.style.display = 'block';
            // Rastgele dua ile başla
            currentDuaIndex = Math.floor(Math.random() * duaData.length);
            showDua();
        };

        // Ayet Oku modu
        elements.ayetOkuBtn.onclick = () => {
            if (ayetOkuData.length === 0) {
                showCustomAlert('Ayet verileri yüklenemedi! Lütfen sayfayı yenileyin.', 'error');
                return;
            }
            hideAllModes();
            if (elements.ayetMode) elements.ayetMode.style.display = 'block';
            // Rastgele ayet ile başla
            currentAyetIndex = Math.floor(Math.random() * ayetOkuData.length);
            showAyet();
        };

        // Hadis Oku modu
        elements.hadisOkuBtn.onclick = () => {
            if (hadisData.length === 0) {
                showCustomAlert('Hadis verileri yüklenemedi! Lütfen sayfayı yenileyin.', 'error');
                return;
            }
            hideAllModes();
            if (elements.hadisMode) elements.hadisMode.style.display = 'block';
            // Rastgele hadis ile başla
            currentHadisIndex = Math.floor(Math.random() * hadisData.length);
            showHadis();
        };

        // Geri butonları
        elements.backToMenuBtn.onclick = () => {
            // Ensure all modes are hidden and return to main menu
            hideAllModes();
            if (elements.mainMenu) elements.mainMenu.style.display = 'block';
            if (elements.settingsBtn) elements.settingsBtn.style.display = 'none';
        };

        elements.backFromGameBtn.onclick = async () => {
            // Ses durdur
            stopCurrentAudio();
            
            // Oyun sırasında çıkış - puanlar zaten kaydedildi ama kullanıcıya bilgi verelim
            if (sessionScore > 0) {
                const confirmed = await showCustomConfirm(sessionCorrect, sessionWrong, sessionScore);
                
                if (!confirmed) {
                    return; // Kullanıcı vazgeçti
                }
                
                // Session istatistiklerini günlük görevlere kaydet
                if (sessionCorrect > 0) {
                    updateTaskProgress('toplamDogru', sessionCorrect);
                    // NOT: toplamPuan zaten addSessionPoints'te eklendi, burada tekrar eklemeyelim!
                }
                
                // Session değişkenlerini sıfırla
                sessionScore = 0;
                sessionCorrect = 0;
                sessionWrong = 0;
                comboCount = 0;
                
                log.debug('🏁 Oyundan erken çıkıldı. Puanlar kaydedildi:', {
                    totalPoints,
                    kazanilanPuan: sessionScore
                });
            }
            
            stopTimer();
            if (elements.gameScreen) elements.gameScreen.style.display = 'none';
            if (elements.modeSelector) elements.modeSelector.style.display = 'none';
            if (elements.mainMenu) {
                elements.mainMenu.removeAttribute('style');
                elements.mainMenu.style.display = 'block';
            }
            if (elements.settingsBtn) elements.settingsBtn.style.display = 'none';
        };

        if (elements.backFromAyetBtn) {
            elements.backFromAyetBtn.onclick = () => {
                stopCurrentAudio(); // Mevcut ses varsa durdur
                hideAllModes();
                if (elements.mainMenu) {
                    elements.mainMenu.removeAttribute('style');
                    elements.mainMenu.style.display = 'block';
                }
                if (elements.settingsBtn) elements.settingsBtn.style.display = 'none';
            };
        }

        if (elements.backFromDuaBtn) {
                elements.backFromDuaBtn.onclick = () => {
                log.debug('⬅️ Dua geri butonuna tıklandı');
                stopCurrentAudio(); // Mevcut ses varsa durdur
                hideAllModes();
                if (elements.mainMenu) {
                    elements.mainMenu.removeAttribute('style');
                    elements.mainMenu.style.display = 'block';
                }
                if (elements.settingsBtn) elements.settingsBtn.style.display = 'none';
                log.debug('✅ Ana menüye döndü');
            };
        }

        if (elements.backFromHadisBtn) {
            elements.backFromHadisBtn.onclick = () => {
                stopCurrentAudio(); // Mevcut ses varsa durdur
                hideAllModes();
                if (elements.mainMenu) {
                    elements.mainMenu.removeAttribute('style');
                    elements.mainMenu.style.display = 'block';
                }
                if (elements.settingsBtn) elements.settingsBtn.style.display = 'none';
            };
        }

        elements.backFromBoslukBtn.onclick = async () => {
            // Ses durdur
            stopCurrentAudio();
            
            // Oyun sırasında çıkış - puanlar zaten kaydedildi
            if (boslukScore > 0) {
                const confirmed = await showCustomConfirm(boslukCorrect, boslukWrong, boslukScore);
                
                if (!confirmed) return;
                
                // Session istatistiklerini kaydet
                if (boslukCorrect > 0) {
                    updateTaskProgress('boslukDoldur', boslukCorrect);
                    updateTaskProgress('toplamDogru', boslukCorrect);
                    // NOT: toplamPuan zaten addSessionPoints'te eklendi!
                }
                
                // Reset
                boslukScore = 0;
                boslukCorrect = 0;
                boslukWrong = 0;
                sessionScore = 0;
                sessionCorrect = 0;
                sessionWrong = 0;
                comboCount = 0;
            }
            
            // Hide all modes and return to main menu
            hideAllModes();
            if (elements.mainMenu) {
                elements.mainMenu.removeAttribute('style');
                elements.mainMenu.style.display = 'block';
            }
            if (elements.settingsBtn) elements.settingsBtn.style.display = 'none';
        };

        elements.backFromDinleBtn.onclick = async () => {
            // Ses durdur
            stopCurrentAudio();
            
            // Oyun sırasında çıkış - puanlar zaten kaydedildi
            if (dinleScore > 0) {
                const confirmed = await showCustomConfirm(dinleCorrect, dinleWrong, dinleScore);
                
                if (!confirmed) return;
                
                // Session istatistiklerini kaydet
                if (dinleCorrect > 0) {
                    updateTaskProgress('dinleBul', dinleCorrect);
                    updateTaskProgress('toplamDogru', dinleCorrect);
                    // NOT: toplamPuan zaten addSessionPoints'te eklendi!
                }
                
                // Reset
                dinleScore = 0;
                dinleCorrect = 0;
                dinleWrong = 0;
                sessionScore = 0;
                sessionCorrect = 0;
                sessionWrong = 0;
                comboCount = 0;
            }
            
            // Hide all modes and return to main menu
            hideAllModes();
            if (elements.mainMenu) {
                elements.mainMenu.removeAttribute('style');
                elements.mainMenu.style.display = 'block';
            }
            if (elements.settingsBtn) {
                elements.settingsBtn.style.display = 'none';
            }
        };

        // ============ MOD SEÇİCİYİ BAŞLAT (Sadece Kelime Çevir için) ============
        function initModeSelector() {
            // Sadece Kelime Çevir oyun modlarını oluştur
            Object.keys(CONFIG.gameModes).forEach(modeKey => {
                const mode = CONFIG.gameModes[modeKey];
                const btn = document.createElement('button');
                btn.className = 'mode-btn';
                if (modeKey === currentMode) btn.classList.add('active');
                btn.innerHTML = `<strong>${mode.name}</strong><small>${mode.description}</small>`;
                btn.onclick = () => selectMode(modeKey);
                elements.modeButtons.appendChild(btn);
            });
        }

        // ============ MOD SEÇ ============
        function selectMode(modeKey) {
            currentMode = modeKey;
            saveStats(); // Mod değiştiğinde kaydet!
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.mode-btn').classList.add('active');
        }

        // ============ OYUNU BAŞLAT ============
        elements.startBtn.onclick = () => {
            const mode = CONFIG.gameModes[currentMode];
            
            // Ayarları uygula
            lives = mode.lives;
            if (lives > 0) {
                elements.livesDisplay.style.display = 'block';
                elements.lives.textContent = lives;
            } else {
                elements.livesDisplay.style.display = 'none';
            }

            if (mode.timeLimit > 0) {
                elements.timerDisplay.style.display = 'block';
            } else {
                elements.timerDisplay.style.display = 'none';
            }

            if (mode.showHint) {
                elements.hintBtn.style.display = 'block';
            } else {
                elements.hintBtn.style.display = 'none';
            }

            elements.currentMode.textContent = mode.name;

            // Session puanlarını sıfırla (global puanları koru)
            sessionScore = 0;
            sessionCorrect = 0;
            sessionWrong = 0;
            comboCount = 0;
            questionCount = 0;
            
            // Combo indicator'ı gizle
            hideCombo();
            
            // Geriye uyumluluk için eski değişkenleri de sıfırla
            score = 0;
            correct = 0;
            wrong = 0;

            updateUI();

            // Ekranları değiştir - Sadece Kelime Çevir oyunu başlat
            elements.modeSelector.style.display = 'none';
            elements.gameScreen.style.display = 'block';
            
                // 🎮 Gesture sistemini başlat
                /* gestures removed per cleanup: swipe gestures intentionally disabled
                    Kept commented init call so code can be re-enabled in future if needed. */
                // initGameGestures();
            
            // ⚡ Speed animation ile yeni soruyu yükle
            addSpeedAnimation(elements.gameScreen, 'slide-up');
            
            loadQuestion();
        };

        // ============ AYARLARA DÖN ============
        if (elements.settingsBtn) {
            elements.settingsBtn.onclick = () => {
                stopTimer();
                elements.gameScreen.style.display = 'none';
                elements.modeSelector.style.display = 'block';
            };
        }

        // ============ SORU YÜKLEME (Kelime Çevir) ============
        function loadQuestion() {
            // Önceki ses varsa durdur
            stopCurrentAudio();
            
            log.debug('📚 === KELİME ÇEVİR SORU YÜKLENİYOR (AKILLI SEÇİM) ===');
            log.debug(`📊 Mevcut soru sayısı: ${questionCount}`);
            log.debug(`🎯 Mevcut mod: ${currentMode}`);
            log.debug(`🎯 Zorluk: ${currentDifficulty}`);
            
            const mode = CONFIG.gameModes[currentMode];
            log.debug(`📋 Mod detayları:`, mode);
            
            // Soru sayısı kontrolü - oyun bitirme
            if (questionCount >= mode.questionsPerLevel) {
                log.game(`🏁 === KELİME ÇEVİR OYUNU BİTTİ ===`);
                log.game(`✅ ${mode.questionsPerLevel} soru tamamlandı!`);
                log.game(`📊 Final session score: ${sessionScore}`);
                
                // Günlük görev ilerlemesini güncelle
                updateTaskProgress('kelimeCevir', sessionCorrect);
                
                // Session puanlarını global'e aktar
                log.game(`💰 Session puanları global'e aktarılıyor: ${sessionScore} puan`);
                addToGlobalPoints(sessionScore, sessionCorrect);
                
                // Direkt ana menüye dön (popup yok)
                log.debug(`🔄 Ana menüye dönülüyor...`);
                elements.gameScreen.style.display = 'none';
                elements.modeSelector.style.display = 'none';
                elements.mainMenu.style.display = 'block';
                log.game(`✅ Kelime Çevir oyunu bitti ve ana menüye dönüldü!`);
                return;
            }

            // Can kontrolü
            if (mode.lives > 0 && lives <= 0) {
                log.game(`💀 Can bitti! Oyun sona eriyor...`);
                gameOver('Can bitti!');
                return;
            }

            log.debug(`🔍 Zorluk filtreleme başlıyor...`);
            log.debug(`🎯 Seçili zorluk: ${currentDifficulty}`);

            // Zorluk filtreleme
            const diffLevel = CONFIG.difficultyLevels[currentDifficulty];
            log.debug(`📋 Zorluk aralığı: ${diffLevel.minDiff}-${diffLevel.maxDiff}`);
            log.debug(`📦 Toplam kelime sayısı: ${kelimeBulData.length}`);

            let filteredData = kelimeBulData.filter(w => 
                w.difficulty >= diffLevel.minDiff && w.difficulty <= diffLevel.maxDiff
            );
            log.debug(`✅ Zorluk filtresi sonrası: ${filteredData.length} kelime`);

            // Mod özel zorluk kontrolü
            if (mode.minDifficulty) {
                log.debug(`📋 Mod minimum zorluk kontrolü: >= ${mode.minDifficulty}`);
                filteredData = filteredData.filter(w => w.difficulty >= mode.minDifficulty);
                log.debug(`✅ Mod filtresi sonrası: ${filteredData.length} kelime`);
            }

            if (filteredData.length === 0) {
                filteredData = kelimeBulData;
            }

            // AKILLI KELİME SEÇİMİ - Zorlanılan kelimeleri daha sık göster
            log.debug('🧠 Akıllı kelime seçimi başlıyor...');
            currentQuestion = selectIntelligentWord(filteredData);

            // SEÇİLEN KELİME DETAYLARI
            log.debug("===== SEÇİLEN KELİME =====");
            log.debug("Kelime:", currentQuestion.kelime);
            log.debug("Anlam:", currentQuestion.anlam);
            log.debug("Zorluk:", currentQuestion.difficulty);
            log.debug("ID:", currentQuestion.id);
            log.debug("Zorluk aralığı:", diffLevel.minDiff + "-" + diffLevel.maxDiff);
            const isInRange = currentQuestion.difficulty >= diffLevel.minDiff && currentQuestion.difficulty <= diffLevel.maxDiff;
            log.debug("Aralıkta mı:", isInRange ? "EVET" : "HAYIR");
            log.debug("========================");

            // UI güncelle
            elements.arabicWord.textContent = currentQuestion.kelime;
            elements.sureInfo.textContent = `ID: ${currentQuestion.id} | Zorluk: ${currentQuestion.difficulty} | Aralık: ${diffLevel.minDiff}-${diffLevel.maxDiff}`;

            // Seçenekler oluştur
            const wrongAnswers = getWrongAnswers(3);
            const allOptions = [
                { text: currentQuestion.anlam, correct: true },
                ...wrongAnswers.map(w => ({ text: w.anlam, correct: false }))
            ];

            // Karıştır
            shuffle(allOptions);

            // Seçenekleri göster
            elements.options.innerHTML = '';
            allOptions.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option flutter-option-btn';
                btn.textContent = opt.text;
                btn.onclick = () => checkAnswer(btn, opt.correct);
                elements.options.appendChild(btn);
            });

            // Sıfırla
            elements.feedback.textContent = '';
            elements.feedback.className = 'feedback';
            elements.nextBtn.style.display = 'none';
            elements.hintBtn.disabled = false;

            // İlerleme güncelle
            updateProgress();

            // Süreyi başlat
            if (mode.timeLimit > 0) {
                startTimer(mode.timeLimit);
            }

            // Arapça hareke renklerini uygula
            setTimeout(() => {
                updateArabicTextColoring();
            }, 100);
        }

        // ============ YANLIŞ CEVAPLAR ============
        function getWrongAnswers(count) {
            const wrong = [];
            const filtered = kelimeBulData.filter(w => w.id !== currentQuestion.id);
            
            while (wrong.length < count && filtered.length > 0) {
                const idx = Math.floor(Math.random() * filtered.length);
                const word = filtered[idx];
                
                if (!wrong.find(w => w.anlam === word.anlam)) {
                    wrong.push(word);
                }
                filtered.splice(idx, 1);
            }
            
            return wrong;
        }

        // ============ KARIŞTIR ============
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // ============ CEVAP KONTROL ============
        function checkAnswer(button, isCorrect) {
            log.game(`🚨 === KELİME ÇEVİR CEVAP KONTROLÜ ===`);
            log.game(`👆 Tıklanan buton: "${button.textContent}"`);
            log.game(`✅/❌ isCorrect parametresi: ${isCorrect}`);
            log.game(`📊 Mevcut soru: #${questionCount + 1}`);
            log.game(`📊 Önce - session: score=${sessionScore}, correct=${sessionCorrect}, wrong=${sessionWrong}`);
            log.game(`📊 Önce - kelime çevir: score=${score}, correct=${correct}, wrong=${wrong}`);
            
            stopTimer();
            
            // Tüm butonları kapat
            const allBtns = document.querySelectorAll('.option');
            log.game(`🔒 ${allBtns.length} buton devre dışı bırakılıyor...`);
            allBtns.forEach(btn => btn.disabled = true);

            const mode = CONFIG.gameModes[currentMode];
            const diffLevel = CONFIG.difficultyLevels[currentDifficulty];
            log.game(`🎯 Mod: ${currentMode}, Zorluk: ${currentDifficulty}`);

            // KELİME İSTATİSTİKLERİNİ GÜNCELLE
            log.game(`📊 Kelime istatistiği güncelleniyor: ${currentQuestion.kelime} (ID: ${currentQuestion.id})`);
            updateWordStats(currentQuestion.id, isCorrect);

            if (isCorrect) {
                log.game(`✅ === SAHİH CEVAP İŞLEMİ ===`);
                button.classList.add('correct');
                elements.feedback.textContent = '✅ Mâşâallah!';
                elements.feedback.className = 'feedback correct';
                
                // 🎆 SUCCESS ANIMATIONS & FEEDBACK
                triggerSuccessBurst(button);
                triggerHaptic('success');
                addSpeedAnimation(elements.feedback, 'bounce-in');
                
                // Combo sistemi için confetti
                if (comboCount >= 2) {
                    triggerConfetti();
                    triggerHaptic('combo');
                }
                
                const points = currentQuestion.difficulty * diffLevel.pointsMultiplier;
                log.game(`💰 Puan hesaplama: ${currentQuestion.difficulty} × ${diffLevel.pointsMultiplier} = ${points} puan`);
                log.game(`📊 addSessionPoints(${points}) çağrılıyor...`);
                addSessionPoints(points); // Session puanına ekle
                
                // Daily task progress - her doğru cevap için
                updateTaskProgress('kelimeCevir', 1);
                
                // Perfect streak kontrolü - hiç yanlış yapmamışsak perfect streak artır
                if (sessionWrong === 0) {
                    updateTaskProgress('perfectStreak', 1);
                    log.game(`🔥 Perfect streak artırıldı! Mevcut: ${dailyTasks.todayStats.perfectStreak}`);
                }
                
                log.game(`✅ Doğru cevap işlemi tamamlandı!`);
                
                updateUI();
            } else {
                log.game(`❌ === HATA CEVAP İŞLEMİ ===`);
                button.classList.add('wrong');
                elements.feedback.textContent = `❌ Hatalı! Sahih: ${currentQuestion.anlam}`;
                elements.feedback.className = 'feedback wrong';
                
                // 📱 ERROR FEEDBACK
                triggerHaptic('error');
                addSpeedAnimation(elements.feedback, 'zoom-in');
                
                log.game(`📊 addSessionWrong() çağrılıyor...`);
                addSessionWrong(); // Session yanlış sayısını artır
                
                log.game(`💸 Puan cezası uygulanıyor: ${CONFIG.wrongAnswerPenalty} puan`);
                log.game(`📊 Eski score: ${score}`);
                // Puan cezası
                score = Math.max(0, score - CONFIG.wrongAnswerPenalty);
                log.game(`📊 Yeni score: ${score}`);
                
                // Can kaybı
                if (mode.lives > 0) {
                    log.game(`💀 Can kaybı: ${lives} - 1 = ${lives - 1}`);
                    lives--;
                    elements.lives.textContent = lives;
                    
                    if (lives <= 0) {
                        setTimeout(() => gameOver('Canlarınız bitti!'), 1500);
                    }
                }

                updateUI();

                // Doğru cevabı göster
                allBtns.forEach(btn => {
                    if (btn.textContent.includes(currentQuestion.anlam)) {
                        btn.classList.add('correct');
                    }
                });
            }

            questionCount++;
            // Show the next button (Kelime)
            try {
                if (elements && elements.nextBtn) {
                    elements.nextBtn.style.display = 'block';
                    elements.nextBtn.style.visibility = 'visible';
                    elements.nextBtn.removeAttribute('hidden');
                    elements.nextBtn.setAttribute('aria-hidden', 'false');
                    // Ensure it's visible on small viewports by scrolling it into view
                    setTimeout(() => {
                        try {
                            elements.nextBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        } catch (e) {
                            log.warn('scrollIntoView failed:', e);
                        }
                    }, 60);
                } else {
                    log.warn('elements.nextBtn is not available to show');
                }
            } catch (err) {
                log.error('Error while showing nextBtn for Kelime:', err);
            }
        }

        // ============ SES ÇALMA ============
        elements.audioBtn.onclick = () => {
            if (currentQuestion && currentQuestion.ses_dosyasi) {
                playAudio(currentQuestion.ses_dosyasi, elements.audioBtn);
            }
        };

        // ============ SONRAKİ SORU ============
        elements.nextBtn.onclick = () => {
            // ⚡ Speed animation ve haptic feedback
            addSpeedAnimation(elements.gameScreen, 'fade-in');
            triggerHaptic('light');
            
            loadQuestion();
        };

        // ============ İLERLEME GÜNCELLE ============
        function updateProgress() {
            const mode = CONFIG.gameModes[currentMode];
            const progress = (questionCount / mode.questionsPerLevel) * 100;
            if (elements.progressBar) {
                elements.progressBar.style.width = `${progress}%`;
            }
        }

        // ============ UI GÜNCELLE ============
        function updateUI() {
            // Alt bar: Sadece session (oyun içi) puanları göster
            elements.score.textContent = sessionScore;
            elements.correct.textContent = sessionCorrect;
            elements.wrong.textContent = sessionWrong;
            elements.level.textContent = level; // Global seviye
        }

        // ============ SÜRE YÖNETİMİ ============
        function startTimer(seconds) {
            stopTimer();
            timeLeft = seconds;
            
            // Timer elementini kontrol et
            if (elements.timer) {
                elements.timer.textContent = timeLeft;
            }
            
            timer = setInterval(() => {
                timeLeft--;
                
                // Timer elementini sadece varsa güncelle
                if (elements.timer) {
                    elements.timer.textContent = timeLeft;
                }
                
                if (timeLeft <= 0) {
                    stopTimer();
                    gameOver('Süre doldu!');
                }
            }, 1000);
        }

        function stopTimer() {
            if (timer) {
                clearInterval(timer);
                timer = null;
            }
        }

        // ============ İPUCU ============
        elements.hintBtn.onclick = () => {
            // Bir yanlış cevabı kaldır
            const allBtns = document.querySelectorAll('.option');
            const wrongBtns = Array.from(allBtns).filter(btn => 
                !btn.textContent.includes(currentQuestion.anlam) && !btn.disabled
            );
            
            if (wrongBtns.length > 0) {
                const randomWrong = wrongBtns[Math.floor(Math.random() * wrongBtns.length)];
                randomWrong.style.opacity = '0.3';
                randomWrong.disabled = true;
                
                // İpucu puan cezası
                score = Math.max(0, score - 10);
                updateUI();
                
                elements.hintBtn.disabled = true;
            }
        };

        // ============ SEVİYE ATLAMA ============
        function showLevelUpModal(newLevel) {
            elements.newLevel.textContent = newLevel;
            
            // Modal için ek bilgileri güncelle
            const modalTotalPoints = document.getElementById('modalTotalPoints');
            const modalNextLevelPoints = document.getElementById('modalNextLevelPoints');
            
            if (modalTotalPoints && modalNextLevelPoints) {
                modalTotalPoints.textContent = totalPoints.toLocaleString();
                modalNextLevelPoints.textContent = getNextLevelRequiredPoints(newLevel).toLocaleString();
            }
            
            // Seviye atlama sesi çal
            playSound('levelup');
            
            // Konfeti efekti başlat!
            createConfetti();
            
            elements.modal.style.display = 'flex';
        }
        
        function createConfetti() {
            const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE'];
            const confettiCount = 50;
            
            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.cssText = `
                        position: fixed;
                        width: 10px;
                        height: 10px;
                        background: ${colors[Math.floor(Math.random() * colors.length)]};
                        left: ${Math.random() * 100}%;
                        top: -10px;
                        opacity: 1;
                        transform: rotate(${Math.random() * 360}deg);
                        z-index: 10000;
                        pointer-events: none;
                        border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                    `;
                    
                    document.body.appendChild(confetti);
                    
                    const fall = confetti.animate([
                        { 
                            transform: `translateY(0) rotate(${Math.random() * 360}deg)`,
                            opacity: 1
                        },
                        { 
                            transform: `translateY(${window.innerHeight + 20}px) rotate(${Math.random() * 360 + 720}deg)`,
                            opacity: 0
                        }
                    ], {
                        duration: 2000 + Math.random() * 1000,
                        easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                    });
                    
                    fall.onfinish = () => confetti.remove();
                }, i * 30);
            }
        }

        // NOTE: eski levelUp fonksiyonu kaldırıldı (unused)

        // ============ OYUN BİTTİ ============
        function gameOver(reason) {
            stopTimer();
            
            // Session puanlarını global'e aktar
            addToGlobalPoints(sessionScore, sessionCorrect);
            
            if (elements.gameOverTitle) elements.gameOverTitle.textContent = '😢 Oyun Bitti';
            if (elements.gameOverText) elements.gameOverText.textContent = reason;
            if (elements.finalScore) elements.finalScore.textContent = `Bu Oyun: ${sessionScore} puan\nToplam: ${totalPoints} puan`;
            if (elements.gameOverModal) elements.gameOverModal.style.display = 'block';
        }

        // ============ YENİDEN BAŞLAT ============
        elements.restartBtn.onclick = () => {
            if (elements.gameOverModal) elements.gameOverModal.style.display = 'none';
            if (elements.gameScreen) elements.gameScreen.style.display = 'none';
            if (elements.modeSelector) elements.modeSelector.style.display = 'none';
            if (elements.mainMenu) elements.mainMenu.style.display = 'block';
            if (elements.settingsBtn) elements.settingsBtn.style.display = 'none';
        };

        // ============ MODAL KAPAT ============
        elements.modalBtn.onclick = () => {
            if (elements.modal) elements.modal.style.display = 'none';
            // Sadece modal'ı kapat - seviye yükselme bilgilendirmesi için gereksiz işlem yapma
        };

        // ============ DİNLE VE BUL MODU ============
        let currentDinleQuestion = null;
        let dinleQuestionCount = 0;
        const DINLE_MAX_QUESTIONS = 10;

        function loadDinleQuestion() {
            // Önceki ses varsa durdur
            stopCurrentAudio();
            
            log.debug(`🎪 === SORU YÜKLENİYOR ===`);
            log.debug(`📊 Mevcut soru sayısı: ${dinleQuestionCount}/${DINLE_MAX_QUESTIONS}`);
            log.debug(`📊 Oyun durumu: score=${dinleScore}, correct=${dinleCorrect}, wrong=${dinleWrong}`);
            
            // 10 soru kontrolü
            if (dinleQuestionCount >= DINLE_MAX_QUESTIONS) {
                log.game(`🏁 === OYUN BİTİŞİ TETİKLENDİ ===`);
                log.game(`✅ ${DINLE_MAX_QUESTIONS} soru tamamlandı!`);
                log.game(`📊 Final oyun skorları: dinleScore=${dinleScore}, dinleCorrect=${dinleCorrect}, dinleWrong=${dinleWrong}`);
                log.game(`📊 Final session skorları: sessionScore=${sessionScore}, sessionCorrect=${sessionCorrect}, sessionWrong=${sessionWrong}`);
                
                // Günlük görev ilerlemesini güncelle
                updateTaskProgress('dinleBul', sessionCorrect);
                
                log.game(`💰 Session puanları global'e aktarılıyor: ${sessionScore} puan`);
                // Session puanlarını global'e aktar
                addToGlobalPoints(sessionScore, sessionCorrect);
                
                log.debug(`🔄 Ana menüye dönülüyor...`);
                // Direkt ana menüye dön
                elements.dinleMode.style.display = 'none';
                elements.mainMenu.style.display = 'block';
                
                log.debug(`🧹 Oyun değişkenleri temizleniyor...`);
                // Sıfırla
                dinleScore = 0;
                dinleCorrect = 0;
                dinleWrong = 0;
                dinleQuestionCount = 0;
                updateDinleUI();
                log.game(`✅ Oyun bitti ve ana menüye dönüldü!`);
                return;
            }

            log.debug(`🔍 Zorluk filtreleme başlıyor...`);
            log.debug(`🎯 Seçili zorluk: ${currentDifficulty}`);
            // Zorluk filtreleme (Kelime Çevir ile aynı)
            const diffLevel = CONFIG.difficultyLevels[currentDifficulty];
            log.debug(`📋 Zorluk aralığı: ${diffLevel.minDiff}-${diffLevel.maxDiff}`);
            log.debug(`📦 Toplam kelime sayısı: ${kelimeBulData.length}`);
            
            let filteredData = kelimeBulData.filter(w => 
                w.difficulty >= diffLevel.minDiff && w.difficulty <= diffLevel.maxDiff
            );
            log.debug(`✅ Filtrelenmiş kelime sayısı: ${filteredData.length}`);

            if (filteredData.length === 0) {
                log.debug(`⚠️ Filtrelenmiş veri boş! Tüm kelimeler kullanılacak.`);
                filteredData = kelimeBulData;
            }

            log.debug(`🧠 Akıllı kelime seçimi (Dinle Modu) başlıyor...`);
            currentDinleQuestion = selectIntelligentWord(filteredData);
            
            // 🔍 SEÇİLEN KELİME DETAYLARI (DİNLE MODU)
            log.debug("===== DINLE MODU KELİME =====");
            log.debug(`� Kelime: ${currentDinleQuestion.kelime}`);
            log.debug("Anlam:", currentDinleQuestion.anlam);
            log.debug("Zorluk:", currentDinleQuestion.difficulty);
            log.debug("ID:", currentDinleQuestion.id);
            log.debug("Zorluk aralığı:", diffLevel.minDiff + "-" + diffLevel.maxDiff);
            const isInRange = currentDinleQuestion.difficulty >= diffLevel.minDiff && currentDinleQuestion.difficulty <= diffLevel.maxDiff;
            log.debug("Aralıkta mı:", isInRange ? "EVET" : "HAYIR");
            log.debug("Puan:", currentDinleQuestion.difficulty * 2);
            log.debug("==========================");

            log.debug(`🎨 UI güncelleniyor...`);
            // UI güncelle
            elements.dinleSureInfo.textContent = `ID: ${currentDinleQuestion.id} | Zorluk: ${currentDinleQuestion.difficulty} | Aralık: ${diffLevel.minDiff}-${diffLevel.maxDiff}`;
            log.debug(`✅ Kelime ID: ${currentDinleQuestion.id}`);

            log.debug(`🔀 Seçenekler oluşturuluyor... (4 Arapça kelime)`);
            // Seçenekler oluştur (4 Arapça kelime) - aynı zorluktan
            const wrongAnswers = [];
            let attempts = 0;
            while (wrongAnswers.length < 3 && attempts < 50) {
                attempts++;
                const random = filteredData[Math.floor(Math.random() * filteredData.length)];
                if (random.kelime !== currentDinleQuestion.kelime && 
                    !wrongAnswers.find(w => w.kelime === random.kelime)) {
                    wrongAnswers.push(random);
                    log.debug(`✅ Yanlış cevap #${wrongAnswers.length}: "${random.kelime}" (zorluk: ${random.difficulty})`);
                }
            }
            log.debug(`📊 Yanlış cevap oluşturma: ${attempts} deneme, ${wrongAnswers.length}/3 başarılı`);

            const allOptions = [
                { text: currentDinleQuestion.kelime, correct: true },
                ...wrongAnswers.map(w => ({ text: w.kelime, correct: false }))
            ];
            log.debug(`🎯 Doğru cevap: "${currentDinleQuestion.kelime}" (index: 0)`);
            log.debug(`❌ Yanlış cevaplar: ${wrongAnswers.map(w => `"${w.kelime}"`).join(', ')}`);

            shuffle(allOptions);

            // Seçenekleri göster
            elements.dinleOptions.innerHTML = '';
            allOptions.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option flutter-option-btn';
                // Arapça ise özel sınıf ekle ve düzgün formatlama
                if (isArabic(opt.text)) {
                    btn.classList.add('arabic-option');
                    btn.innerHTML = `<span style="direction: rtl;">${opt.text}</span>`;
                } else {
                    btn.textContent = opt.text;
                }
                btn.onclick = () => checkDinleAnswer(btn, opt.correct);
                elements.dinleOptions.appendChild(btn);
            });

            elements.dinleFeedback.textContent = '';
            elements.dinleFeedback.className = 'feedback';
            elements.dinleNextBtn.style.display = 'none';

            // Otomatik ses çal
            if (currentDinleQuestion.ses_dosyasi) {
                playAudio(currentDinleQuestion.ses_dosyasi, elements.dinleAudioBtn);
            }

            // Arapça hareke renklerini uygula
            setTimeout(() => {
                updateArabicTextColoring();
            }, 100);
        }

        function checkDinleAnswer(button, isCorrect) {
            log.debug(`🚨 === CEVAP KONTROLÜ BAŞLIYOR ===`);
            log.debug(`👆 Tıklanan buton: "${button.textContent}"`);
            log.debug(`✅/❌ isCorrect parametresi: ${isCorrect}`);
            log.debug(`📊 Mevcut soru: #${dinleQuestionCount + 1}/${DINLE_MAX_QUESTIONS}`);
            log.debug(`� Önce - session score: ${sessionScore}, session correct: ${sessionCorrect}, session wrong: ${sessionWrong}`);
            log.debug(`📊 Önce - dinle score: ${dinleScore}, dinle correct: ${dinleCorrect}, dinle wrong: ${dinleWrong}`);
            
            // KELİME İSTATİSTİKLERİNİ GÜNCELLE (Dinle Modu)
            log.debug(`📊 Kelime istatistiği güncelleniyor (Dinle): ${currentDinleQuestion.kelime} (ID: ${currentDinleQuestion.id})`);
            updateWordStats(currentDinleQuestion.id, isCorrect);
            
            const allBtns = elements.dinleOptions.querySelectorAll('.option');
            log.debug(`🔒 ${allBtns.length} buton devre dışı bırakılıyor...`);
            allBtns.forEach(btn => btn.disabled = true);

            if (isCorrect) {
                log.debug(`✅ === SAHİH CEVAP İŞLEMİ ===`);
                button.classList.add('correct');
                elements.dinleFeedback.textContent = '✅ Mâşâallah!';
                elements.dinleFeedback.className = 'feedback correct';
                
                const points = currentDinleQuestion.difficulty * 2;
                log.debug(`💰 Puan hesaplama: ${currentDinleQuestion.difficulty} × 2 = ${points} puan`);
                
                log.debug(`📊 Dinle score güncelleniyor: ${dinleScore} + ${points} = ${dinleScore + points}`);
                dinleScore += points; // Local oyun puanı
                
                log.debug(`📊 Dinle correct güncelleniyor: ${dinleCorrect} + 1 = ${dinleCorrect + 1}`);
                dinleCorrect++;
                
                log.debug(`📊 addSessionPoints(${points}) çağrılıyor...`);
                addSessionPoints(points); // Session puanına ekle
                
                // Daily task progress - her doğru cevap için
                updateTaskProgress('dinleBul', 1);
                
                // Perfect streak kontrolü - hiç yanlış yapmamışsak perfect streak artır
                if (sessionWrong === 0) {
                    updateTaskProgress('perfectStreak', 1);
                    log.debug(`🔥 Perfect streak artırıldı! Mevcut: ${dailyTasks.todayStats.perfectStreak}`);
                }
                
                log.debug(`✅ Doğru cevap işlemi tamamlandı!`);
                log.debug(`📊 Sonra - session score: ${sessionScore}, session correct: ${sessionCorrect}`);
            } else {
                log.debug(`❌ === YANLIŞ CEVAP İŞLEMİ ===`);
                button.classList.add('wrong');
                elements.dinleFeedback.textContent = `❌ Hatalı! Doğru: ${currentDinleQuestion.kelime} (${currentDinleQuestion.anlam})`;
                elements.dinleFeedback.className = 'feedback wrong';
                
                log.debug(`📊 Dinle wrong güncelleniyor: ${dinleWrong} + 1 = ${dinleWrong + 1}`);
                dinleWrong++;
                
                log.debug(`📊 addSessionWrong() çağrılıyor...`);
                addSessionWrong(); // Session yanlış sayısını artır
                log.debug(`❌ ÖNEMLI: Yanlış cevap için puan EKLENMEDİ!`);
                log.debug(`📊 Session score değişmedi: ${sessionScore}`);

                log.debug(`🔍 Doğru cevabı gösteriliyor...`);
                // Doğru cevabı göster
                let correctButtonFound = false;
                allBtns.forEach(btn => {
                    if (btn.textContent.includes(currentDinleQuestion.kelime)) {
                        btn.classList.add('correct');
                        correctButtonFound = true;
                        log.debug(`✅ Doğru buton bulundu ve işaretlendi: "${btn.textContent}"`);
                    }
                });
                if (!correctButtonFound) {
                    log.warn(`⚠️ Doğru buton bulunamadı!`);
                }
            }

            log.debug(`📊 Soru sayacı artırılıyor: ${dinleQuestionCount} + 1 = ${dinleQuestionCount + 1}`);
            dinleQuestionCount++; // Soru sayacını artır
            log.debug(`📊 FINAL - session: score=${sessionScore}, correct=${sessionCorrect}, wrong=${sessionWrong}`);
            log.debug(`📊 FINAL - dinle: score=${dinleScore}, correct=${dinleCorrect}, wrong=${dinleWrong}, questionCount=${dinleQuestionCount}`);
            log.debug(`🚨 === CEVAP KONTROLÜ BİTTİ ===`);
            log.debug(`🎨 UI güncelleniyor ve Next butonu gösteriliyor...`);
            updateDinleUI();
            // Show the Dinle 'Next' button
            elements.dinleNextBtn.style.display = 'block';
            log.debug(`✅ Cevap işlemi tamamen tamamlandı!`);
        }

        function updateDinleUI() {
            log.debug(`🎨 DinleUI güncelleniyor...`);
            log.debug(`📊 Gösterilecek değerler: score=${dinleScore}, correct=${dinleCorrect}, wrong=${dinleWrong}`);
            elements.dinleScore.textContent = dinleScore;
            elements.dinleCorrect.textContent = dinleCorrect;
            elements.dinleWrong.textContent = dinleWrong;
            log.debug(`✅ DinleUI güncellendi!`);
        }

        // ============ BOŞLUK DOLDUR MODU ============
        let currentBoslukQuestion = null;
        let missingWord = '';
        let missingIndex = -1;
        let boslukQuestionCount = 0;
        const BOSLUK_MAX_QUESTIONS = 10;

        function loadBoslukQuestion() {
            // Önceki ses varsa durdur
            stopCurrentAudio();
            
            if (boslukQuestionCount >= BOSLUK_MAX_QUESTIONS) {
                log.game(`🏁 === BOŞLUK DOLDUR OYUNU BİTTİ ===`);
                log.game(`✅ ${BOSLUK_MAX_QUESTIONS} soru tamamlandı!`);
                log.game(`📊 Final oyun skorları: boslukScore=${boslukScore}, boslukCorrect=${boslukCorrect}, boslukWrong=${boslukWrong}`);
                log.game(`📊 Final session skorları: sessionScore=${sessionScore}, sessionCorrect=${sessionCorrect}, sessionWrong=${sessionWrong}`);
                
                // Günlük görev ilerlemesini güncelle
                updateTaskProgress('boslukDoldur', sessionCorrect);
                
                log.game(`💰 Session puanları global'e aktarılıyor: ${sessionScore} puan`);
                // Session puanlarını global'e aktar
                addToGlobalPoints(sessionScore, sessionCorrect);
                
                log.debug(`🔄 Ana menüye dönülüyor...`);
                // Direkt ana menüye dön
                elements.boslukMode.style.display = 'none';
                elements.mainMenu.style.display = 'block';
                
                log.debug(`🧹 Oyun değişkenleri temizleniyor...`);
                // Sıfırla
                boslukScore = 0;
                boslukCorrect = 0;
                boslukWrong = 0;
                boslukQuestionCount = 0;
                updateBoslukUI();
                log.game(`✅ Boşluk Doldur oyunu bitti ve ana menüye dönüldü!`);
                return;
            }

            log.debug(`🔍 Ayet filtreleme başlıyor...`);
            // Rastgele ayet seç (ayet_metni olan ayetleri filtrele)
            const validAyets = ayetOkuData.filter(a => a.ayet_metni && a.ayet_metni.trim());
            log.debug(`📦 Toplam ayet sayısı: ${ayetOkuData.length}`);
            log.debug(`✅ Geçerli ayet sayısı: ${validAyets.length}`);
            
            if (validAyets.length === 0) {
                log.error('❌ Geçerli ayet bulunamadı!');
                return;
            }
            
            log.debug(`🎲 Rastgele ayet seçiliyor...`);
            const randomIndex = Math.floor(Math.random() * validAyets.length);
            const ayet = validAyets[randomIndex];
            log.debug(`✅ Seçilen ayet index: ${randomIndex}/${validAyets.length}`);
            
            log.debug(`📝 === SORU #${boslukQuestionCount + 1} ===`);
            log.debug(`📖 Sure: ${ayet.sure_adi || 'Bilinmiyor'}`);
            log.debug(`🔢 Ayet No: ${ayet.ayet_no || 'Bilinmiyor'}`);
            log.debug(`📝 Ayet Metni: "${ayet.ayet_metni}"`);
            
            // Ayet metnini kelimelere böl
            const words = ayet.ayet_metni.split(' ').filter(w => w && w.trim());
            log.debug(`🔤 Kelime sayısı: ${words.length}`);
            log.debug(`🔤 Kelimeler:`, words);
            
            if (words.length < 4) {
                // Çok kısa ayetler için tekrar dene
                loadBoslukQuestion();
                return;
            }

            // Rastgele bir kelimeyi gizle
            missingIndex = Math.floor(Math.random() * words.length);
            missingWord = words[missingIndex];

            // Boşluk ile değiştir
            const displayText = words.map((w, i) => i === missingIndex ? '______' : w).join(' ');

            currentBoslukQuestion = ayet;

            // UI güncelle
            elements.boslukAyetText.textContent = displayText;

            // Seçenekler oluştur (boşluğa gelecek kelime)
            const wrongWords = [];
            let attempts = 0;
            while (wrongWords.length < 3 && attempts < 100) {
                attempts++;
                const randomAyet = validAyets[Math.floor(Math.random() * validAyets.length)];
                if (!randomAyet.ayet_metni) continue;
                
                const randomWords = randomAyet.ayet_metni.split(' ').filter(w => w && w.trim());
                if (randomWords.length === 0) continue;
                
                const randomWord = randomWords[Math.floor(Math.random() * randomWords.length)];
                if (randomWord && randomWord !== missingWord && !wrongWords.includes(randomWord)) {
                    wrongWords.push(randomWord);
                }
            }
            
            // Eğer yeterli yanlış cevap bulunamadıysa, eksik olanları doldur
            while (wrongWords.length < 3) {
                wrongWords.push('...');
            }

            const allOptions = [
                { text: missingWord, correct: true },
                ...wrongWords.map(w => ({ text: w, correct: false }))
            ];

            shuffle(allOptions);

            // Seçenekleri göster
            elements.boslukOptions.innerHTML = '';
            allOptions.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option flutter-option-btn';
                // Boşluk Doldur'da her zaman Arapça format kullan (ayet parçaları)
                if (opt.text === '...' || opt.text.trim() === '') {
                    // Boş seçenekler için normal format
                    btn.textContent = opt.text;
                } else {
                    // Arapça kelimeler için özel format
                    btn.classList.add('arabic-option');
                    btn.innerHTML = `<span style="direction: rtl;">${opt.text}</span>`;
                }
                btn.onclick = () => checkBoslukAnswer(btn, opt.correct);
                elements.boslukOptions.appendChild(btn);
            });

            elements.boslukFeedback.textContent = '';
            elements.boslukFeedback.className = 'feedback';
            elements.boslukNextBtn.style.display = 'none';

            // Otomatik ses çal
            if (currentBoslukQuestion && currentBoslukQuestion.ayet_ses_dosyasi) {
                playAudio(currentBoslukQuestion.ayet_ses_dosyasi, elements.boslukAudioBtn);
            }
        }

        elements.boslukAudioBtn.onclick = () => {
            if (currentBoslukQuestion && currentBoslukQuestion.ayet_ses_dosyasi) {
                playAudio(currentBoslukQuestion.ayet_ses_dosyasi, elements.boslukAudioBtn);
            }
        };

        function checkBoslukAnswer(button, isCorrect) {
            log.debug(`🚨 === BOŞLUK DOLDUR CEVAP KONTROLÜ ===`);
            log.debug(`👆 Tıklanan buton: "${button.textContent}"`);
            log.debug(`✅/❌ isCorrect parametresi: ${isCorrect}`);
            log.debug(`📊 Mevcut soru: #${boslukQuestionCount + 1}/${BOSLUK_MAX_QUESTIONS}`);
            log.debug(`📊 Eksik kelime: "${missingWord}"`);
            log.debug(`📊 Önce - session: score=${sessionScore}, correct=${sessionCorrect}, wrong=${sessionWrong}`);
            log.debug(`📊 Önce - boşluk: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}`);
            
            // KELİME İSTATİSTİKLERİ SADECE KELİME ÇEVİR OYUNUNDA KAYIT EDİLİYOR
            // Boşluk Doldur oyunu için istatistik kaydedilmiyor
            
            const allBtns = elements.boslukOptions.querySelectorAll('.option');
            log.debug(`🔒 ${allBtns.length} buton devre dışı bırakılıyor...`);
            allBtns.forEach(btn => btn.disabled = true);

            if (isCorrect) {
                log.debug(`✅ === DOĞRU CEVAP İŞLEMİ ===`);
                button.classList.add('correct');
                elements.boslukFeedback.textContent = '✅ Mâşâallah!';
                elements.boslukFeedback.className = 'feedback correct';
                
                log.debug(`💰 Boşluk Doldur sabit puan: 10 puan ekleniyor`);
                log.debug(`📊 Boşluk score güncelleniyor: ${boslukScore} + 10 = ${boslukScore + 10}`);
                boslukScore += 10; // Local oyun puanı
                boslukCorrect++;
                
                log.debug(`📊 addSessionPoints(10) çağrılıyor...`);
                addSessionPoints(10); // Session puanına ekle
                
                // Daily task progress - her doğru cevap için
                updateTaskProgress('boslukDoldur', 1);
                
                // Perfect streak kontrolü - hiç yanlış yapmamışsak perfect streak artır
                if (sessionWrong === 0) {
                    updateTaskProgress('perfectStreak', 1);
                    log.debug(`🔥 Perfect streak artırıldı! Mevcut: ${dailyTasks.todayStats.perfectStreak}`);
                }
                
                log.debug(`✅ Doğru cevap işlemi tamamlandı!`);

                // Tam ayeti doğru kelimeyi altın sarısı ile vurgulayarak göster
                showAnswerWithGoldenHighlight();
            } else {
                log.debug(`❌ === YANLIŞ CEVAP İŞLEMİ ===`);
                button.classList.add('wrong');
                elements.boslukFeedback.textContent = `❌ Hatalı! Doğru kelime: ${missingWord}`;
                elements.boslukFeedback.className = 'feedback wrong';
                
                log.debug(`📊 Boşluk wrong güncelleniyor: ${boslukWrong} + 1 = ${boslukWrong + 1}`);
                boslukWrong++;
                
                log.debug(`📊 addSessionWrong() çağrılıyor...`);
                addSessionWrong(); // Session yanlış sayısını artır
                log.debug(`❌ ÖNEMLI: Yanlış cevap için puan EKLENMEDİ!`);

                log.debug(`🔍 Doğru cevabı gösteriliyor...`);
                // Doğru cevabı göster
                let correctButtonFound = false;
                allBtns.forEach(btn => {
                    if (btn.textContent.includes(missingWord)) {
                        btn.classList.add('correct');
                        correctButtonFound = true;
                        log.debug(`✅ Doğru buton bulundu: "${btn.textContent}"`);
                    }
                });
                if (!correctButtonFound) {
                    log.debug(`⚠️ Doğru buton bulunamadı! Aranan: "${missingWord}"`);
                }

                // Tam ayeti doğru kelimeyi altın sarısı ile vurgulayarak göster
                showAnswerWithGoldenHighlight();
            }

            log.debug(`📊 Soru sayacı artırılıyor: ${boslukQuestionCount} + 1 = ${boslukQuestionCount + 1}`);
            boslukQuestionCount++; // Soru sayacını artır
            log.debug(`📊 FINAL - session: score=${sessionScore}, correct=${sessionCorrect}, wrong=${sessionWrong}`);
            log.debug(`📊 FINAL - boşluk: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}, questionCount=${boslukQuestionCount}`);
            log.debug(`🚨 === BOŞLUK DOLDUR CEVAP KONTROLÜ BİTTİ ===`);
            updateBoslukUI();
            // Show the Bosluk 'Next' button
            elements.boslukNextBtn.style.display = 'block';
        }

        elements.boslukNextBtn.onclick = () => {
            loadBoslukQuestion();
        };

        function updateBoslukUI() {
            log.debug(`🎨 BoslukUI güncelleniyor...`);
            log.debug(`📊 Gösterilecek değerler: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}`);
            elements.boslukScore.textContent = boslukScore;
            elements.boslukCorrect.textContent = boslukCorrect;
            elements.boslukWrong.textContent = boslukWrong;
            log.debug(`✅ BoslukUI güncellendi!`);
        }

        function showAnswerWithGoldenHighlight() {
            // Doğru kelimeyi altın sarısı renkte vurgulayarak tam ayeti göster
            const fullText = currentBoslukQuestion.ayet_metni;
            const highlightedText = fullText.replace(
                new RegExp(`\\b${missingWord}\\b`, 'g'), 
                `<span class="golden-highlight" style="color: #FFD700 !important; font-weight: bold !important; text-shadow: 0 0 5px rgba(255, 215, 0, 0.8) !important; background-color: rgba(255, 215, 0, 0.15) !important; padding: 1px 3px !important; border-radius: 3px !important; font-family: 'KFGQPC Uthmanic Script HAFS Regular', 'Amiri', serif !important;">${missingWord}</span>`
            );
            elements.boslukAyetText.innerHTML = highlightedText;
            
            log.debug(`🌟 Doğru kelime "${missingWord}" altın sarısı ile vurgulandı!`);
            log.debug(`📄 Tam metin: ${highlightedText}`);
            
            // Ekstra güvenlik için direct style da uygula
            setTimeout(() => {
                const goldenSpans = elements.boslukAyetText.querySelectorAll('.golden-highlight');
                goldenSpans.forEach(span => {
                    span.style.color = '#FFD700';
                    span.style.fontWeight = 'bold';
                    span.style.textShadow = '0 0 5px rgba(255, 215, 0, 0.8)';
                    span.style.backgroundColor = 'rgba(255, 215, 0, 0.1)';
                });
                log.debug(`✨ ${goldenSpans.length} altın span bulundu ve stil uygulandı!`);
            }, 100);
        }

        // ============ DUA ET MODU ============
        function showDua() {
            const dua = duaData[currentDuaIndex];
            if (!dua) return;

            elements.duaSureInfo.textContent = `Ayet: ${dua.ayet || ''}`;
            elements.duaArabic.textContent = dua.dua || '';
            elements.duaTranslation.textContent = dua.tercume || '';

            elements.prevDuaBtn.disabled = currentDuaIndex === 0;
            elements.nextDuaBtn.disabled = currentDuaIndex === duaData.length - 1;
        }

        elements.prevDuaBtn.onclick = () => {
            log.debug('⬅️ Önceki dua butonuna tıklandı');
            if (currentDuaIndex > 0) {
                log.debug('📍 Önceki duaya geçiliyor:', currentDuaIndex, '->', currentDuaIndex - 1);
                stopCurrentAudio(); // Mevcut ses varsa durdur
                currentDuaIndex--;
                showDua();
                log.debug('✅ Önceki dua gösterildi');
                // Navigasyon - görev sayılmaz
            }
        };

        elements.nextDuaBtn.onclick = () => {
            log.debug('➡️ Sonraki dua butonuna tıklandı');
            if (currentDuaIndex < duaData.length - 1) {
                log.debug('📍 Sonraki duaya geçiliyor:', currentDuaIndex, '->', currentDuaIndex + 1);
                stopCurrentAudio(); // Mevcut ses varsa durdur
                currentDuaIndex++;
                showDua();
                log.debug('✅ Sonraki dua gösterildi');
                // Navigasyon - görev sayılmaz
            }
        };

        elements.duaAudioBtn.onclick = () => {
            log.debug('🔊 Dua audio butonuna tıklandı');
            const dua = duaData[currentDuaIndex];
            log.debug('📊 Mevcut dua bilgileri:', {
                index: currentDuaIndex,
                hasUrl: !!(dua && dua.ses_url),
                url: dua?.ses_url,
                start: dua?.start,
                title: dua?.dua_adi
            });
            
            if (dua && dua.ses_url) {
                // Önceki sesi durdur
                stopCurrentAudio();
                
                // Butonu devre dışı bırak
                elements.duaAudioBtn.disabled = true;
                log.debug('🔒 Audio butonu devre dışı bırakıldı');
                
                try {
                    currentAudio = new Audio(dua.ses_url);
                    
                    // Başlangıç zamanı varsa ayarla (yüklenmeden önce)
                    if (dua.start) {
                        currentAudio.currentTime = dua.start;
                    }
                    
                    // Direkt çalmayı dene
                    currentAudio.play().then(() => {
                        log.debug('🎵 Dua sesi başlatıldı - URL:', dua.ses_url);
                        log.debug('🎵 Audio object durumu:', {
                            currentTime: currentAudio.currentTime,
                            duration: currentAudio.duration,
                            paused: currentAudio.paused,
                            readyState: currentAudio.readyState,
                            volume: currentAudio.volume
                        });
                        elements.duaAudioBtn.disabled = false; // Butonu tekrar aktif et
                    }).catch(err => {
                        log.error('❌ Ses çalma hatası:', err);
                        elements.duaAudioBtn.disabled = false;
                        currentAudio = null;
                    });
                    
                    // Ses yüklenme durumu
                    currentAudio.onloadstart = () => {
                        log.debug('📥 Ses yüklenmeye başladı');
                    };

                    currentAudio.oncanplay = () => {
                        log.debug('✅ Ses çalmaya hazır');
                    };

                    currentAudio.onplay = () => {
                        log.debug('▶️ Ses çalmaya başladı');
                    };

                    currentAudio.onpause = () => {
                        log.debug('⏸️ Ses duraklatıldı');
                    };

                    currentAudio.ontimeupdate = () => {
                        // Null check - eğer currentAudio silinmişse event'i durdur
                        if (!currentAudio) return;
                        
                        // Her 5 saniyede bir log (çok fazla log'u önlemek için)
                        if (currentAudio.currentTime > 0 && Math.floor(currentAudio.currentTime) % 5 === 0) {
                            log.debug('⏱️ Ses oynatma zamanı:', currentAudio.currentTime.toFixed(2) + 's / ' + (currentAudio.duration || 0).toFixed(2) + 's');
                        }
                    };
                    
                    // Ses bittiğinde
                    currentAudio.onended = () => {
                        log.debug('🏁 Ses bitti');
                        elements.duaAudioBtn.disabled = false;
                        updateTaskProgress('duaOgre', 1);
                        currentAudio = null;
                    };
                    
                    // Hata durumunda
                    currentAudio.onerror = (err) => {
                        log.error('❌ Ses dosyası hatası:', err);
                        log.error('❌ Hata detayları:', {
                            code: currentAudio.error?.code,
                            message: currentAudio.error?.message
                        });
                        elements.duaAudioBtn.disabled = false;
                        currentAudio = null;
                    };
                    
                } catch (err) {
                    log.error('Audio oluşturma hatası:', err);
                    elements.duaAudioBtn.disabled = false;
                    currentAudio = null;
                }
            }
        };

        // ============ AYET OKU MODU (RASTGELE) ============
        function showAyet() {
            // Rastgele ayet seç
            currentAyetIndex = Math.floor(Math.random() * ayetOkuData.length);
            const ayet = ayetOkuData[currentAyetIndex];
            if (!ayet) return;
            
            elements.ayetSureInfo.textContent = `${ayet.sure_adı || 'Sûre'} - Ayet`;
            elements.ayetArabic.textContent = ayet.ayet_metni || '';
            elements.ayetTranslation.textContent = ayet.meal || '';
        }

        elements.prevAyetBtn.onclick = () => {
            log.debug('⬅️ Önceki ayet butonuna tıklandı');
            stopCurrentAudio(); // Mevcut ses varsa durdur
            showAyet(); // Rastgele önceki ayet
            log.debug('✅ Önceki ayet gösterildi');
            // Navigasyon - görev sayılmaz
        };

        elements.nextAyetBtn.onclick = () => {
            log.debug('➡️ Sonraki ayet butonuna tıklandı');
            stopCurrentAudio(); // Mevcut ses varsa durdur
            showAyet(); // Rastgele sonraki ayet
            log.debug('✅ Sonraki ayet gösterildi');
            // Navigasyon - görev sayılmaz
        };

        elements.ayetAudioBtn.onclick = () => {
            log.debug('🔊 Ayet audio butonuna tıklandı');
            const ayet = ayetOkuData[currentAyetIndex];
            log.debug('📊 Mevcut ayet bilgileri:', {
                index: currentAyetIndex,
                hasUrl: !!(ayet && ayet.ayet_ses_dosyasi),
                url: ayet?.ayet_ses_dosyasi,
                sure: ayet?.sure_adi,
                ayetNo: ayet?.ayet_no
            });
            
            if (ayet && ayet.ayet_ses_dosyasi) {
                // Önceki sesi durdur
                stopCurrentAudio();
                
                // Butonu devre dışı bırak
                elements.ayetAudioBtn.disabled = true;
                log.debug('🔒 Audio butonu devre dışı bırakıldı');
                
                try {
                    currentAudio = new Audio(ayet.ayet_ses_dosyasi);
                    
                    // Direkt çalmayı dene
                    currentAudio.play().then(() => {
                        log.debug('🎵 Ayet sesi başlatıldı - URL:', ayet.ayet_ses_dosyasi);
                        log.debug('🎵 Audio object durumu:', {
                            currentTime: currentAudio.currentTime,
                            duration: currentAudio.duration,
                            paused: currentAudio.paused,
                            readyState: currentAudio.readyState,
                            volume: currentAudio.volume
                        });
                        elements.ayetAudioBtn.disabled = false; // Butonu tekrar aktif et
                    }).catch(err => {
                        log.error('❌ Ses çalma hatası:', err);
                        elements.ayetAudioBtn.disabled = false;
                        currentAudio = null;
                    });
                    
                    // Ses yüklenme durumu
                    currentAudio.onloadstart = () => {
                        log.debug('📥 Ses yüklenmeye başladı');
                    };

                    currentAudio.oncanplay = () => {
                        log.debug('✅ Ses çalmaya hazır');
                    };

                    currentAudio.onplay = () => {
                        log.debug('▶️ Ses çalmaya başladı');
                    };

                    currentAudio.onpause = () => {
                        log.debug('⏸️ Ses duraklatıldı');
                    };

                    currentAudio.ontimeupdate = () => {
                        // Null check - eğer currentAudio silinmişse event'i durdur
                        if (!currentAudio) return;
                        
                        // Her 5 saniyede bir log (çok fazla log'u önlemek için)
                        if (currentAudio.currentTime > 0 && Math.floor(currentAudio.currentTime) % 5 === 0) {
                            log.debug('⏱️ Ses oynatma zamanı:', currentAudio.currentTime.toFixed(2) + 's / ' + (currentAudio.duration || 0).toFixed(2) + 's');
                        }
                    };
                    
                    // Ses bittiğinde
                    currentAudio.onended = () => {
                        log.debug('🏁 Ayet sesi bitti');
                        elements.ayetAudioBtn.disabled = false;
                        updateTaskProgress('ayetOku', 1); // Görev sayılsın
                        currentAudio = null;
                    };
                    
                    // Hata durumunda
                    currentAudio.onerror = (err) => {
                        log.error('❌ Ses dosyası hatası:', err);
                        log.error('❌ Hata detayları:', {
                            code: currentAudio.error?.code,
                            message: currentAudio.error?.message
                        });
                        elements.ayetAudioBtn.disabled = false;
                        currentAudio = null;
                    };
                    
                } catch (err) {
                    log.error('Audio oluşturma hatası:', err);
                    elements.ayetAudioBtn.disabled = false;
                    currentAudio = null;
                }
            }
        };

        // ============ HADİS OKU MODU (RASTGELE) ============
        function showHadis() {
            // Rastgele hadis seç
            currentHadisIndex = Math.floor(Math.random() * hadisData.length);
            const hadis = hadisData[currentHadisIndex];
            if (!hadis) return;

            elements.hadisCategory.textContent = hadis.section || '';
            elements.hadisTitle.textContent = hadis.chapterName || '';
            elements.hadisHeader.textContent = hadis.header || '';
            elements.hadisText.textContent = hadis.text || '';
            elements.hadisRef.textContent = hadis.refno || '';
        }

        elements.prevHadisBtn.onclick = () => {
            stopCurrentAudio(); // Mevcut ses varsa durdur
            showHadis(); // Rastgele önceki hadis
            // Daily task progress - hadis okuma
            updateTaskProgress('hadisOku', 1);
        };

        elements.nextHadisBtn.onclick = () => {
            stopCurrentAudio(); // Mevcut ses varsa durdur
            showHadis(); // Rastgele sonraki hadis
            // Daily task progress - hadis okuma
            updateTaskProgress('hadisOku', 1);
        };

        // ============ OYUNU BAŞLAT ============
        // Performance: Async initialization
        setTimeout(async () => {
            try {
                await loadData();
                updateStatsBar(); // İstatistik barını initialize et
                log.debug('✅ Oyun veriler yüklendi ve hazır');
            } catch (error) {
                log.error('❌ Oyun yükleme hatası:', error);
            }
        }, 100); // DOM hazır olduktan sonra async başlat
            // Global debug fonksiyonu - console'dan çağırılabilir
            window.debugStats = function() {
                log.debug('🔧 DEBUG - Mevcut Oyun İstatistikleri:');
                log.debug('Total Points:', typeof totalPoints !== 'undefined' ? totalPoints : 'Henüz yüklenmedi');
                log.debug('Star Points:', typeof starPoints !== 'undefined' ? starPoints : 'Henüz yüklenmedi');
                log.debug('Level:', typeof level !== 'undefined' ? level : 'Henüz yüklenmedi');
                log.debug('Session Score:', typeof sessionScore !== 'undefined' ? sessionScore : 'Henüz yüklenmedi');
            };

            // 🔍 SENKRONİZASYON TESTİ - Kapsamlı kontrol
            window.testSenkronizasyon = function() {
                log.debug('\n═══════════════════════════════════════');
                log.debug('🔍 BAŞARI & PUAN SİSTEMİ SENKRONİZASYON TESTİ');
                log.debug('═══════════════════════════════════════\n');

                // 1. MEVCUT DURUM
                log.debug('📊 1. MEVCUT DURUM:');
                log.debug('   totalPoints:', totalPoints);
                log.debug('   sessionScore:', sessionScore);
                log.debug('   level:', level);
                log.debug('   starPoints:', starPoints);
                log.debug('   badges:', JSON.stringify(badges));
                log.debug('   comboCount:', comboCount);

                // 2. ROZET HESAPLAMA KONTROLÜ
                log.debug('\n🏅 2. ROZET SİSTEMİ KONTROLÜ:');
                const expectedBadges = {
                    bronze: Math.floor(totalPoints / 2000),
                    silver: Math.floor(totalPoints / 8500),
                    gold: Math.floor(totalPoints / 25500),
                    diamond: Math.floor(totalPoints / 85000)
                };
                log.debug('   Beklenen:', JSON.stringify(expectedBadges));
                log.debug('   Mevcut:', JSON.stringify(badges));

                const badgeMatch = JSON.stringify(expectedBadges) === JSON.stringify(badges);
                log.debug('   Senkronizasyon:', badgeMatch ? '✅ UYUMLU' : '❌ UYUMSUZ');

                if (!badgeMatch) {
                    log.debug('   ⚠️ Rozet sayıları tutarsız! updateBadgeSystem() çağrılıyor...');
                    updateBadgeSystem();
                    log.debug('   Düzeltilmiş:', JSON.stringify(badges));
                }

                // 3. BAŞARIM KONTROLÜ
                log.debug('\n🏆 3. BAŞARIM SİSTEMİ KONTROLÜ:');
                const unlockedAch = JSON.parse(localStorage.getItem('unlockedAchievements')) || [];
                log.debug('   Açılan başarımlar:', unlockedAch.length, 'adet');
                log.debug('   Liste:', unlockedAch.join(', '));

                // XP tabanlı başarımları kontrol et
                const xpAchievements = [
                    { id: 'xp_500', threshold: 500, name: 'İlk Adım' },
                    { id: 'xp_2000', threshold: 2000, name: 'Bronz Yolcu' },
                    { id: 'xp_4000', threshold: 4000, name: 'Hızlı Başlangıç' },
                    { id: 'xp_8500', threshold: 8500, name: 'Gümüş Master' },
                    { id: 'xp_17000', threshold: 17000, name: 'Çift Gümüş' },
                    { id: 'xp_25500', threshold: 25500, name: 'Altın Master' },
                    { id: 'xp_51000', threshold: 51000, name: 'Çift Altın' },
                    { id: 'xp_85000', threshold: 85000, name: 'Elmas Master' },
                    { id: 'xp_170000', threshold: 170000, name: 'Efsane' }
                ];

                let expectedAchievements = [];
                xpAchievements.forEach(ach => {
                    if (totalPoints >= ach.threshold) {
                        expectedAchievements.push(ach.id);
                        const hasAch = unlockedAch.includes(ach.id);
                        log.debug(`   ${hasAch ? '✅' : '❌'} ${ach.name} (${ach.threshold} XP): ${hasAch ? 'Açık' : 'KAPALI!'}`);
                    }
                });

                const missingAchievements = expectedAchievements.filter(id => !unlockedAch.includes(id));
                if (missingAchievements.length > 0) {
                    log.debug('   ⚠️ Eksik başarımlar:', missingAchievements.join(', '));
                    log.debug('   💡 checkAchievements() çağrılıyor...');
                    checkAchievements();
                }

                // 4. VERİ KALICILIĞI KONTROLÜ
                log.debug('\n💾 4. VERİ KALICILIĞI KONTROLÜ:');
                const lsPoints = localStorage.getItem('hasene_totalPoints');
                const lsBadges = localStorage.getItem('hasene_badges');
                log.debug('   localStorage totalPoints:', lsPoints);
                log.debug('   localStorage badges:', lsBadges);
                log.debug('   Memory totalPoints:', totalPoints);
                log.debug('   Memory badges:', JSON.stringify(badges));

                const lsMatch = parseInt(lsPoints) === totalPoints;
                log.debug('   Points senkronizasyon:', lsMatch ? '✅ UYUMLU' : '❌ UYUMSUZ');

                if (!lsMatch) {
                    log.debug('   ⚠️ localStorage güncel değil! saveStats() çağrılıyor...');
                    saveStats();
                }

                // 5. GÜNLÜK GÖREV KONTROLÜ
                log.debug('\n📅 5. GÜNLÜK GÖREV KONTROLÜ:');
                log.debug('   Bugünkü toplam puan:', dailyTasks.todayStats.toplamPuan);
                log.debug('   Günlük hedef:', dailyTasks.hedefler.toplamPuan);
                const dailyHasene = parseInt(localStorage.getItem('dailyHasene')) || 0;
                const goalHasene = parseInt(localStorage.getItem('dailyGoalHasene')) || 2700;
                log.debug('   Daily Hasene:', dailyHasene, '/', goalHasene);
                log.debug('   Günlük hedef tamamlandı mı?', dailyHasene >= goalHasene ? '✅ EVET' : '❌ HAYIR');

                // 6. SEVIYE HESAPLAMA KONTROLÜ
                log.debug('\n⬆️ 6. SEVİYE SİSTEMİ KONTROLÜ:');
                const calculatedLevel = calculateLevel(totalPoints);
                log.debug('   Hesaplanan seviye:', calculatedLevel);
                log.debug('   Mevcut seviye:', level);
                log.debug('   Seviye senkronizasyon:', calculatedLevel === level ? '✅ UYUMLU' : '❌ UYUMSUZ');

                if (calculatedLevel !== level) {
                    log.debug('   ⚠️ Seviye tutarsız! Düzeltiliyor...');
                    level = calculatedLevel;
                    updateStatsBar();
                }

                // 7. ÖZET RAPOR
                log.debug('\n═══════════════════════════════════════');
                log.debug('📊 ÖZET RAPOR:');
                log.debug('═══════════════════════════════════════');
                const allOK = badgeMatch && lsMatch && (calculatedLevel === level);
                log.debug('Genel Durum:', allOK ? '✅ TÜM SİSTEMLER SENKRONİZE' : '⚠️ BAZI SORUNLAR VAR');
                log.debug('Rozet Sistemi:', badgeMatch ? '✅' : '❌');
                log.debug('Veri Kalıcılığı:', lsMatch ? '✅' : '❌');
                log.debug('Seviye Sistemi:', (calculatedLevel === level) ? '✅' : '❌');
                log.debug('═══════════════════════════════════════\n');

                return allOK;
            };
            
            // Test puan ekleme fonksiyonu
            window.testAddPoints = function(points) {
                log.stats(`\n🎯 TEST: ${points} puan ekleniyor...`);
                log.stats('Önceki totalPoints:', totalPoints);
                addSessionPoints(points);
                log.stats('Sonraki totalPoints:', totalPoints);
                log.stats('✅ Puan eklendi. testSenkronizasyon() çalıştırılıyor...\n');
                setTimeout(() => testSenkronizasyon(), 500);
            };
            
            // Hızlı test senaryoları
            window.testSenaryo1 = function() {
                log.stats('\n🧪 SENARYO 1: Yeni kullanıcı (0 → 2500 XP)');
                resetPoints();
                testAddPoints(2500);
            };
            
            window.testSenaryo2 = function() {
                log.stats('\n🧪 SENARYO 2: Combo bonusu (3x doğru cevap)');
                resetPoints();
                addSessionPoints(10);
                addSessionPoints(10);
                addSessionPoints(10); // 3. cevap combo bonusu tetikler
                setTimeout(() => testSenkronizasyon(), 500);
            };
            
            window.testSenaryo3 = function() {
                log.stats('\n🧪 SENARYO 3: Rozet seviye atlama (25000 → 26000 XP)');
                totalPoints = 25000;
                updateBadgeSystem();
                saveStats();
                testAddPoints(1000); // Altın rozet kazanılmalı
            };
            
            window.testSenaryo4 = function() {
                log.stats('\n🧪 SENARYO 4: Sayfa yenileme simülasyonu');
                log.stats('1. Mevcut durum kaydediliyor...');
                saveStats();
                log.stats('2. Veri değişkenleri sıfırlanıyor (sayfa yenileme sim.)...');
                const savedPoints = totalPoints;
                totalPoints = 0;
                level = 1;
                badges = { bronze: 0, silver: 0, gold: 0, diamond: 0 };
                log.stats('3. Veriler yeniden yükleniyor...');
                loadStats().then(() => {
                    log.stats('4. Senkronizasyon kontrol ediliyor...');
                    setTimeout(() => {
                        log.stats('Kaydedilen XP:', savedPoints);
                        log.stats('Yüklenen XP:', totalPoints);
                        testSenkronizasyon();
                    }, 500);
                });
            };

            // Seviye geçiş test fonksiyonu - console'dan çağırılabilir
            window.testLevelUp = function(targetPoints) {
                log.stats('🎯 Seviye geçiş testi başlatılıyor...');
                log.stats('Mevcut puan:', totalPoints);
                log.stats('Hedef puan:', targetPoints);
                
                // Hedef puana sıçrama
                const oldLevel = calculateLevel(totalPoints);
                const difference = targetPoints - totalPoints;
                totalPoints = targetPoints;
                
                // Bugünkü puana da farkı ekle (test amaçlı)
                dailyTasks.todayStats.toplamPuan += difference;
                
                const newLevel = calculateLevel(totalPoints);
                
                log.debug('Eski seviye:', oldLevel);
                log.debug('Yeni seviye:', newLevel);
                
                // Seviye atlama kontrolü
                if (newLevel > oldLevel) {
                    level = newLevel;
                    log.game('✅ Seviye atlandı! Modal gösteriliyor...');
                    showLevelUpModal(newLevel);
                } else {
                    log.stats('❌ Seviye atlanmadı.');
                }
                
                updateStatsBar();
                saveStats(); // Değişiklikleri kaydet
            };

            // Hızlı seviye test fonksiyonları
            window.testLevel2 = () => testLevelUp(1000);   // Seviye 2'ye çık
            window.testLevel3 = () => testLevelUp(2500);   // Seviye 3'e çık
            window.testLevel5 = () => testLevelUp(8500);   // Seviye 5'e çık
            window.testLevel10 = () => testLevelUp(46000); // Seviye 10'a çık
            window.resetPoints = () => { 
                totalPoints = 0; 
                level = 1; 
                updateStatsBar(); 
                saveStats(); 
                log.stats('🔄 Puanlar sıfırlandı'); 
            };
            window.resetAllStats = resetAllStats;

            // Modal fonksiyonlarını global hale getir
            window.showBadgesModal = showBadgesModal;
            window.closeBadgesModal = closeBadgesModal;
            
            // SON ADIM: Kaydedilmiş verileri yükle
            try {
                // VERI SİSTEMİ BAŞLATMA (üçüncü taraf çerez sorunu için)
                log.debug('🚀 Veri sistemi başlatılıyor...');
                
                // IndexedDB başlat (çerez engellemelerinden etkilenmez)
                initIndexedDB().then(async () => {
                    log.debug('✅ IndexedDB hazır!');
                    await loadStats(); // Verileri yükle (IndexedDB öncelikli) - AWAIT EKLENDİ!
                    updateStatsBar();
                    log.debug('💾 Veriler yüklendi:', totalPoints, 'puan');
                }).catch(async (error) => {
                    log.error('❌ IndexedDB hatası, localStorage kullanılıyor:', error);
                    await loadStats(); // Fallback olarak localStorage - AWAIT EKLENDİ!
                    updateStatsBar();
                });
            } catch (error) {
                showCustomAlert(`Veri yükleme hatası: ${error.message}`, 'error');
                log.error('❌ Veri yükleme hatası:', error);
            }
            
            // ============ MODAL BUTONLARINA EVENT LISTENER EKLE ============
            if (dailyTasksBtn) dailyTasksBtn.onclick = showDailyTasksModal;
            if (statsBtn) statsBtn.onclick = showStatsModal;
            if (calendarBtn) calendarBtn.onclick = showCalendarModal;
            if (xpInfoBtn) xpInfoBtn.onclick = showXPInfoModal;
            
            // Modal kapatma butonları
            const closeBadgesBtn = document.getElementById('closeBadgesBtn');
            const closeCalendarBtn = document.getElementById('closeCalendarBtn');
            const closeDailyTasksBtn = document.getElementById('closeDailyTasksBtn');
            const closeStatsBtn = document.getElementById('closeStatsBtn');
            const closeDailyGoalBtn = document.getElementById('closeDailyGoalBtn');
            const closeXPInfoBtn = document.getElementById('closeXPInfoBtn');
            
            if (closeBadgesBtn) closeBadgesBtn.onclick = closeBadgesModal;
            if (closeCalendarBtn) closeCalendarBtn.onclick = closeCalendarModal;
            if (closeDailyTasksBtn) closeDailyTasksBtn.onclick = closeDailyTasksModal;
            if (closeStatsBtn) closeStatsBtn.onclick = closeStatsModal;
            if (closeDailyGoalBtn) closeDailyGoalBtn.onclick = closeDailyGoalModal;
            if (closeXPInfoBtn) closeXPInfoBtn.onclick = closeXPInfoModal;
        
        }); // DOMContentLoaded event listener sonu

        // ============ PWA SERVICE WORKER KAYDI ============
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                    log.debug('🎮 SW registered: ', registration);
                        
                        // PWA yükleme prompt'u
                        let deferredPrompt;
                        window.addEventListener('beforeinstallprompt', (e) => {
                            log.debug('💾 PWA install prompt available');
                            e.preventDefault();
                            deferredPrompt = e;
                            
                            // Install button göster (isteğe bağlı)
                            showPWAInstallPrompt(deferredPrompt);
                        });

                        // PWA yüklendiğinde
                        window.addEventListener('appinstalled', (evt) => {
                            log.game('📱 PWA was installed');
                            alert('🎉 Hasene Arapça Oyunu başarıyla yüklendi!\n\nArtık telefon masaüstünden açabilirsiniz! 🚀');
                        });
                    })
                    .catch(registrationError => {
                        log.error('❌ SW registration failed: ', registrationError);
                    });
            });

            // PWA Install Prompt fonksiyonu
            function showPWAInstallPrompt(deferredPrompt) {
                // PWA kurulum hatırlatıcısını konsolda göster, otomatik prompt yok
                log.debug('💾 PWA kurulumu hazır! Kullanıcı eylemiyle tetiklenebilir.');
                
                // Kullanıcı etkileşimi gerektiğinde çağrılacak fonksiyon
                window.triggerPWAInstall = () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === 'accepted') {
                                log.debug('✅ User accepted the install prompt');
                            } else {
                                log.debug('❌ User dismissed the install prompt');
                            }
                            deferredPrompt = null;
                        });
                    }
                };
            }
        }

        // ============ LOADING SAYFASI KONTROLü ============
        window.addEventListener('DOMContentLoaded', () => {
            const loadingScreen = document.getElementById('loadingScreen');
            const mainContainer = document.getElementById('mainContainer');
            
            // Performance optimization: RequestAnimationFrame kullan
            const showMainApp = () => {
                requestAnimationFrame(() => {
                    loadingScreen.classList.add('fade-out');
                    
                    // Fade-out animasyonu bittikten sonra
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        mainContainer.style.display = 'block';
                    }, 500); // fade-out süresi
                });
            };
            
            // 2.5 saniye sonra loading sayfasını kaldır (biraz daha hızlı)
            setTimeout(showMainApp, 2500);
        });


    </script>

    <!-- Özel Onay Pop-up -->
    <div class="custom-confirm" id="customConfirm">
        <div class="confirm-content">
            <div class="confirm-title">🎮 Oyundan Çıkış</div>
            <div class="confirm-stats" id="confirmStats">
                <div class="confirm-stat">
                    <span>✅ Doğru cevap:</span>
                    <span id="confirmCorrect">0</span>
                </div>
                <div class="confirm-stat">
                    <span>❌ Hatalı cevap:</span>
                    <span id="confirmWrong">0</span>
                </div>
                <div class="confirm-stat">
                    <span>� Kazanılan Hasene:</span>
                    <span id="confirmXP">0</span>
                </div>
            </div>
            <div class="confirm-message">
                Puanlarınız zaten kaydedildi, güvenle çıkabilirsiniz.
            </div>
            <div class="confirm-buttons">
                <button class="confirm-btn cancel" id="confirmCancel">İptal</button>
                <button class="confirm-btn ok" id="confirmOK">Çıkış Yap</button>
            </div>
        </div>
    </div>

    <!-- Flutter Bottom Navigation -->
    <div class="flutter-bottom-nav">                                
        <a class="flutter-nav-item" onclick="showMainMenu()">
            <i class="material-icons">home</i>
            <span>Ana Sayfa</span>
        </a>
        <a class="flutter-nav-item" onclick="showStatsModal()">
            <i class="material-icons">analytics</i>
            <span>İstatistik</span>
        </a>
        <a class="flutter-nav-item" onclick="showDailyTasksModal()">
            <i class="material-icons">task_alt</i>
            <span>Görevler</span>
        </a>
        <a class="flutter-nav-item" onclick="showBadgesModal()">
            <i class="material-icons">emoji_events</i>
            <span>Başarılar</span>
        </a>
        <a class="flutter-nav-item" onclick="showCalendarModal()">
            <i class="material-icons">calendar_today</i>
            <span>Takvim</span>
        </a>
    </div>

    <script>
        // Ana menüyü göster
        function showMainMenu() {
            if (document.getElementById('mainMenu')) {
                document.getElementById('mainMenu').style.display = 'block';
                document.getElementById('gameScreen').style.display = 'none';
                document.getElementById('modeSelector').style.display = 'none';
                
                // Navigation active state
                document.querySelectorAll('.flutter-nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector('.flutter-nav-item').classList.add('active');
            }
        }

        // Bottom navigation active state yönetimi
        function setActiveNavItem(index) {
            document.querySelectorAll('.flutter-nav-item').forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });
        }

        // ⚡ SPEED ANIMATIONS SYSTEM
        function addSpeedAnimation(element, type = 'fade-in') {
            if (!element) return;
            element.classList.add(`speed-${type}`);
            setTimeout(() => element.classList.remove(`speed-${type}`), 600);
        }

        // 🎆 SUCCESS ANIMATIONS - CONFETTI SYSTEM
        function triggerConfetti() {
            const container = document.createElement('div');
            container.className = 'confetti-container';
            document.body.appendChild(container);

            // 50 konfeti parçası oluştur
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti-piece';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                container.appendChild(confetti);
            }

            // 3 saniye sonra temizle
            setTimeout(() => {
                if (container.parentNode) {
                    container.parentNode.removeChild(container);
                }
            }, 3000);
        }

        function triggerSuccessBurst(element) {
            if (!element) return;
            element.classList.add('success-burst');
            setTimeout(() => element.classList.remove('success-burst'), 800);
        }

        // 📱 HAPTIC FEEDBACK SYSTEM
        function triggerHaptic(type = 'medium') {
            try {
                // Modern haptic feedback API
                if ('vibrate' in navigator) {
                    const patterns = {
                        light: [50],
                        medium: [100],
                        heavy: [200],
                        success: [100, 30, 100],
                        error: [200, 100, 200],
                        combo: [50, 25, 50, 25, 100]
                    };
                    navigator.vibrate(patterns[type] || patterns.medium);
                }
            } catch (error) {
                log.debug('Haptic feedback not supported');
            }
        }

        // ============ SMOKE TESTS / QUICK CHECKS ============
        // Non-destructive helper to validate Kelime flow: load a question,
        // click the first option and confirm the Next button becomes visible.
        // Call from console with: __testKelimeFlow()
        window.__testKelimeFlow = async function() {
                try {
                    log.stats('🧪 Running quick Kelime smoke test...');
                if (!elements || !elements.kelimeCevirBtn) {
                    log.debug('⚠️ kelimeCevirBtn or elements not found');
                    return false;
                }
                // Ensure mode selector shown and start the game
                elements.kelimeCevirBtn.click();
                await new Promise(r => setTimeout(r, 150));
                if (elements.startBtn) elements.startBtn.click();
                await new Promise(r => setTimeout(r, 300));

                const opts = document.querySelectorAll('#options .option');
                if (!opts || opts.length === 0) {
                    console.warn('⚠️ No options rendered yet; ensure kelime data is loaded');
                    return false;
                }
                // Click first option
                opts[0].click();
                await new Promise(r => setTimeout(r, 200));
                const visible = elements.nextBtn && window.getComputedStyle(elements.nextBtn).display !== 'none';
                log.stats('🧪 Next button visible after answer?', visible);
                return visible;
            } catch (err) {
                log.error('🧪 Smoke test failed:', err);
                return false;
            }
        };

        
    </script>

</body>
</html>
